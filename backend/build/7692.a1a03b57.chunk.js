(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[7692],{76539:(O,T,t)=>{"use strict";t.d(T,{Z:()=>s});var e=t(67294),l=t(86896),n=t(45697),a=t.n(n),M=t(69307),d=t(8675),A=t(60793),m=t(79371),c=t(75878),v=t(19442),y=t(61378),h=t(48474);const r=({onRegenerate:E,idToRegenerate:R,backUrl:K,onError:U})=>{const{formatMessage:Z}=(0,l.Z)(),[D,$]=(0,e.useState)(!1),{regenerateData:S,isLoadingConfirmation:z}=(0,h.rW)(K,R,E,U),b=async()=>{S(),$(!1)};return e.createElement(e.Fragment,null,e.createElement(v.z,{startIcon:e.createElement(y.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>$(!0),name:"regenerate"},Z({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),e.createElement(M.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:e.createElement(y.Z,null),isConfirmButtonLoading:z,isOpen:D,onToggleDialog:()=>$(!1),onConfirm:b,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};r.defaultProps={onRegenerate(){},onError:void 0},r.propTypes={onRegenerate:a().func,idToRegenerate:a().oneOfType([a().number,a().string]).isRequired,backUrl:a().string.isRequired,onError:a().func};const o=r,p=({title:E,token:R,setToken:K,canEditInputs:U,canRegenerate:Z,isSubmitting:D,backUrl:$,regenerateUrl:S,onErrorRegenerate:z})=>{const{formatMessage:b}=(0,l.Z)(),G=Q=>{K({...R,accessKey:Q})};return e.createElement(m.T,{title:R?.name||b(E),primaryAction:U?e.createElement(c.k,{gap:2},Z&&R?.id&&e.createElement(o,{backUrl:S,onRegenerate:G,idToRegenerate:R?.id,onError:z}),e.createElement(v.z,{disabled:D,loading:D,startIcon:e.createElement(d.Z,null),type:"submit",size:"S"},b({id:"global.save",defaultMessage:"Save"}))):Z&&R?.id&&e.createElement(o,{onRegenerate:G,idToRegenerate:R?.id,backUrl:S}),navigationAction:e.createElement(M.rU,{startIcon:e.createElement(A.Z,null),to:$},b({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};p.propTypes={token:a().shape({id:a().oneOfType([a().number,a().string]),type:a().string,lifespan:a().oneOfType([a().number,a().string]),name:a().string,accessKey:a().string,permissions:a().array,description:a().string,createdAt:a().string}),canEditInputs:a().bool.isRequired,canRegenerate:a().bool.isRequired,setToken:a().func.isRequired,isSubmitting:a().bool.isRequired,backUrl:a().string.isRequired,title:a().shape({id:a().string,label:a().string}).isRequired,regenerateUrl:a().string.isRequired,onErrorRegenerate:a().func},p.defaultProps={token:void 0,onErrorRegenerate:void 0};const s=p},60401:(O,T,t)=>{"use strict";t.d(T,{Z:()=>v});var e=t(67294),l=t(45697),n=t.n(l),a=t(86896),M=t(50614),d=t(473),A=t(78549),m=t(75056);const c=({token:y,errors:h,values:r,onChange:o,isCreating:p})=>{const{formatMessage:s}=(0,a.Z)();return e.createElement(e.Fragment,null,e.createElement(M.P,{name:"lifespan",label:s({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:r.lifespan!==null?r.lifespan:"0",error:h.lifespan?s(h.lifespan?.id?h.lifespan:{id:h.lifespan,defaultMessage:h.lifespan}):null,onChange:E=>{o({target:{name:"lifespan",value:E}})},required:!0,disabled:!p,placeholder:"Select"},e.createElement(d.W,{value:"604800000"},s({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),e.createElement(d.W,{value:"2592000000"},s({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),e.createElement(d.W,{value:"7776000000"},s({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),e.createElement(d.W,{value:"0"},s({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),e.createElement(A.Z,{variant:"pi",textColor:"neutral600"},!p&&`${s({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,m.IX)(y?.createdAt,parseInt(r.lifespan,10))}`))};c.propTypes={errors:n().shape({lifespan:n().string}),onChange:n().func.isRequired,values:n().shape({lifespan:n().oneOfType([n().number,n().string])}).isRequired,isCreating:n().bool.isRequired,token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string})},c.defaultProps={errors:{},token:{}};const v=c},24122:(O,T,t)=>{"use strict";t.d(T,{Z:()=>h});var e=t(67294),l=t(86896),n=t(69307),a=t(37527),M=t(70780),d=t(33835),A=t(45697),m=t.n(A),c=t(74855),v=t.n(c);const y=({token:r,tokenType:o})=>{const{formatMessage:p}=(0,l.Z)(),s=(0,n.lm)(),{trackUsage:E}=(0,n.rS)(),R=(0,e.useRef)(E);return e.createElement(n.Y_,{endAction:r&&e.createElement("span",{style:{alignSelf:"start"}},e.createElement(c.CopyToClipboard,{onCopy:()=>{R.current("didCopyTokenKey",{tokenType:o}),s({type:"success",message:{id:"Settings.tokens.notification.copied"}})},text:r},e.createElement(a.h,{label:p({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),noBorder:!0,icon:e.createElement(M.Z,null),style:{padding:0,height:"1rem"}}))),title:r||p({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:p(r?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:e.createElement(d.Z,null),iconBackground:"neutral100"})};y.defaultProps={token:null},y.propTypes={token:m().string,tokenType:m().string.isRequired};const h=y},40695:(O,T,t)=>{"use strict";t.d(T,{Z:()=>A});var e=t(67294),l=t(45697),n=t.n(l),a=t(86896),M=t(20603);const d=({errors:m,values:c,onChange:v,canEditInputs:y})=>{const{formatMessage:h}=(0,a.Z)();return e.createElement(M.g,{label:h({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:m.description?h(m.description?.id?m.description:{id:m.description,defaultMessage:m.description}):null,onChange:v,disabled:!y},c.description)};d.propTypes={errors:n().shape({description:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({description:n().string}).isRequired},d.defaultProps={errors:{}};const A=d},61053:(O,T,t)=>{"use strict";t.d(T,{Z:()=>A});var e=t(67294),l=t(45697),n=t.n(l),a=t(86896),M=t(28469);const d=({errors:m,values:c,onChange:v,canEditInputs:y})=>{const{formatMessage:h}=(0,a.Z)();return e.createElement(M.o,{name:"name",error:m.name?h(m.name?.id?m.name:{id:m.name,defaultMessage:m.name}):null,label:h({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:v,value:c.name,disabled:!y,required:!0})};d.propTypes={errors:n().shape({name:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string}).isRequired},d.defaultProps={errors:{}};const A=d},31065:(O,T,t)=>{"use strict";t.d(T,{Z:()=>m});var e=t(67294),l=t(45697),n=t.n(l),a=t(86896),M=t(50614),d=t(473);const A=({name:c,errors:v,values:y,onChange:h,canEditInputs:r,options:o,label:p})=>{const{formatMessage:s}=(0,a.Z)();return e.createElement(M.P,{name:c,label:s({id:p.id,defaultMessage:p.defaultMessage}),value:y&&y[c],error:v[c]?s(v[c]?.id?v[c]:{id:v[c],defaultMessage:v[c]}):null,onChange:h,placeholder:"Select",required:!0,disabled:!r},o&&o.map(({value:E,label:R})=>e.createElement(d.W,{key:E,value:E},s(R))))};A.propTypes={name:n().string,options:n().arrayOf(n().shape({label:n().shape({id:n().string,defaultMessage:n().string}),value:n().string})),errors:n().shape({type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({type:n().string}).isRequired,label:n().shape({id:n().string,defaultMessage:n().string}).isRequired},A.defaultProps={name:"type",errors:{},options:[]};const m=A},47670:(O,T,t)=>{"use strict";t.d(T,{Z:()=>e,f:()=>l});const e="api-token",l="transfer-token"},57692:(O,T,t)=>{"use strict";t.d(T,{Z:()=>Ve});var e=t(67294),l=t(86896),n=t(69307),a=t(57713),M=t(26789),d=t(75878),A=t(41054),m=t(16550),c=t(88767),v=t(19631),y=t(75056),h=t(79371),r=t(19442),o=t(8675),p=t(45697),s=t.n(p);const E=({apiTokenName:i})=>{const{formatMessage:u}=(0,l.Z)();return(0,n.go)(),e.createElement(a.o,{"aria-busy":"true"},e.createElement(n.SL,{name:"API Tokens"}),e.createElement(h.T,{primaryAction:e.createElement(r.z,{disabled:!0,startIcon:e.createElement(o.Z,null),type:"button",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:i||u({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),e.createElement(M.D,null,e.createElement(n.dO,null)))};E.defaultProps={apiTokenName:null},E.propTypes={apiTokenName:s().string};const R=E;var K=t(87751);const U=(0,e.createContext)({}),Z=({children:i,...u})=>e.createElement(U.Provider,{value:u},i),D=()=>(0,e.useContext)(U);Z.propTypes={children:s().node.isRequired};const S=(i,u=[])=>({...i,selectedAction:null,routes:[],selectedActions:[],data:(0,y.mk)(u)});var z=t(18172),b=t(97019),G=t.n(b);const Q={data:{},selectedActions:[]},J=(i,u)=>(0,z.ZP)(i,g=>{switch(u.type){case"ON_CHANGE":{g.selectedActions.includes(u.value)?G()(g.selectedActions,u.value):g.selectedActions.push(u.value);break}case"SELECT_ALL_IN_PERMISSION":{u.value.every(C=>g.selectedActions.includes(C.actionId))?u.value.forEach(C=>{G()(g.selectedActions,C.actionId)}):u.value.forEach(C=>{g.selectedActions.push(C.actionId)});break}case"SELECT_ALL_ACTIONS":{g.selectedActions=[...g.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const I=g.data.allActionsIds.filter(C=>C.includes("find")||C.includes("findOne"));g.selectedActions=[...I];break}case"UPDATE_PERMISSIONS_LAYOUT":{g.data=(0,y.mk)(u.value);break}case"UPDATE_ROUTES":{g.routes={...u.value};break}case"UPDATE_PERMISSIONS":{g.selectedActions=[...u.value];break}case"SET_SELECTED_ACTION":{g.selectedAction=u.value;break}default:return g}});var w=t(9370),H=t(61585),N=t(78549),_=t(50781),ce=t(48403),se=t.n(ce),ae=t(63128),oe=t(27375),Ae=t(37362),ve=t(13539),Ce=t(80606),re=t(1565);const Pe=re.iv`
  background: ${i=>i.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Me=(0,re.ZP)(_.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${i=>i.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${i=>i.isActive&&Pe}
  &:hover {
    ${Pe}
  }
`,xe=re.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:i})=>i.colors.neutral150};
`,pe=({controllers:i,label:u,orderNumber:g,disabled:I,onExpanded:C,indexExpandendCollapsedContent:f})=>{const{value:{onChangeSelectAll:j,onChange:Y,selectedActions:W,setSelectedAction:V,selectedAction:ee}}=D(),[F,le]=(0,e.useState)(!1),{formatMessage:te}=(0,l.Z)(),L=()=>{le(B=>!B),C(g)};(0,e.useEffect)(()=>{f!==null&&f!==g&&F&&le(!1)},[f,g,F]);const q=B=>B===ee;return e.createElement(ae.U,{expanded:F,onToggle:L,variant:g%2?"primary":"secondary"},e.createElement(oe.B,{title:se()(u)}),e.createElement(Ae.v,null,i?.map(B=>{const de=B.actions.every(x=>W.includes(x.actionId)),Ee=B.actions.some(x=>W.includes(x.actionId));return e.createElement(_.x,{key:`${u}.${B?.controller}`},e.createElement(d.k,{justifyContent:"space-between",alignItems:"center",padding:4},e.createElement(_.x,{paddingRight:4},e.createElement(N.Z,{variant:"sigma",textColor:"neutral600"},B?.controller)),e.createElement(xe,null),e.createElement(_.x,{paddingLeft:4},e.createElement(ve.X,{value:de,indeterminate:!de&&Ee,onValueChange:()=>{j({target:{value:[...B.actions]}})},disabled:I},te({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(w.r,{gap:4,padding:4},B?.actions&&B?.actions.map(x=>e.createElement(H.P,{col:6,key:x.actionId},e.createElement(Me,{isActive:q(x.actionId),padding:2,hasRadius:!0},e.createElement(ve.X,{value:W.includes(x.actionId),name:x.actionId,onValueChange:()=>{Y({target:{value:x.actionId}})},disabled:I},x.action),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>V({target:{value:x.actionId}}),style:{display:"inline-flex",alignItems:"center"}},e.createElement(Ce.Z,null)))))))})))};pe.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},pe.propTypes={controllers:s().array,orderNumber:s().number,label:s().string.isRequired,disabled:s().bool,onExpanded:s().func,indexExpandendCollapsedContent:s().number};const Oe=pe,ue=({section:i,...u})=>{const[g,I]=(0,e.useState)(null),C=f=>I(f);return e.createElement(_.x,{padding:4,background:"neutral0"},i&&i.map((f,j)=>e.createElement(Oe,{key:f.apiId,label:f.label,controllers:f.controllers,orderNumber:j,indexExpandendCollapsedContent:g,onExpanded:C,name:f.apiId,...u})))};ue.defaultProps={section:null},ue.propTypes={section:s().arrayOf(s().object)};const Re=ue;var De=t(35161),Ie=t.n(De),Se=t(13217),ke=t.n(Se);const Le=i=>{switch(i){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Be=(0,re.ZP)(_.x)`
  margin: -1px;
  border-radius: ${({theme:i})=>i.spaces[1]} 0 0 ${({theme:i})=>i.spaces[1]};
`;function ge({route:i}){const{formatMessage:u}=(0,l.Z)(),{method:g,handler:I,path:C}=i,f=C?ke()(C.split("/")):[],[j="",Y=""]=I?I.split("."):[],W=Le(i.method);return e.createElement(d.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(N.Z,{variant:"delta",as:"h3"},u({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,j),e.createElement(N.Z,{variant:"delta",textColor:"primary600"},".",Y)),e.createElement(d.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Be,{background:W.background,borderColor:W.border,padding:2},e.createElement(N.Z,{fontWeight:"bold",textColor:W.text},g)),e.createElement(_.x,{paddingLeft:2,paddingRight:2},Ie()(f,V=>e.createElement(N.Z,{key:V,textColor:V.includes(":")?"neutral600":"neutral900"},"/",V)))))}ge.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ge.propTypes={route:s().shape({handler:s().string,method:s().string,path:s().string})};const Ue=ge,Ze=()=>{const{value:{selectedAction:i,routes:u}}=D(),{formatMessage:g}=(0,l.Z)(),I=i?.split(".")[0];return e.createElement(H.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},i?e.createElement(d.k,{direction:"column",alignItems:"stretch",gap:2},u[I]?.map(C=>C.config.auth?.scope?.includes(i)||C.handler===i?e.createElement(Ue,{key:C.handler,route:C}):null)):e.createElement(d.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(N.Z,{variant:"delta",as:"h3"},g({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),e.createElement(N.Z,{as:"p",textColor:"neutral600"},g({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},be=({...i})=>{const{value:{data:u}}=D(),{formatMessage:g}=(0,l.Z)();return e.createElement(w.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(H.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(d.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(N.Z,{variant:"delta",as:"h2"},g({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),e.createElement(N.Z,{as:"p",textColor:"neutral600"},g({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),u?.permissions&&e.createElement(Re,{section:u?.permissions,...i})),e.createElement(Ze,null))},We=(0,e.memo)(be);var Ke=t(60401),$e=t(61053),Ne=t(40695),je=t(31065);const me=({errors:i,onChange:u,canEditInputs:g,isCreating:I,values:C,apiToken:f,onDispatch:j,setHasChangedPermissions:Y})=>{const{formatMessage:W}=(0,l.Z)(),V=({target:{value:F}})=>{Y(!1),F==="full-access"&&j({type:"SELECT_ALL_ACTIONS"}),F==="read-only"&&j({type:"ON_CHANGE_READ_ONLY"})},ee=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return e.createElement(_.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(d.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(N.Z,{variant:"delta",as:"h2"},W({id:"global.details",defaultMessage:"Details"})),e.createElement(w.r,{gap:5},e.createElement(H.P,{key:"name",col:6,xs:12},e.createElement($e.Z,{errors:i,values:C,canEditInputs:g,onChange:u})),e.createElement(H.P,{key:"description",col:6,xs:12},e.createElement(Ne.Z,{errors:i,values:C,canEditInputs:g,onChange:u})),e.createElement(H.P,{key:"lifespan",col:6,xs:12},e.createElement(Ke.Z,{isCreating:I,errors:i,values:C,onChange:u,token:f})),e.createElement(H.P,{key:"type",col:6,xs:12},e.createElement(je.Z,{values:C,errors:i,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:F=>{V({target:{value:F}}),u({target:{name:"type",value:F}})},options:ee,canEditInputs:g})))))};me.propTypes={errors:s().shape({name:s().string,description:s().string,lifespan:s().string,type:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({name:s().string,description:s().string,lifespan:s().oneOfType([s().number,s().string]),type:s().string}).isRequired,isCreating:s().bool.isRequired,apiToken:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().string,name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),onDispatch:s().func.isRequired,setHasChangedPermissions:s().func.isRequired},me.defaultProps={errors:{},apiToken:{}};const Fe=me;var _e=t(24122),ze=t(76539),ie=t(47670);const He="Name already taken",Ve=()=>{(0,n.go)();const{formatMessage:i}=(0,l.Z)(),{lockApp:u,unlockApp:g}=(0,n.o1)(),I=(0,n.lm)(),C=(0,m.k6)(),[f,j]=(0,e.useState)(C.location.state?.apiToken.accessKey?{...C.location.state.apiToken}:null),{trackUsage:Y}=(0,n.rS)(),W=(0,e.useRef)(Y),{setCurrentStep:V}=(0,n.c1)(),{allowedActions:{canCreate:ee,canUpdate:F,canRegenerate:le}}=(0,n.ss)(K.Z.settings["api-tokens"]),[te,L]=(0,e.useReducer)(J,Q,P=>S(P,{})),{params:{id:q}}=(0,m.$B)("/settings/api-tokens/:id"),{get:B,post:de,put:Ee}=(0,n.kY)(),x=q==="create";(0,c.useQuery)("content-api-permissions",async()=>{const[P,X]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async ne=>{const{data:k}=await B(ne);return k.data}));L({type:"UPDATE_PERMISSIONS_LAYOUT",value:P}),L({type:"UPDATE_ROUTES",value:X}),f&&(f?.type==="read-only"&&L({type:"ON_CHANGE_READ_ONLY"}),f?.type==="full-access"&&L({type:"SELECT_ALL_ACTIONS"}),f?.type==="custom"&&L({type:"UPDATE_PERMISSIONS",value:f?.permissions}))},{onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,e.useEffect)(()=>{W.current(x?"didAddTokenFromList":"didEditTokenFromList",{tokenType:ie.Z})},[x]);const{status:Ge}=(0,c.useQuery)(["api-token",q],async()=>{const{data:{data:P}}=await B(`/admin/api-tokens/${q}`);return j({...P}),P?.type==="read-only"&&L({type:"ON_CHANGE_READ_ONLY"}),P?.type==="full-access"&&L({type:"SELECT_ALL_ACTIONS"}),P?.type==="custom"&&L({type:"UPDATE_PERMISSIONS",value:P?.permissions}),P},{enabled:!x&&!f,onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Ye=async(P,X)=>{W.current(x?"willCreateToken":"willEditToken",{tokenType:ie.Z}),u();const ne=P.lifespan&&parseInt(P.lifespan,10)&&P.lifespan!=="0"?parseInt(P.lifespan,10):null;try{const{data:{data:k}}=x?await de("/admin/api-tokens",{...P,lifespan:ne,permissions:P.type==="custom"?te.selectedActions:null}):await Ee(`/admin/api-tokens/${q}`,{name:P.name,description:P.description,type:P.type,permissions:P.type==="custom"?te.selectedActions:null});x&&(C.replace(`/settings/api-tokens/${k.id}`,{apiToken:k}),V("apiTokens.success")),g(),j({...k}),I({type:"success",message:i(x?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),W.current(x?"didCreateToken":"didEditToken",{type:f.type,tokenType:ie.Z})}catch(k){const he=(0,v.Iz)(k.response.data);X.setErrors(he),k?.response?.data?.error?.message===He?I({type:"warning",message:k.response.data.message||"notification.error.tokennamenotunique"}):I({type:"warning",message:k?.response?.data?.message||"notification.error"}),g()}},[Xe,fe]=(0,e.useState)(!1),Qe={...te,onChange:({target:{value:P}})=>{fe(!0),L({type:"ON_CHANGE",value:P})},onChangeSelectAll:({target:{value:P}})=>{fe(!0),L({type:"SELECT_ALL_IN_PERMISSION",value:P})},setSelectedAction:({target:{value:P}})=>{L({type:"SET_SELECTED_ACTION",value:P})}},ye=F&&!x||ee&&x;return!x&&!f&&Ge!=="success"?e.createElement(R,{apiTokenName:f?.name}):e.createElement(Z,{value:Qe},e.createElement(a.o,null,e.createElement(n.SL,{name:"API Tokens"}),e.createElement(A.J9,{validationSchema:y.fK,validateOnChange:!1,initialValues:{name:f?.name||"",description:f?.description||"",type:f?.type,lifespan:f?.lifespan?f.lifespan.toString():f?.lifespan},enableReinitialize:!0,onSubmit:(P,X)=>Ye(P,X)},({errors:P,handleChange:X,isSubmitting:ne,values:k,setFieldValue:he})=>(Xe&&k?.type!=="custom"&&he("type","custom"),e.createElement(n.l0,null,e.createElement(ze.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:f,setToken:j,canEditInputs:ye,canRegenerate:le,isSubmitting:ne,regenerateUrl:"/admin/api-tokens/"}),e.createElement(M.D,null,e.createElement(d.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(f?.name)&&e.createElement(_e.Z,{token:f?.accessKey,tokenType:ie.Z}),e.createElement(Fe,{errors:P,onChange:X,canEditInputs:ye,isCreating:x,values:k,apiToken:f,onDispatch:L,setHasChangedPermissions:fe}),e.createElement(We,{disabled:!ye||k?.type==="read-only"||k?.type==="full-access"}))))))))}},75056:(O,T,t)=>{"use strict";t.d(T,{IX:()=>M,fK:()=>c,mk:()=>y});var e=t(6406),l=t(77349),n=t(51991);const M=(h,r,o="en")=>{if(r&&typeof r=="number"){const p=r/24/60/60/1e3;return(0,e.Z)((0,l.Z)(new Date(h),p),"PPP",{locale:n[o]})}return"Unlimited"};var d=t(87561),A=t(69307);const c=d.Ry().shape({name:d.Z_(A.I0.string).max(100).required(A.I0.required),type:d.Z_(A.I0.string).oneOf(["read-only","full-access","custom"]).required(A.I0.required),description:d.Z_().nullable(),lifespan:d.Rx().integer().min(0).nullable().defined(A.I0.required)}),y=h=>{const r={allActionsIds:[],permissions:[]};return r.permissions=Object.keys(h).map(o=>({apiId:o,label:o.split("::")[1],controllers:Object.keys(h[o].controllers).map(p=>({controller:p,actions:h[o].controllers[p].map(s=>{const E=`${o}.${p}.${s}`;return o.includes("api::")&&r.allActionsIds.push(E),{action:s,actionId:E}}).flat()})).flat()})),r}},74221:O=>{function T(t,e,l,n){for(var a=l-1,M=t.length;++a<M;)if(n(t[a],e))return a;return-1}O.exports=T},65464:(O,T,t)=>{var e=t(29932),l=t(42118),n=t(74221),a=t(7518),M=t(278),d=Array.prototype,A=d.splice;function m(c,v,y,h){var r=h?n:l,o=-1,p=v.length,s=c;for(c===v&&(v=M(v)),y&&(s=e(c,a(y)));++o<p;)for(var E=0,R=v[o],K=y?y(R):R;(E=r(s,K,E,h))>-1;)s!==c&&A.call(s,E,1),A.call(c,E,1);return c}O.exports=m},97019:(O,T,t)=>{var e=t(5976),l=t(4384),n=e(l);O.exports=n},4384:(O,T,t)=>{var e=t(65464);function l(n,a){return n&&n.length&&a&&a.length?e(n,a):n}O.exports=l},13217:(O,T,t)=>{var e=t(14259);function l(n){var a=n==null?0:n.length;return a?e(n,1,a):[]}O.exports=l},63128:(O,T,t)=>{"use strict";t.d(T,{U:()=>h,y:()=>v});var e=t(85893),l=t(67294),n=t(1565),a=t(7535),M=t(73879),d=t(78549),A=t(75878),m=t(50781);const c=({theme:r,expanded:o,variant:p,disabled:s,error:E})=>E?`1px solid ${r.colors.danger600} !important`:s?`1px solid ${r.colors.neutral150}`:o?`1px solid ${r.colors.primary600}`:p==="primary"?`1px solid ${r.colors.neutral0}`:`1px solid ${r.colors.neutral100}`,v=(0,n.ZP)(d.Z)``,y=(0,n.ZP)(m.x)`
  border: ${c};

  &:hover:not([aria-disabled='true']) {
    border: 1px solid ${({theme:r})=>r.colors.primary600};

    ${v} {
      color: ${({theme:r,expanded:o})=>o?void 0:r.colors.primary700};
    }

    ${d.Z} {
      color: ${({theme:r,expanded:o})=>o?void 0:r.colors.primary600};
    }

    & > ${A.k} {
      background: ${({theme:r})=>r.colors.primary100};
    }

    [data-strapi-dropdown='true'] {
      background: ${({theme:r})=>r.colors.primary200};
    }
  }
`,h=({children:r,disabled:o=!1,error:p,expanded:s=!1,hasErrorMessage:E=!0,id:R,onToggle:K,toggle:U,size:Z="M",variant:D="primary",shadow:$})=>{const S=(0,M.M)(R),z=l.useMemo(()=>({expanded:s,onToggle:K,toggle:U,id:S,size:Z,variant:D,disabled:o}),[o,s,S,K,Z,U,D]);return(0,e.jsxs)(a.S.Provider,{value:z,children:[(0,e.jsx)(y,{"data-strapi-expanded":s,disabled:o,"aria-disabled":o,expanded:s,hasRadius:!0,variant:D,error:p,shadow:$,children:r}),p&&E&&(0,e.jsx)(m.x,{paddingTop:1,children:(0,e.jsx)(d.Z,{variant:"pi",textColor:"danger600",children:p})})]})}},37362:(O,T,t)=>{"use strict";t.d(T,{v:()=>a});var e=t(85893),l=t(7535),n=t(50781);const a=({children:M,...d})=>{const{expanded:A,id:m}=(0,l.A)();if(!A)return null;const c=`accordion-content-${m}`,v=`accordion-label-${m}`,y=`accordion-desc-${m}`;return(0,e.jsx)(n.x,{role:"region",id:c,"aria-labelledby":v,"aria-describedby":y,...d,children:M})}},7535:(O,T,t)=>{"use strict";t.d(T,{A:()=>n,S:()=>l});var e=t(67294);const l=(0,e.createContext)({disabled:!1,expanded:!1,id:"",size:"M",variant:"primary"}),n=()=>(0,e.useContext)(l)},27375:(O,T,t)=>{"use strict";t.d(T,{B:()=>r});var e=t(85893),l=t(21514),n=t(1565),a=t(63128),M=t(7535);const d=({expanded:o,disabled:p,variant:s})=>{let E="neutral100";return o?E="primary100":p?E="neutral150":s==="primary"&&(E="neutral0"),E};var A=t(90139),m=t(80907),c=t(75878),v=t(78549);const y=(0,n.ZP)(A.A)`
  text-align: left;

  // necessary to make the ellipsis prop work on the title
  > span {
    max-width: 100%;
  }

  svg {
    width: ${14/16}rem;
    height: ${14/16}rem;

    path {
      fill: ${({theme:o,expanded:p})=>p?o.colors.primary600:o.colors.neutral500};
    }
  }
`,h=(0,n.ZP)(c.k)`
  min-height: ${({theme:o,size:p})=>o.sizes.accordions[p]};
  border-radius: ${({theme:o,expanded:p})=>p?`${o.borderRadius} ${o.borderRadius} 0 0`:o.borderRadius};

  &:hover {
    svg {
      path {
        fill: ${({theme:o})=>o.colors.primary600};
      }
    }
  }
`,r=({title:o,description:p,as:s="span",togglePosition:E="right",action:R,...K})=>{const{onToggle:U,toggle:Z,expanded:D,id:$,size:S,variant:z,disabled:b}=(0,M.A)(),G=`accordion-content-${$}`,Q=`accordion-label-${$}`,Te=`accordion-desc-${$}`,J=S==="M"?6:4,w=S==="M"?J:J-2,H=d({expanded:D,disabled:b,variant:z}),N={as:s,fontWeight:S==="S"?"bold":void 0,id:Q,textColor:D?"primary600":"neutral700",ellipsis:!0,variant:S==="M"?"delta":void 0},_=D?"primary600":"neutral600",ce=D?"primary200":"neutral200",se=S==="M"?`${32/16}rem`:`${24/16}rem`,ae=()=>{b||(Z&&!U?(console.warn('Deprecation warning: Usage of "toggle" prop in Accordion component is deprecated. This is discouraged and will be removed in the next major release. Please use "onToggle" instead'),Z()):U&&U())},oe=(0,e.jsx)(c.k,{justifyContent:"center",borderRadius:"50%",height:se,width:se,transform:D?"rotate(180deg)":void 0,"data-strapi-dropdown":!0,"aria-hidden":!0,as:"span",background:ce,cursor:b?"not-allowed":"pointer",onClick:ae,shrink:0,children:(0,e.jsx)(m.J,{as:l.Z,width:S==="M"?`${11/16}rem`:`${8/16}rem`,color:D?"primary600":"neutral600"})});return(0,e.jsx)(h,{paddingBottom:w,paddingLeft:J,paddingRight:J,paddingTop:w,background:H,expanded:D,size:S,justifyContent:"space-between",cursor:b?"not-allowed":"",children:(0,e.jsxs)(c.k,{gap:3,flex:1,maxWidth:"100%",children:[E==="left"&&oe,(0,e.jsx)(y,{onClick:ae,"aria-disabled":b,"aria-expanded":D,"aria-controls":G,"aria-labelledby":Q,"data-strapi-accordion-toggle":!0,expanded:D,type:"button",flex:1,minWidth:0,...K,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(a.y,{...N,children:o}),p&&(0,e.jsx)(v.Z,{as:"p",id:Te,textColor:_,children:p})]})}),E==="right"&&(0,e.jsxs)(c.k,{gap:3,children:[oe,R]}),E==="left"&&R]})})}}}]);
