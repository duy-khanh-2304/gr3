"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[1495],{30077:(ae,h,t)=>{t.r(h),t.d(h,{default:()=>J});var e=t(67294),u=t(86896),n=t(79946),x=t(46683),E=t(57713),v=t(26789),g=t(75878),S=t(50781),p=t(77270),y=t(9370),r=t(61585),f=t(28469),L=t(19442),B=t(46948),D=t(45697),d=t.n(D),N=t(1565),H=t(50614),G=t(473),s=t(47560);const O=N.default.a`
  color: ${({theme:l})=>l.colors.primary600};
`,Z=({config:l})=>{const{formatMessage:a}=(0,u.Z)();return e.createElement(g.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(g.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(p.Z,{variant:"delta",as:"h2"},a({id:(0,s.Z)("Settings.email.plugin.title.config"),defaultMessage:"Configuration"})),e.createElement(p.Z,null,a({id:(0,s.Z)("Settings.email.plugin.text.configuration"),defaultMessage:"The plugin is configured through the {file} file, checkout this {link} for the documentation."},{file:"./config/plugins.js",link:e.createElement(O,{href:"https://docs.strapi.io/developer-docs/latest/plugins/email.html",target:"_blank",rel:"noopener noreferrer"},a({id:(0,s.Z)("link"),defaultMessage:"Link"}))}))),e.createElement(y.r,{gap:5},e.createElement(r.P,{col:6,s:12},e.createElement(f.o,{name:"shipper-email",label:a({id:(0,s.Z)("Settings.email.plugin.label.defaultFrom"),defaultMessage:"Default sender email"}),placeholder:a({id:(0,s.Z)("Settings.email.plugin.placeholder.defaultFrom"),defaultMessage:"ex: Strapi No-Reply '<'no-reply@strapi.io'>'"}),disabled:!0,onChange:()=>{},value:l.settings.defaultFrom})),e.createElement(r.P,{col:6,s:12},e.createElement(f.o,{name:"response-email",label:a({id:(0,s.Z)("Settings.email.plugin.label.defaultReplyTo"),defaultMessage:"Default response email"}),placeholder:a({id:(0,s.Z)("Settings.email.plugin.placeholder.defaultReplyTo"),defaultMessage:"ex: Strapi '<'example@strapi.io'>'"}),disabled:!0,onChange:()=>{},value:l.settings.defaultReplyTo})),e.createElement(r.P,{col:6,s:12},e.createElement(H.P,{name:"email-provider",label:a({id:(0,s.Z)("Settings.email.plugin.label.provider"),defaultMessage:"Email provider"}),disabled:!0,onChange:()=>{},value:l.provider},e.createElement(G.W,{value:l.provider},l.provider)))))};Z.propTypes={config:d().shape({provider:d().string,settings:d().shape({defaultFrom:d().string,defaultReplyTo:d().string})}).isRequired};const V=Z;var M=t(87561);const T=M.Ry().shape({email:M.Z_().email(n.translatedErrors.email).required(n.translatedErrors.required)});var W=t(61321);const $=async()=>{const{get:l}=(0,n.getFetchClient)(),{data:a}=await l("/email/settings");return a.config},j=async l=>{const{post:a}=(0,n.getFetchClient)();await a("/email/test",l)};var z=t(79371);const C=()=>{const{formatMessage:l}=(0,u.Z)();return e.createElement(e.Fragment,null,e.createElement(n.SettingsPageTitle,{name:l({id:(0,s.Z)("Settings.email.plugin.title"),defaultMessage:"Configuration"})}),e.createElement(z.T,{id:"title",title:l({id:(0,s.Z)("Settings.email.plugin.title"),defaultMessage:"Configuration"}),subtitle:l({id:(0,s.Z)("Settings.email.plugin.subTitle"),defaultMessage:"Test the settings for the Email plugin"})}))},Y=()=>e.createElement(n.CheckPagePermissions,{permissions:W.Z.settings},e.createElement(k,null)),k=()=>{const l=(0,n.useNotification)(),{formatMessage:a}=(0,u.Z)(),{lockApp:K,unlockApp:Q}=(0,n.useOverlayBlocker)(),{notifyStatus:F}=(0,x.G)();(0,n.useFocusWhenNavigate)();const[m,U]=(0,e.useState)({}),[X,I]=(0,e.useState)(!1),[P,R]=(0,e.useState)(!1),[i,b]=(0,e.useState)(""),[w,A]=(0,e.useState)(!1),[q,_]=(0,e.useState)({provider:"",settings:{defaultFrom:"",defaultReplyTo:"",testAddress:""}});(0,e.useEffect)(()=>{I(!0),$().then(o=>{F(a({id:(0,s.Z)("Settings.email.plugin.notification.data.loaded"),defaultMessage:"Email settings data has been loaded"})),_(o);const c=o?.settings?.testAddress;c&&b(c)}).catch(()=>l({type:"warning",message:a({id:(0,s.Z)("Settings.email.plugin.notification.config.error"),defaultMessage:"Failed to retrieve the email config"})})).finally(()=>I(!1))},[a,l,F]),(0,e.useEffect)(()=>{m.email&&document.querySelector("#test-address-input").focus()},[m]),(0,e.useEffect)(()=>{T.validate({email:i},{abortEarly:!1}).then(()=>A(!0)).catch(()=>A(!1))},[i]);const ee=o=>{b(()=>o.target.value)},te=async o=>{o.preventDefault();try{await T.validate({email:i},{abortEarly:!1}),R(!0),K(),j({to:i}).then(()=>{l({type:"success",message:a({id:(0,s.Z)("Settings.email.plugin.notification.test.success"),defaultMessage:"Email test succeeded, check the {to} mailbox"},{to:i})})}).catch(()=>{l({type:"warning",message:a({id:(0,s.Z)("Settings.email.plugin.notification.test.error"),defaultMessage:"Failed to send a test mail to {to}"},{to:i})})}).finally(()=>{R(!1),Q()})}catch(c){U((0,n.getYupInnerErrors)(c))}};return X?e.createElement(E.o,{labelledBy:"title","aria-busy":"true"},e.createElement(C,null),e.createElement(v.D,null,e.createElement(n.LoadingIndicatorPage,null))):e.createElement(E.o,{labelledBy:"title","aria-busy":P},e.createElement(C,null),e.createElement(v.D,null,e.createElement("form",{onSubmit:te},e.createElement(g.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(S.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(V,{config:q})),e.createElement(S.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(g.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(p.Z,{variant:"delta",as:"h2"},a({id:(0,s.Z)("Settings.email.plugin.title.test"),defaultMessage:"Test email delivery"})),e.createElement(y.r,{gap:5,alignItems:"end"},e.createElement(r.P,{col:6,s:12},e.createElement(f.o,{id:"test-address-input",name:"test-address",onChange:ee,label:a({id:(0,s.Z)("Settings.email.plugin.label.testAddress"),defaultMessage:"Recipient email"}),value:i,error:m.email?.id&&a({id:(0,s.Z)(`${m.email?.id}`),defaultMessage:"This is an invalid email"}),placeholder:a({id:(0,s.Z)("Settings.email.plugin.placeholder.testAddress"),defaultMessage:"ex: developer@example.com"})})),e.createElement(r.P,{col:7,s:12},e.createElement(L.z,{loading:P,disabled:!w,type:"submit",startIcon:e.createElement(B.Z,null)},a({id:(0,s.Z)("Settings.email.plugin.button.test-email"),defaultMessage:"Send test email"}))))))))))},J=Y}}]);
