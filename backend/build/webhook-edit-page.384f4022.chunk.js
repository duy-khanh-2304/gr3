"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[5162],{81788:(H,S,a)=>{a.d(S,{Z:()=>Re});var e=a(67294),i=a(79946),T=a(57713),b=a(88767),O=a(16550),x=a(48474),ee=a(45697),l=a.n(ee),te=a(85362),z=a(8675),ae=a(60793),ne=a(79371),h=a(75878),N=a(19442),se=a(26789),D=a(50781),F=a(9370),k=a(61585),B=a(28469),P=a(41054),A=a(86896),X=a(29516),y=a(77270),Q=a(1565),re=a(13539),le=a(62779),oe=a(11700),ie=a.n(oe);const W=({disabledEvents:t,name:n,events:s,inputValue:r,handleChange:d,handleChangeAll:p})=>{const o=s.filter(u=>!t.includes(u)),c=r.length===o.length,g=r.length>0,v=({target:{name:u}})=>{p({target:{name:u,value:!c}})};return e.createElement("tr",null,e.createElement("td",null,e.createElement(re.X,{indeterminate:g&&!c,"aria-label":"Select all entries",name:n,onChange:v,value:c},ie()(n))),s.map(u=>e.createElement("td",{key:u},e.createElement(le.C,{disabled:t.includes(u),"aria-label":u,name:u,value:r.includes(u),onValueChange:E=>d({target:{name:u,value:E}})}))))};W.defaultProps={disabledEvents:[],events:[],inputValue:[],handleChange(){},handleChangeAll(){}},W.propTypes={disabledEvents:l().array,events:l().array,inputValue:l().array,handleChange:l().func,handleChangeAll:l().func,name:l().string.isRequired};const de=W,ce=t=>t.reduce((n,s)=>{const r=s.split(".")[0];return n[r]||(n[r]=[]),n[r].push(s),n},{}),ue=Q.default.table`
  td {
    height: ${52/16}rem;
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr:nth-child(odd) {
    background: ${({theme:t})=>t.colors.neutral100};
  }

  tbody tr td:first-child {
    padding-left: ${({theme:t})=>t.spaces[7]};
  }
`,L={headers:{default:[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}],draftAndPublish:[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"},{id:"app.utils.publish",defaultMessage:"Publish"},{id:"app.utils.unpublish",defaultMessage:"Unpublish"}]},events:{default:{entry:["entry.create","entry.update","entry.delete"],media:["media.create","media.update","media.delete"]},draftAndPublish:{entry:["entry.create","entry.update","entry.delete","entry.publish","entry.unpublish"],media:["media.create","media.update","media.delete"]}}},G=({isDraftAndPublish:t})=>{const n=t?L.headers.draftAndPublish:L.headers.default,s=t?L.events.draftAndPublish:L.events.default,{formatMessage:r}=(0,A.Z)(),{values:d,handleChange:p}=(0,P.useFormikContext)(),o="events",c=d.events,g=[],v=ce(c),u=({target:{name:m,value:Z}})=>{let M=new Set(c);Z?M.add(m):M.delete(m),p({target:{name:o,value:Array.from(M)}})},E=({target:{name:m,value:Z}})=>{let M=new Set(c);Z?s[m].forEach(I=>{g.includes(I)||M.add(I)}):s[m].forEach(I=>M.delete(I)),p({target:{name:o,value:Array.from(M)}})};return e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(X.Q,null,r({id:"Settings.webhooks.form.events",defaultMessage:"Events"})),e.createElement(ue,null,e.createElement("thead",null,e.createElement("tr",null,e.createElement("td",null),n.map(m=>m==="app.utils.publish"||m==="app.utils.unpublish"?e.createElement("td",{key:m.id,title:r({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},r(m))):e.createElement("td",{key:m.id},e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},r(m)))))),e.createElement("tbody",null,Object.keys(s).map(m=>e.createElement(de,{disabledEvents:g,key:m,name:m,events:s[m],inputValue:v[m],handleChange:u,handleChangeAll:E})))))};G.propTypes={isDraftAndPublish:l().bool.isRequired};const me=G;var ge=a(12978),he=a(90139),Ee=a(63122),pe=a(85612);const J=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],U=({name:t,onChange:n,value:s,...r})=>{const[d,p]=(0,e.useState)(s?[...J,s]:J),o=g=>{n({target:{name:t,value:g}})},c=g=>{p(v=>[...v,g]),n({target:{name:t,value:g}})};return e.createElement(Ee.XU,{...r,onChange:o,onCreateOption:c,placeholder:"",value:s},d.map(g=>e.createElement(pe.O,{value:g,key:g},g)))};U.defaultProps={value:void 0},U.propTypes={name:l().string.isRequired,onChange:l().func.isRequired,value:l().string};const fe=U,ve=()=>{const{formatMessage:t}=(0,A.Z)(),{values:n,errors:s}=(0,P.useFormikContext)();return e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(X.Q,null,t({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(D.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(P.FieldArray,{validateOnChange:!1,name:"headers",render:({push:r,remove:d})=>e.createElement(F.r,{gap:4},n.headers?.map((p,o)=>e.createElement(e.Fragment,{key:o},e.createElement(k.P,{col:6},e.createElement(P.Field,{as:fe,name:`headers.${o}.key`,"aria-label":`row ${o+1} key`,label:t({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:s.headers?.[o]?.key&&t({id:s.headers[o]?.key,defaultMessage:s.headers[o]?.key})})),e.createElement(k.P,{col:6},e.createElement(h.k,{alignItems:"flex-end"},e.createElement(D.x,{style:{flex:1}},e.createElement(P.Field,{as:B.o,"aria-label":`row ${o+1} value`,label:t({id:"Settings.webhooks.value",defaultMessage:"Value"}),name:`headers.${o}.value`,error:s.headers?.[o]?.value&&t({id:s.headers[o]?.value,defaultMessage:s.headers[o]?.value})})),e.createElement(h.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:s.headers?.[o]?.value?0:5},e.createElement(i.RemoveRoundedButton,{onClick:()=>n.headers.length!==1&&d(o),label:t({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:o+1})})))))),e.createElement(k.P,{col:12},e.createElement(he.A,{type:"button",onClick:()=>{r({key:"",value:""})},startIcon:e.createElement(ge.Z,null)},t({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var be=a(64518),Y=a(15800);const w=Q.default.svg(({theme:t,color:n})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${t.colors[n]};
  }
`),V=({isPending:t,statusCode:n})=>{const{formatMessage:s}=(0,A.Z)();return t?e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(w,{as:be.Z}),e.createElement(y.Z,null,s({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):n>=200&&n<300?e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(w,{as:z.Z,color:"success700"}),e.createElement(y.Z,null,s({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):n>=300?e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(w,{as:Y.Z,color:"danger700"}),e.createElement(y.Z,null,s({id:"Settings.error",defaultMessage:"error"})," ",n)):null};V.propTypes={isPending:l().bool.isRequired,statusCode:l().number},V.defaultProps={statusCode:void 0};const $=({statusCode:t,message:n})=>{const{formatMessage:s}=(0,A.Z)();return t>=200&&t<300?e.createElement(h.k,{justifyContent:"flex-end"},e.createElement(y.Z,{textColor:"neutral600",ellipsis:!0},s({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):t>=300?e.createElement(h.k,{justifyContent:"flex-end"},e.createElement(h.k,{maxWidth:(0,i.pxToRem)(250),justifyContent:"flex-end",title:n},e.createElement(y.Z,{ellipsis:!0,textColor:"neutral600"},n))):null};$.propTypes={statusCode:l().number,message:l().string},$.defaultProps={statusCode:void 0,message:void 0};const q=({onCancel:t})=>{const{formatMessage:n}=(0,A.Z)();return e.createElement(h.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:t,type:"button"},e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(y.Z,{textColor:"neutral400"},n({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(w,{as:Y.Z,color:"neutral400"}))))};q.propTypes={onCancel:l().func.isRequired};const K=({isPending:t,onCancel:n,response:s})=>{const{statusCode:r,message:d}=s,{formatMessage:p}=(0,A.Z)();return e.createElement(D.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(F.r,{gap:4,style:{alignItems:"center"}},e.createElement(k.P,{col:3},e.createElement(y.Z,null,p({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(k.P,{col:3},e.createElement(V,{isPending:t,statusCode:r})),e.createElement(k.P,{col:6},t?e.createElement(q,{onCancel:n}):e.createElement($,{statusCode:r,message:d}))))};K.defaultProps={isPending:!1,onCancel(){},response:{}},K.propTypes={isPending:l().bool,onCancel:l().func,response:l().object};const ye=K;var C=a(87561);const Ce=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Me=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,ke=C.Ry().shape({name:C.Z_(i.translatedErrors.string).required(i.translatedErrors.required).matches(Ce,i.translatedErrors.regex),url:C.Z_(i.translatedErrors.string).required(i.translatedErrors.required).matches(Me,i.translatedErrors.regex),headers:C.Vo(t=>{let n=C.IX();if(t.length===1){const{key:s,value:r}=t[0];if(!s&&!r)return n}return n.of(C.Ry().shape({key:C.Z_().required(i.translatedErrors.required),value:C.Z_().required(i.translatedErrors.required)}))}),events:C.IX()}),j=({handleSubmit:t,data:n,triggerWebhook:s,isCreating:r,isTriggering:d,triggerResponse:p,isDraftAndPublishEvents:o})=>{const{formatMessage:c}=(0,A.Z)(),[g,v]=(0,e.useState)(!1);return e.createElement(P.Formik,{onSubmit:t,initialValues:{name:n?.name||"",url:n?.url||"",headers:Object.keys(n?.headers||[]).length?Object.entries(n.headers).map(([u,E])=>({key:u,value:E})):[{key:"",value:""}],events:n?.events||[]},validationSchema:ke,validateOnChange:!1,validateOnBlur:!1},({handleSubmit:u,errors:E})=>e.createElement(i.Form,{noValidate:!0},e.createElement(ne.T,{primaryAction:e.createElement(h.k,{gap:2},e.createElement(N.z,{onClick:()=>{s(),v(!0)},variant:"tertiary",startIcon:e.createElement(te.Z,null),disabled:r||d,size:"L"},c({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(N.z,{startIcon:e.createElement(z.Z,null),onClick:u,type:"submit",size:"L"},c({id:"global.save",defaultMessage:"Save"}))),title:r?c({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):n?.name,navigationAction:e.createElement(i.Link,{startIcon:e.createElement(ae.Z,null),to:"/settings/webhooks"},c({id:"global.back",defaultMessage:"Back"}))}),e.createElement(se.D,null,e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:4},g&&e.createElement("div",{className:"trigger-wrapper"},e.createElement(ye,{isPending:d,response:p,onCancel:()=>v(!1)})),e.createElement(D.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(F.r,{gap:6},e.createElement(k.P,{col:6},e.createElement(P.Field,{as:B.o,name:"name",error:E.name&&c({id:E.name}),label:c({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(k.P,{col:12},e.createElement(P.Field,{as:B.o,name:"url",error:E.url&&c({id:E.url}),label:c({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(ve,null),e.createElement(me,{isDraftAndPublish:o})))))))};j.propTypes={data:l().object,handleSubmit:l().func.isRequired,triggerWebhook:l().func.isRequired,isCreating:l().bool.isRequired,isDraftAndPublishEvents:l().bool.isRequired,isTriggering:l().bool.isRequired,triggerResponse:l().object},j.defaultProps={data:void 0,triggerResponse:void 0};const Pe=j,Se=t=>({...t,headers:Ae(t.headers)}),Ae=t=>t.reduce((n,s)=>{const{key:r,value:d}=s;return r!==""?{...n,[r]:d}:n},{}),_=Se,Re=()=>{const{params:{id:t}}=(0,O.$B)("/settings/webhooks/:id"),{replace:n}=(0,O.k6)(),{lockApp:s,unlockApp:r}=(0,i.useOverlayBlocker)(),d=(0,i.useNotification)(),p=(0,b.useQueryClient)(),{isLoading:o,collectionTypes:c}=(0,x.bP)(),{put:g,get:v,post:u}=(0,i.useFetchClient)(),E=t==="create",{isLoading:m,data:Z}=(0,b.useQuery)(["get-webhook",t],async()=>{try{const{data:{data:f}}=await v(`/admin/webhooks/${t}`);return f}catch{return d({type:"warning",message:{id:"notification.error"}}),null}},{enabled:!E}),{isLoading:M,data:I,isIdle:Ie,mutate:Te}=(0,b.useMutation)(()=>u(`/admin/webhooks/${t}/trigger`)),xe=()=>Te(null,{onError(){d({type:"warning",message:{id:"notification.error"}})}}),Ze=(0,b.useMutation)(f=>u("/admin/webhooks",f)),Oe=(0,b.useMutation)(({id:f,body:R})=>g(`/admin/webhooks/${f}`,R)),De=async f=>{E?(s(),Ze.mutate(_(f),{onSuccess({data:R}){d({type:"success",message:{id:"Settings.webhooks.created"}}),n(`/settings/webhooks/${R.data.id}`),r()},onError(R){d({type:"warning",message:{id:"notification.error"}}),console.log(R),r()}})):(s(),Oe.mutate({id:t,body:_(f)},{onSuccess(){p.invalidateQueries(["get-webhook",t]),d({type:"success",message:{id:"notification.form.success.fields"}}),r()},onError(R){d({type:"warning",message:{id:"notification.error"}}),console.log(R),r()}}))},Le=e.useMemo(()=>c.some(f=>f.options.draftAndPublish===!0),[c]);return m||o?e.createElement(i.LoadingIndicatorPage,null):e.createElement(T.o,null,e.createElement(i.SettingsPageTitle,{name:"Webhooks"}),e.createElement(Pe,{handleSubmit:De,data:Z,triggerWebhook:xe,isCreating:E,isTriggering:M,isTriggerIdle:Ie,triggerResponse:I?.data.data,isDraftAndPublishEvents:Le}))}},3672:(H,S,a)=>{a.r(S),a.d(S,{default:()=>x});var e=a(67294),i=a(79946),T=a(87751),b=a(81788);const x=()=>e.createElement(i.CheckPagePermissions,{permissions:T.Z.settings.webhooks.create},e.createElement(b.Z,null))},42122:(H,S,a)=>{a.r(S),a.d(S,{default:()=>x});var e=a(67294),i=a(79946),T=a(87751),b=a(81788);const x=()=>e.createElement(i.CheckPagePermissions,{permissions:T.Z.settings.webhooks.update},e.createElement(b.Z,null))}}]);
