"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[5199],{67875:(T,n,e)=>{e.d(n,{Z:()=>a});const a=()=>null},94699:(T,n,e)=>{e.d(n,{Z:()=>v});var t=e(67294),a=e(45697),s=e.n(a),g=e(86896),f=e(50781),p=e(19442),d=e(36002),c=e(79946);const M=({displayedFilters:C})=>{const[I,W]=(0,t.useState)(!1),{formatMessage:S}=(0,g.Z)(),O=(0,t.useRef)(),y=()=>{W(A=>!A)};return t.createElement(t.Fragment,null,t.createElement(f.x,{paddingTop:1,paddingBottom:1},t.createElement(p.z,{variant:"tertiary",ref:O,startIcon:t.createElement(d.Z,null),onClick:y,size:"S"},S({id:"app.utils.filters",defaultMessage:"Filters"})),I&&t.createElement(c.FilterPopoverURLQuery,{displayedFilters:C,isVisible:I,onToggle:y,source:O})),t.createElement(c.FilterListURLQuery,{filtersSchema:C}))};M.propTypes={displayedFilters:s().arrayOf(s().shape({name:s().string.isRequired,metadatas:s().shape({label:s().string}),fieldSchema:s().shape({type:s().string})})).isRequired};const v=M},4214:(T,n,e)=>{e.d(n,{Z:()=>c});var t=e(67294),a=e(86896),s=e(45697),g=e.n(s),f=e(19442),p=e(46948);const d=({onClick:M})=>{const{formatMessage:v}=(0,a.Z)();return t.createElement(f.z,{onClick:M,startIcon:t.createElement(p.Z,null),size:"S"},v({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}))};d.propTypes={onClick:g().func.isRequired};const c=d},57338:(T,n,e)=>{e.d(n,{Z:()=>a});const a={firstname:"",lastname:"",email:"",roles:[]}},55867:(T,n,e)=>{e.d(n,{Z:()=>a});const a=[]},37735:(T,n,e)=>{e.r(n),e.d(n,{default:()=>tt});var t=e(67294),a=e(79946),s=e(87751),g=e(15861),f=e(4942),p=e(70885),d=e(64687),c=e.n(d),M=e(46683),v=e(57713),C=e(79371),I=e(15483),W=e(26789),S=e(16550),O=e(86896),y=e(88767),A=e(45697),l=e.n(A),se=e(94487),J=e(6090),ne=e(62351),pe=e(62779),B=e(77270),X=e(75878),de=e(37527),$=e(50781),fe=e(36670),Me=e(34263),L=e(19631);const ve=({canDelete:r,headers:i,entriesToDelete:u,onClickDelete:m,onSelectRow:N,withMainAction:Y,withBulkActions:x,rows:oe})=>{const{push:z,location:{pathname:H}}=(0,S.k6)(),{formatMessage:U}=(0,O.Z)();return t.createElement(se.p,null,oe.map(o=>{const G=u.findIndex(K=>K===o.id)!==-1;return t.createElement(J.Tr,{key:o.id,...(0,a.onRowClick)({fn:()=>z(`${H}/${o.id}`),condition:x})},Y&&t.createElement(ne.Td,{...a.stopPropagation},t.createElement(pe.C,{"aria-label":U({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,L.Pp)(o.firstname,o.lastname)}),checked:G,onChange:()=>{N({name:o.id,value:!G})}})),i.map(({key:K,cellFormatter:w,name:Z,...k})=>t.createElement(ne.Td,{key:K},typeof w=="function"?w(o,{key:K,name:Z,formatMessage:U,...k}):t.createElement(B.Z,{textColor:"neutral800"},o[Z]||"-"))),x&&t.createElement(ne.Td,null,t.createElement(X.k,{justifyContent:"end"},t.createElement(de.h,{onClick:()=>z(`${H}/${o.id}`),label:U({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,L.Pp)(o.firstname,o.lastname)}),noBorder:!0,icon:t.createElement(fe.Z,null)}),r&&t.createElement($.x,{paddingLeft:1,...a.stopPropagation},t.createElement(de.h,{onClick:()=>m(o.id),label:U({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,L.Pp)(o.firstname,o.lastname)}),noBorder:!0,icon:t.createElement(Me.Z,null)})))))}))};ve.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},ve.propTypes={canDelete:l().bool,entriesToDelete:l().array,headers:l().array.isRequired,onClickDelete:l().func,onSelectRow:l().func,rows:l().array,withBulkActions:l().bool,withMainAction:l().bool};const Be=ve;var Ue=e(94699),ce=e(87462),Pe=e(19442),Ie=e(60881),We=e(18189),Ae=e(78784),Ke=e(48683),Le=e(9370),De=e(61585),Ze=e(45124),Fe=e(41054),be=e(81288);const $e=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]];var re=e(87561);const Ne=re.Ry().shape({firstname:re.Z_().trim().required(a.translatedErrors.required),lastname:re.Z_(),email:re.Z_().email(a.translatedErrors.email).required(a.translatedErrors.required),roles:re.IX().min(1,a.translatedErrors.required).required(a.translatedErrors.required)}),xe={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}};var ze=function(){return window&&window.strapi&&window.strapi.isEE?e(97083).Z:e(57338).Z}(),Qe=function(){return window&&window.strapi&&window.strapi.isEE?e(810).Z:e(55867).Z}(),je=function(){return window&&window.strapi&&window.strapi.isEE?e(12201).Z:e(31605).Z}(),_e=function(i){var u=i.queryName,m=i.onToggle,N=(0,t.useState)("create"),Y=(0,p.Z)(N,2),x=Y[0],oe=Y[1],z=(0,t.useState)(!1),H=(0,p.Z)(z,2),U=H[0],o=H[1],G=(0,t.useState)(null),K=(0,p.Z)(G,2),w=K[0],Z=K[1],k=(0,y.useQueryClient)(),me=(0,O.Z)(),Q=me.formatMessage,ye=(0,a.useNotification)(),q=(0,a.useOverlayBlocker)(),Ee=q.lockApp,ee=q.unlockApp,he=(0,a.useFetchClient)(),le=he.post,te=(0,y.useMutation)(function(P){return le("/admin/users",P)},{onSuccess:function(F){return(0,g.Z)(c().mark(function j(){var b;return c().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return b=F.data,Z(b.data.registrationToken),E.next=4,k.refetchQueries(u);case 4:return E.next=6,k.refetchQueries(["ee","license-limit-info"]);case 6:ge(),o(!1);case 8:case"end":return E.stop()}},j)}))()},onError:function(F){throw o(!1),ye({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),F},onSettled:function(){ee()}}),_=Q({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),Te=function(){var P=(0,g.Z)(c().mark(function F(j,b){var V,E,Ce;return c().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return V=b.setErrors,Ee(),o(!0),h.prev=3,h.next=6,te.mutateAsync(j);case 6:h.next=12;break;case 8:h.prev=8,h.t0=h.catch(3),ee(),(h.t0===null||h.t0===void 0||(E=h.t0.response)===null||E===void 0||(Ce=E.data)===null||Ce===void 0?void 0:Ce.error.message)==="Email already taken"&&V({email:h.t0.response.data.error.message});case 12:case"end":return h.stop()}},F,null,[[3,8]])}));return function(j,b){return P.apply(this,arguments)}}(),ge=function(){R?oe(R):m()},ae=xe[x],ie=ae.buttonSubmitLabel,D=ae.isDisabled,R=ae.next,Se=x==="create"?t.createElement(Pe.z,{type:"submit",loading:U},Q(ie)):t.createElement(Pe.z,{type:"button",loading:U,onClick:m},Q(ie));return t.createElement(Ie.P,{onClose:m,labelledBy:"title"},t.createElement(We.x,null,t.createElement(Ae.O,{label:_},t.createElement(Ae.$,null,_))),t.createElement(Fe.Formik,{initialValues:ze,onSubmit:Te,validationSchema:Ne,validateOnChange:!1},function(P){var F=P.errors,j=P.handleChange,b=P.values;return t.createElement(a.Form,null,t.createElement(Ke.f,null,t.createElement(X.k,{direction:"column",alignItems:"stretch",gap:6},x!=="create"&&t.createElement(je,{registrationToken:w}),t.createElement($.x,null,t.createElement(B.Z,{variant:"beta",as:"h2"},Q({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})),t.createElement($.x,{paddingTop:4},t.createElement(X.k,{direction:"column",alignItems:"stretch",gap:1},t.createElement(Le.r,{gap:5},$e.map(function(V){return V.map(function(E){return t.createElement(De.P,(0,ce.Z)({key:E.name},E.size),t.createElement(a.GenericInput,(0,ce.Z)({},E,{disabled:D,error:F[E.name],onChange:j,value:b[E.name]})))})}))))),t.createElement($.x,null,t.createElement(B.Z,{variant:"beta",as:"h2"},Q({id:"global.roles",defaultMessage:"User's role"})),t.createElement($.x,{paddingTop:4},t.createElement(Le.r,{gap:5},t.createElement(De.P,{col:6,xs:12},t.createElement(be.Z,{disabled:D,error:F.roles,onChange:j,value:b.roles})),Qe.map(function(V){return V.map(function(E){return t.createElement(De.P,(0,ce.Z)({key:E.name},E.size),t.createElement(a.GenericInput,(0,ce.Z)({},E,{disabled:D,onChange:j,value:b[E.name]})))})})))))),t.createElement(Ze.m,{startActions:t.createElement(Pe.z,{variant:"tertiary",onClick:m,type:"button"},Q({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:Se}))}))};_e.propTypes={onToggle:l().func.isRequired,queryName:l().array.isRequired};const Xe=_e,Oe=({pagination:r})=>t.createElement($.x,{paddingTop:4},t.createElement(X.k,{alignItems:"flex-end",justifyContent:"space-between"},t.createElement(a.PageSizeURLQuery,null),t.createElement(a.PaginationURLQuery,{pagination:r})));Oe.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},Oe.propTypes={pagination:l().shape({page:l().number,pageCount:l().number,pageSize:l().number,total:l().number})};const He=Oe,Ge=async(r,i)=>{const{get:u}=(0,a.getFetchClient)(),{data:{data:m}}=await u(`/admin/users${r}`);return i(),m},Ve=async r=>{const{post:i}=(0,a.getFetchClient)();await i("/admin/users/batch-delete",{ids:r})},Je=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Ye=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:r},{formatMessage:i}){return t.createElement(B.Z,{textColor:"neutral800"},r.map(u=>i({id:`Settings.permissions.users.${u.code}`,defaultMessage:u.name})).join(`,
`))}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:r},{formatMessage:i}){return t.createElement(X.k,null,t.createElement(a.Status,{isActive:r,variant:r?"success":"danger"}),t.createElement(B.Z,{textColor:"neutral800"},i({id:r?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:r?"Active":"Inactive"})))}}];function Re(r,i){var u=Object.keys(r);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(r);i&&(m=m.filter(function(N){return Object.getOwnPropertyDescriptor(r,N).enumerable})),u.push.apply(u,m)}return u}function ue(r){for(var i=1;i<arguments.length;i++){var u=arguments[i]!=null?arguments[i]:{};i%2?Re(Object(u),!0).forEach(function(m){(0,f.Z)(r,m,u[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(u)):Re(Object(u)).forEach(function(m){Object.defineProperty(r,m,Object.getOwnPropertyDescriptor(u,m))})}return r}var we=function(){return window&&window.strapi&&window.strapi.isEE?e(49823).Z:e(4214).Z}(),ke=function(){return window&&window.strapi&&window.strapi.isEE?e(94018).Z:e(67875).Z}(),qe=function(){var i=(0,a.useAPIErrorHandler)(),u=i.formatAPIError,m=(0,t.useState)(!1),N=(0,p.Z)(m,2),Y=N[0],x=N[1],oe=(0,a.useRBAC)(s.Z.settings.users),z=oe.allowedActions,H=z.canCreate,U=z.canDelete,o=z.canRead,G=(0,y.useQueryClient)(),K=(0,a.useNotification)(),w=(0,O.Z)(),Z=w.formatMessage,k=(0,S.TH)(),me=k.search;(0,a.useFocusWhenNavigate)(),ke();var Q=(0,M.G)(),ye=Q.notifyStatus,q=["users",me],Ee=Ye.map(function(D){return ue(ue({},D),{},{metadatas:ue(ue({},D.metadatas),{},{label:Z(D.metadatas.label)})})}),ee=Z({id:"global.users",defaultMessage:"Users"}),he=function(){ye(Z({id:"app.utils.notify.data-loaded",defaultMessage:"The {target} has loaded"},{target:ee}))},le=(0,y.useQuery)(q,function(){return Ge(me,he)},{enabled:o,retry:!1,onError:function(R){K({type:"warning",message:{id:"notification.error",message:u(R),defaultMessage:"An error occured"}})}}),te=le.status,_=le.data,Te=le.isFetching,ge=function(){x(function(R){return!R})},ae=(0,y.useMutation)(function(D){return Ve(D)},{onSuccess:function(){return(0,g.Z)(c().mark(function R(){return c().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,G.refetchQueries(q);case 2:return P.next=4,G.refetchQueries(["ee","license-limit-info"]);case 4:case"end":return P.stop()}},R)}))()},onError:function(R){K({type:"warning",message:{id:"notification.error",message:u(R),defaultMessage:"An error occured"}})}}),ie=te!=="success"&&te!=="error"||te==="success"&&Te;return t.createElement(v.o,{"aria-busy":ie},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(C.T,{primaryAction:H&&t.createElement(we,{onClick:ge}),title:ee,subtitle:Z({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),o&&t.createElement(I.Z,{startActions:t.createElement(t.Fragment,null,t.createElement(a.SearchURLQuery,{label:Z({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ee})}),t.createElement(Ue.Z,{displayedFilters:Je}))}),t.createElement(W.D,{canRead:o},!o&&t.createElement(a.NoPermissions,null),te==="error"&&t.createElement("div",null,"TODO: An error occurred"),o&&t.createElement(t.Fragment,null,t.createElement(a.DynamicTable,{contentType:"Users",isLoading:ie,onConfirmDeleteAll:ae.mutateAsync,onConfirmDelete:function(R){return ae.mutateAsync([R])},headers:Ee,rows:_?.results,withBulkActions:!0,withMainAction:U},t.createElement(Be,{canDelete:U,headers:Ee,rows:_?.results||[],withBulkActions:!0,withMainAction:U})),t.createElement(He,{pagination:_?.pagination}))),Y&&t.createElement(Xe,{onToggle:ge,queryName:q}))};const et=qe,tt=()=>t.createElement(a.CheckPagePermissions,{permissions:s.Z.settings.users.main},t.createElement(et,null))},82464:(T,n,e)=>{e.d(n,{Z:()=>C});var t=e(67294),a=e(45697),s=e.n(a),g=e(37527),f=e(79946),p=e(70780),d=e(74855),c=e.n(d),M=e(86896);const v=({children:I,target:W})=>{const S=(0,f.useNotification)(),{formatMessage:O}=(0,M.Z)(),y=()=>{S({type:"info",message:{id:"notification.link-copied"}})},A=O({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return t.createElement(f.ContentBox,{endAction:t.createElement(d.CopyToClipboard,{onCopy:y,text:W},t.createElement(g.h,{label:A,noBorder:!0,icon:t.createElement(p.Z,null)})),title:W,titleEllipsis:!0,subtitle:I,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};v.propTypes={children:s().oneOfType([s().element,s().string]).isRequired,target:s().string.isRequired};const C=v},31605:(T,n,e)=>{e.d(n,{Z:()=>c});var t=e(67294),a=e(86896),s=e(45697),g=e.n(s),f=e(63871),p=e(82464);const d=({registrationToken:M})=>{const{formatMessage:v}=(0,a.Z)(),C=`${window.location.origin}${f.Z}auth/register?registrationToken=${M}`;return t.createElement(p.Z,{target:C},v({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};d.defaultProps={registrationToken:""},d.propTypes={registrationToken:g().string};const c=d},81288:(T,n,e)=>{e.d(n,{Z:()=>y});var t=e(67294),a=e(45697),s=e.n(a),g=e(86896),f=e(50614),p=e(473),d=e(88767),c=e(1565),M=e(64518),v=e(79946);const C=c.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,I=c.default.div`
  animation: ${C} 2s infinite linear;
`,W=()=>t.createElement(I,null,t.createElement(M.Z,null)),S=async()=>{const{get:A}=(0,v.getFetchClient)(),{data:l}=await A("/admin/roles");return l.data},O=({disabled:A,error:l,onChange:se,value:J})=>{const{status:ne,data:pe}=(0,d.useQuery)(["roles"],S,{staleTime:5e4}),{formatMessage:B}=(0,g.Z)(),X=l?B({id:l,defaultMessage:l}):"",de=B({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),$=B({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),fe=B({id:"app.components.Select.placeholder",defaultMessage:"Select"}),Me=ne==="loading"?t.createElement(W,null):void 0;return t.createElement(f.P,{id:"roles",disabled:A,error:X,hint:$,label:de,name:"roles",onChange:L=>{se({target:{name:"roles",value:L}})},placeholder:fe,multi:!0,startIcon:Me,value:J.map(L=>L.toString()),withTags:!0,required:!0},(pe||[]).map(L=>t.createElement(p.W,{key:L.id,value:L.id.toString()},B({id:`global.${L.code}`,defaultMessage:L.name}))))};O.defaultProps={disabled:!1,error:void 0},O.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const y=O},49823:(T,n,e)=>{e.d(n,{Z:()=>O});var t=e(67294),a=e(86896),s=e(45697),g=e.n(s),f=e(75878),p=e(74273),d=e(80907),c=e(19442),M=e(91330),v=e(46948),C=e(14293),I=e.n(C),W=e(69483);const S=({onClick:y})=>{const{formatMessage:A}=(0,a.Z)(),{license:l}=(0,W.q5)(),{permittedSeats:se,shouldStopCreate:J}=l?.data??{};return t.createElement(f.k,{gap:2},!I()(se)&&J&&t.createElement(p.u,{description:A({id:"Settings.application.admin-seats.at-limit-tooltip",defaultMessage:"At limit: add seats to invite more users"}),position:"left"},t.createElement(d.J,{width:`${14/16}rem`,height:`${14/16}rem`,color:"danger500",as:M.Z})),t.createElement(c.z,{"data-testid":"create-user-button",onClick:y,startIcon:t.createElement(v.Z,null),size:"S",disabled:J},A({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})))};S.propTypes={onClick:g().func.isRequired};const O=S},97083:(T,n,e)=>{e.d(n,{Z:()=>g});var t=e(57338);const a=window.strapi.features.isEnabled(window.strapi.features.SSO)?{useSSORegistration:!0}:{},g={...t.Z,...a}},810:(T,n,e)=>{e.d(n,{Z:()=>a});const a=window.strapi.features.isEnabled(window.strapi.features.SSO)?[[{intlLabel:{id:"Settings.permissions.users.form.sso",defaultMessage:"Connect with SSO"},hint:{id:"Settings.permissions.users.form.sso.description",defaultMessage:"When enabled (ON), users can login via SSO"},name:"useSSORegistration",type:"bool",size:{col:6,xs:12}}]]:[]},12201:(T,n,e)=>{e.d(n,{Z:()=>c});var t=e(67294),a=e(86896),s=e(45697),g=e.n(s),f=e(63871),p=e(82464);const d=({registrationToken:M})=>{const{formatMessage:v}=(0,a.Z)();return M?t.createElement(p.Z,{target:`${window.location.origin}${f.Z}auth/register?registrationToken=${M}`},v({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(p.Z,{target:`${window.location.origin}${f.Z}auth/login`},v({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};d.defaultProps={registrationToken:""},d.propTypes={registrationToken:g().string};const c=d}}]);
