"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[3219],{76539:(A,y,e)=>{e.d(y,{Z:()=>E});var t=e(67294),m=e(86896),n=e(45697),s=e.n(n),M=e(79946),a=e(8675),g=e(60793),i=e(79371),o=e(75878),T=e(19442),c=e(61378),l=e(48474);const d=({onRegenerate:P,idToRegenerate:r,backUrl:L,onError:x})=>{const{formatMessage:U}=(0,m.Z)(),[S,B]=(0,t.useState)(!1),{regenerateData:W,isLoadingConfirmation:k}=(0,l.rW)(L,r,P,x),K=async()=>{W(),B(!1)};return t.createElement(t.Fragment,null,t.createElement(T.z,{startIcon:t.createElement(c.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>B(!0),name:"regenerate"},U({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(M.ConfirmDialog,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(c.Z,null),isConfirmButtonLoading:k,isOpen:S,onToggleDialog:()=>B(!1),onConfirm:K,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};d.defaultProps={onRegenerate(){},onError:void 0},d.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};const f=d,u=({title:P,token:r,setToken:L,canEditInputs:x,canRegenerate:U,isSubmitting:S,backUrl:B,regenerateUrl:W,onErrorRegenerate:k})=>{const{formatMessage:K}=(0,m.Z)(),V=H=>{L({...r,accessKey:H})};return t.createElement(i.T,{title:r?.name||K(P),primaryAction:x?t.createElement(o.k,{gap:2},U&&r?.id&&t.createElement(f,{backUrl:W,onRegenerate:V,idToRegenerate:r?.id,onError:k}),t.createElement(T.z,{disabled:S,loading:S,startIcon:t.createElement(a.Z,null),type:"submit",size:"S"},K({id:"global.save",defaultMessage:"Save"}))):U&&r?.id&&t.createElement(f,{onRegenerate:V,idToRegenerate:r?.id,backUrl:W}),navigationAction:t.createElement(M.Link,{startIcon:t.createElement(g.Z,null),to:B},K({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};u.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},u.defaultProps={token:void 0,onErrorRegenerate:void 0};const E=u},60401:(A,y,e)=>{e.d(y,{Z:()=>T});var t=e(67294),m=e(45697),n=e.n(m),s=e(86896),M=e(50614),a=e(473),g=e(77270),i=e(75056);const o=({token:c,errors:l,values:d,onChange:f,isCreating:u})=>{const{formatMessage:E}=(0,s.Z)();return t.createElement(t.Fragment,null,t.createElement(M.P,{name:"lifespan",label:E({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:d.lifespan!==null?d.lifespan:"0",error:l.lifespan?E(l.lifespan?.id?l.lifespan:{id:l.lifespan,defaultMessage:l.lifespan}):null,onChange:P=>{f({target:{name:"lifespan",value:P}})},required:!0,disabled:!u,placeholder:"Select"},t.createElement(a.W,{value:"604800000"},E({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(a.W,{value:"2592000000"},E({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(a.W,{value:"7776000000"},E({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(a.W,{value:"0"},E({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(g.Z,{variant:"pi",textColor:"neutral600"},!u&&`${E({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,i.IX)(c?.createdAt,parseInt(d.lifespan,10))}`))};o.propTypes={errors:n().shape({lifespan:n().string}),onChange:n().func.isRequired,values:n().shape({lifespan:n().oneOfType([n().number,n().string])}).isRequired,isCreating:n().bool.isRequired,token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string})},o.defaultProps={errors:{},token:{}};const T=o},24122:(A,y,e)=>{e.d(y,{Z:()=>l});var t=e(67294),m=e(86896),n=e(79946),s=e(37527),M=e(70780),a=e(49231),g=e(45697),i=e.n(g),o=e(74855),T=e.n(o);const c=({token:d,tokenType:f})=>{const{formatMessage:u}=(0,m.Z)(),E=(0,n.useNotification)(),{trackUsage:P}=(0,n.useTracking)(),r=(0,t.useRef)(P);return t.createElement(n.ContentBox,{endAction:d&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(o.CopyToClipboard,{onCopy:()=>{r.current("didCopyTokenKey",{tokenType:f}),E({type:"success",message:{id:"Settings.tokens.notification.copied"}})},text:d},t.createElement(s.h,{label:u({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),noBorder:!0,icon:t.createElement(M.Z,null),style:{padding:0,height:"1rem"}}))),title:d||u({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:u(d?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(a.Z,null),iconBackground:"neutral100"})};c.defaultProps={token:null},c.propTypes={token:i().string,tokenType:i().string.isRequired};const l=c},40695:(A,y,e)=>{e.d(y,{Z:()=>g});var t=e(67294),m=e(45697),n=e.n(m),s=e(86896),M=e(20603);const a=({errors:i,values:o,onChange:T,canEditInputs:c})=>{const{formatMessage:l}=(0,s.Z)();return t.createElement(M.g,{label:l({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:i.description?l(i.description?.id?i.description:{id:i.description,defaultMessage:i.description}):null,onChange:T,disabled:!c},o.description)};a.propTypes={errors:n().shape({description:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({description:n().string}).isRequired},a.defaultProps={errors:{}};const g=a},61053:(A,y,e)=>{e.d(y,{Z:()=>g});var t=e(67294),m=e(45697),n=e.n(m),s=e(86896),M=e(28469);const a=({errors:i,values:o,onChange:T,canEditInputs:c})=>{const{formatMessage:l}=(0,s.Z)();return t.createElement(M.o,{name:"name",error:i.name?l(i.name?.id?i.name:{id:i.name,defaultMessage:i.name}):null,label:l({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:T,value:o.name,disabled:!c,required:!0})};a.propTypes={errors:n().shape({name:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string}).isRequired},a.defaultProps={errors:{}};const g=a},31065:(A,y,e)=>{e.d(y,{Z:()=>i});var t=e(67294),m=e(45697),n=e.n(m),s=e(86896),M=e(50614),a=e(473);const g=({name:o,errors:T,values:c,onChange:l,canEditInputs:d,options:f,label:u})=>{const{formatMessage:E}=(0,s.Z)();return t.createElement(M.P,{name:o,label:E({id:u.id,defaultMessage:u.defaultMessage}),value:c&&c[o],error:T[o]?E(T[o]?.id?T[o]:{id:T[o],defaultMessage:T[o]}):null,onChange:l,placeholder:"Select",required:!0,disabled:!d},f&&f.map(({value:P,label:r})=>t.createElement(a.W,{key:P,value:P},E(r))))};g.propTypes={name:n().string,options:n().arrayOf(n().shape({label:n().shape({id:n().string,defaultMessage:n().string}),value:n().string})),errors:n().shape({type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({type:n().string}).isRequired,label:n().shape({id:n().string,defaultMessage:n().string}).isRequired},g.defaultProps={name:"type",errors:{},options:[]};const i=g},47670:(A,y,e)=>{e.d(y,{Z:()=>t,f:()=>m});const t="api-token",m="transfer-token"},75056:(A,y,e)=>{e.d(y,{IX:()=>M,fK:()=>o,mk:()=>c});var t=e(6406),m=e(77349),n=e(51991);const M=(l,d,f="en")=>{if(d&&typeof d=="number"){const u=d/24/60/60/1e3;return(0,t.Z)((0,m.Z)(new Date(l),u),"PPP",{locale:n[f]})}return"Unlimited"};var a=e(87561),g=e(79946);const o=a.Ry().shape({name:a.Z_(g.translatedErrors.string).max(100).required(g.translatedErrors.required),type:a.Z_(g.translatedErrors.string).oneOf(["read-only","full-access","custom"]).required(g.translatedErrors.required),description:a.Z_().nullable(),lifespan:a.Rx().integer().min(0).nullable().defined(g.translatedErrors.required)}),c=l=>{const d={allActionsIds:[],permissions:[]};return d.permissions=Object.keys(l).map(f=>({apiId:f,label:f.split("::")[1],controllers:Object.keys(l[f].controllers).map(u=>({controller:u,actions:l[f].controllers[u].map(E=>{const P=`${f}.${u}.${E}`;return f.includes("api::")&&d.allActionsIds.push(P),{action:E,actionId:P}}).flat()})).flat()})),d}},53219:(A,y,e)=>{e.d(y,{Z:()=>ne});var t=e(67294),m=e(86896),n=e(41054),s=e(16550),M=e(88767),a=e(79946),g=e(57713),i=e(26789),o=e(75878),T=e(19631),c=e(87561);const d=c.Ry().shape({name:c.Z_(a.translatedErrors.string).max(100).required(a.translatedErrors.required),description:c.Z_().nullable(),lifespan:c.Rx().integer().min(0).nullable().defined(a.translatedErrors.required),permissions:c.Z_(a.translatedErrors.string).required(a.translatedErrors.required)});var f=e(79371),u=e(19442),E=e(8675),P=e(45697),r=e.n(P);const L=({transferTokenName:O})=>{const{formatMessage:h}=(0,m.Z)();return(0,a.useFocusWhenNavigate)(),t.createElement(g.o,{"aria-busy":"true"},t.createElement(a.SettingsPageTitle,{name:"Transfer Tokens"}),t.createElement(f.T,{primaryAction:t.createElement(u.z,{disabled:!0,startIcon:t.createElement(E.Z,null),type:"button",size:"L"},h({id:"global.save",defaultMessage:"Save"})),title:O||h({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),t.createElement(i.D,null,t.createElement(a.LoadingIndicatorPage,null)))};L.defaultProps={transferTokenName:null},L.propTypes={transferTokenName:r().string};const x=L;var U=e(87751),S=e(50781),B=e(77270),W=e(9370),k=e(61585),K=e(60401),V=e(61053),H=e(40695),b=e(31065);const Y=({errors:O,onChange:h,canEditInputs:Z,isCreating:D,values:I,transferToken:v})=>{const{formatMessage:F}=(0,m.Z)(),G=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return t.createElement(S.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(B.Z,{variant:"delta",as:"h2"},F({id:"global.details",defaultMessage:"Details"})),t.createElement(W.r,{gap:5},t.createElement(k.P,{key:"name",col:6,xs:12},t.createElement(V.Z,{errors:O,values:I,canEditInputs:Z,onChange:h})),t.createElement(k.P,{key:"description",col:6,xs:12},t.createElement(H.Z,{errors:O,values:I,canEditInputs:Z,onChange:h})),t.createElement(k.P,{key:"lifespan",col:6,xs:12},t.createElement(K.Z,{isCreating:D,errors:O,values:I,onChange:h,token:v})),t.createElement(k.P,{key:"permissions",col:6,xs:12},t.createElement(b.Z,{name:"permissions",values:I,errors:O,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:N=>{h({target:{name:"permissions",value:N}})},options:G,canEditInputs:Z})))))};Y.propTypes={errors:r().shape({name:r().string,description:r().string,lifespan:r().string,type:r().string}),onChange:r().func.isRequired,canEditInputs:r().bool.isRequired,values:r().shape({name:r().string,description:r().string,lifespan:r().oneOfType([r().number,r().string]),type:r().string}).isRequired,isCreating:r().bool.isRequired,transferToken:r().shape({id:r().oneOfType([r().number,r().string]),type:r().string,lifespan:r().string,name:r().string,accessKey:r().string,permissions:r().array,description:r().string,createdAt:r().string})},Y.defaultProps={errors:{},transferToken:{}};const q=Y;var w=e(24122),ee=e(76539),$=e(47670);const te="Name already taken",ne=()=>{(0,a.useFocusWhenNavigate)();const{formatMessage:O}=(0,m.Z)(),{lockApp:h,unlockApp:Z}=(0,a.useOverlayBlocker)(),D=(0,a.useNotification)(),I=(0,s.k6)(),[v,F]=(0,t.useState)(I.location.state?.transferToken.accessKey?{...I.location.state.transferToken}:null),{trackUsage:G}=(0,a.useTracking)(),N=(0,t.useRef)(G),{setCurrentStep:se}=(0,a.useGuidedTour)(),{allowedActions:{canCreate:ae,canUpdate:re,canRegenerate:oe}}=(0,a.useRBAC)(U.Z.settings["transfer-tokens"]),{params:{id:z}}=(0,s.$B)("/settings/transfer-tokens/:id"),{get:ie,post:le,put:de}=(0,a.useFetchClient)(),R=z==="create",{formatAPIError:Q}=(0,a.useAPIErrorHandler)();(0,t.useEffect)(()=>{N.current(R?"didAddTokenFromList":"didEditTokenFromList",{tokenType:$.f})},[R]);const{status:ce}=(0,M.useQuery)(["transfer-token",z],async()=>{const{data:{data:p}}=await ie(`/admin/transfer/tokens/${z}`);return F({...p}),p},{enabled:!R&&!v,onError(p){p.response.data.error.details?.code==="INVALID_TOKEN_SALT"?D({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):D({type:"warning",message:Q(p)})}}),ge=async(p,_)=>{N.current(R?"willCreateToken":"willEditToken",{tokenType:$.f}),h();const j=p.lifespan&&parseInt(p.lifespan,10)&&p.lifespan!=="0"?parseInt(p.lifespan,10):null,X=p.permissions.split("-");try{const{data:{data:C}}=R?await le("/admin/transfer/tokens",{...p,lifespan:j,permissions:X}):await de(`/admin/transfer/tokens/${z}`,{name:p.name,description:p.description,permissions:X});Z(),R&&(I.replace(`/settings/transfer-tokens/${C.id}`,{transferToken:C}),se("transferTokens.success")),F({...C}),D({type:"success",message:O(R?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),N.current(R?"didCreateToken":"didEditToken",{type:v?.permissions,tokenType:$.f})}catch(C){const pe=(0,T.Iz)(C.response.data);_.setErrors(pe),C?.response?.data?.error?.message===te?D({type:"warning",message:C.response.data.message||"notification.error.tokennamenotunique"}):C?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?D({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):D({type:"warning",message:C?.response?.data?.message||"notification.error"}),Z()}},J=re&&!R||ae&&R;if(!R&&!v&&ce!=="success")return t.createElement(x,{transferTokenName:v?.name});const ue=p=>{p?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?D({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):D({type:"warning",message:Q(p)})};return t.createElement(g.o,null,t.createElement(a.SettingsPageTitle,{name:"Transfer Tokens"}),t.createElement(n.Formik,{validationSchema:d,validateOnChange:!1,initialValues:{name:v?.name||"",description:v?.description||"",lifespan:v?.lifespan?v.lifespan.toString():v?.lifespan,permissions:v?.permissions.join("-")},enableReinitialize:!0,onSubmit:(p,_)=>ge(p,_)},({errors:p,handleChange:_,isSubmitting:j,values:X})=>t.createElement(a.Form,null,t.createElement(ee.Z,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"},token:v,setToken:F,canEditInputs:J,canRegenerate:oe,isSubmitting:j,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:ue}),t.createElement(i.D,null,t.createElement(o.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(v?.name)&&t.createElement(w.Z,{token:v?.accessKey,tokenType:$.f}),t.createElement(q,{errors:p,onChange:_,canEditInputs:J,isCreating:R,values:X,transferToken:v}))))))}}}]);
