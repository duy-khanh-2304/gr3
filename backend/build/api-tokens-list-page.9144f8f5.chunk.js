"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[8056],{56856:(Y,k,t)=>{t.d(k,{Z:()=>N});var e=t(67294),s=t(16550),S=t(45697),n=t.n(S),C=t(94487),U=t(6090),y=t(62351),h=t(77270),x=t(75878),l=t(79946),V=t(34263),F=t(50781),M=t(37527),O=t(86896);const P=({tokenName:a,onClickDelete:c,tokenType:m})=>{const{formatMessage:E}=(0,O.Z)(),{trackUsage:p}=(0,l.useTracking)(),[g,r]=(0,e.useState)(!1),T=()=>{r(!1),p("willDeleteToken",{tokenType:m}),c()};return e.createElement(F.x,{paddingLeft:1,onClick:f=>f.stopPropagation()},e.createElement(M.h,{onClick:()=>{r(!0)},label:E({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${a}`}),name:"delete",noBorder:!0,icon:e.createElement(V.Z,null)}),e.createElement(l.ConfirmDialog,{onToggleDialog:()=>r(!1),onConfirm:T,isOpen:g}))};P.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};const $=P;var v=t(36670),z=t(1565);const W={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},G=(0,z.default)(l.Link)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`,A=({tokenName:a,tokenId:c,buttonType:m,children:E})=>{const{formatMessage:p}=(0,O.Z)(),{location:{pathname:g}}=(0,s.k6)();return e.createElement(G,{to:`${g}/${c}`,title:p(W[m],{target:a})},E)};A.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},A.defaultProps={buttonType:"edit"};const b=A,u=({tokenName:a,tokenId:c})=>e.createElement(b,{tokenName:a,tokenId:c},e.createElement(v.Z,null));u.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const R=u;var D=t(2953);const Z=({tokenName:a,tokenId:c})=>e.createElement(b,{tokenName:a,tokenId:c,buttonType:"read"},e.createElement(D.Z,null));Z.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const w=Z,d=({permissions:a,headers:c,contentType:m,isLoading:E,tokens:p,onConfirmDelete:g,tokenType:r})=>{const{canDelete:T,canUpdate:f,canRead:L}=a,I=T||f||L,[{query:B}]=(0,l.useQueryParams)(),[,H]=B?B.sort.split(":"):"ASC",{push:Q,location:{pathname:o}}=(0,s.k6)(),{trackUsage:j}=(0,l.useTracking)(),J=p.sort((i,X)=>{const K=i.name.localeCompare(X.name);return H==="DESC"?-K:K});return e.createElement(l.DynamicTable,{headers:c,contentType:m,rows:p,withBulkActions:I,isLoading:E,onConfirmDelete:g},e.createElement(C.p,null,J.map(i=>e.createElement(U.Tr,{key:i.id,...(0,l.onRowClick)({fn(){j("willEditTokenFromList",{tokenType:r}),Q(`${o}/${i.id}`)},condition:f})},e.createElement(y.Td,{maxWidth:(0,l.pxToRem)(250)},e.createElement(h.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},i.name)),e.createElement(y.Td,{maxWidth:(0,l.pxToRem)(250)},e.createElement(h.Z,{textColor:"neutral800",ellipsis:!0},i.description)),e.createElement(y.Td,null,e.createElement(h.Z,{textColor:"neutral800"},e.createElement(l.RelativeTime,{timestamp:new Date(i.createdAt)}))),e.createElement(y.Td,null,i.lastUsedAt&&e.createElement(h.Z,{textColor:"neutral800"},e.createElement(l.RelativeTime,{timestamp:new Date(i.lastUsedAt)}))),I&&e.createElement(y.Td,null,e.createElement(x.k,{justifyContent:"end"},f&&e.createElement(R,{tokenName:i.name,tokenId:i.id}),!f&&L&&e.createElement(w,{tokenName:i.name,tokenId:i.id}),T&&e.createElement($,{tokenName:i.name,onClickDelete:()=>g(i.id),tokenType:r})))))))};d.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},d.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const N=d},47670:(Y,k,t)=>{t.d(k,{Z:()=>e,f:()=>s});const e="api-token",s="transfer-token"},87427:(Y,k,t)=>{t.r(k),t.d(k,{default:()=>A});var e=t(67294),s=t(79946),S=t(87751),n=t(86896),C=t(88767),U=t(16550),y=t(80129),h=t.n(y),x=t(57713),l=t(79371),V=t(26789),F=t(19442),M=t(12978);const P=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}];var $=t(56856),v=t(47670);const W=()=>{(0,s.useFocusWhenNavigate)();const b=(0,C.useQueryClient)(),{formatMessage:u}=(0,n.Z)(),R=(0,s.useNotification)(),{allowedActions:{canCreate:D,canDelete:Z,canUpdate:w,canRead:d}}=(0,s.useRBAC)(S.Z.settings["api-tokens"]),{push:N}=(0,U.k6)(),{trackUsage:a}=(0,s.useTracking)(),{startSection:c}=(0,s.useGuidedTour)(),m=(0,e.useRef)(c),{get:E,del:p}=(0,s.useFetchClient)();(0,e.useEffect)(()=>{m.current&&m.current("apiTokens")},[]),(0,e.useEffect)(()=>{N({search:h().stringify({sort:"name:ASC"},{encode:!1})})},[N]);const g=P.map(o=>({...o,metadatas:{...o.metadatas,label:u(o.metadatas.label)}})),{data:r,status:T,isFetching:f}=(0,C.useQuery)(["api-tokens"],async()=>{a("willAccessTokenList",{tokenType:v.Z});const{data:{data:o}}=await E("/admin/api-tokens");return a("didAccessTokenList",{number:o.length,tokenType:v.Z}),o},{enabled:d,onError(){R({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),L=d&&(T!=="success"&&T!=="error"||T==="success"&&f),I=(0,C.useMutation)(async o=>{await p(`/admin/api-tokens/${o}`)},{async onSuccess(){await b.invalidateQueries(["api-tokens"]),a("didDeleteToken")},onError(o){o?.response?.data?.data?R({type:"warning",message:o.response.data.data}):R({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),B=d&&r,H=d&&!r&&!D,Q=d&&!r&&D;return e.createElement(x.o,{"aria-busy":L},e.createElement(s.SettingsPageTitle,{name:"API Tokens"}),e.createElement(l.T,{title:u({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:u({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:D?e.createElement(s.LinkButton,{"data-testid":"create-api-token-button",startIcon:e.createElement(M.Z,null),size:"S",onClick:()=>a("willAddTokenFromList",{tokenType:v.Z}),to:"/settings/api-tokens/create"},u({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})):void 0}),e.createElement(V.D,null,!d&&e.createElement(s.NoPermissions,null),B&&e.createElement($.Z,{permissions:{canRead:d,canDelete:Z,canUpdate:w},headers:g,contentType:"api-tokens",rows:r,isLoading:L,onConfirmDelete:o=>I.mutateAsync(o),tokens:r,tokenType:v.Z}),Q&&e.createElement(s.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(F.z,{variant:"secondary",startIcon:e.createElement(M.Z,null)},u({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),H&&e.createElement(s.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},A=()=>e.createElement(s.CheckPagePermissions,{permissions:S.Z.settings["api-tokens"].main},e.createElement(W,null))}}]);
