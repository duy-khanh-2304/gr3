"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[8418],{95972:(Q,M,t)=>{t.r(M),t.d(M,{default:()=>oe});var e=t(67294),f=t(88767),h=t(86896),a=t(79946),R=t(46683),F=t(57713),B=t(79371),O=t(26789),E=t(81912),l=t(89031);const P=async()=>{const{get:s}=(0,a.getFetchClient)(),{data:o}=await s((0,l.Gc)("email-templates"));return o},v=s=>{const{put:o}=(0,a.getFetchClient)();return o((0,l.Gc)("email-templates"),s)};var C=t(45697),n=t.n(C),T=t(51541),J=t(42403),Z=t(6090),m=t(62351),I=t(22996),b=t(77270),V=t(94487),A=t(80907),G=t(37527),W=t(61378),j=t(36670),X=t(8675);const N=({canUpdate:s,onEditClick:o})=>{const{formatMessage:i}=(0,h.Z)();return e.createElement(T.i,{colCount:3,rowCount:3},e.createElement(J.h,null,e.createElement(Z.Tr,null,e.createElement(m.Th,{width:"1%"},e.createElement(I.T,null,i({id:(0,l.OB)("Email.template.table.icon.label"),defaultMessage:"icon"}))),e.createElement(m.Th,null,e.createElement(b.Z,{variant:"sigma",textColor:"neutral600"},i({id:(0,l.OB)("Email.template.table.name.label"),defaultMessage:"name"}))),e.createElement(m.Th,{width:"1%"},e.createElement(I.T,null,i({id:(0,l.OB)("Email.template.table.action.label"),defaultMessage:"action"}))))),e.createElement(V.p,null,e.createElement(Z.Tr,{...(0,a.onRowClick)({fn:()=>o("reset_password")})},e.createElement(m.Td,null,e.createElement(A.J,null,e.createElement(W.Z,{"aria-label":i({id:"global.reset-password",defaultMessage:"Reset password"})}))),e.createElement(m.Td,null,e.createElement(b.Z,null,i({id:"global.reset-password",defaultMessage:"Reset password"}))),e.createElement(m.Td,{...a.stopPropagation},e.createElement(G.h,{onClick:()=>o("reset_password"),label:i({id:(0,l.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:s&&e.createElement(j.Z,null)}))),e.createElement(Z.Tr,{...(0,a.onRowClick)({fn:()=>o("email_confirmation")})},e.createElement(m.Td,null,e.createElement(A.J,null,e.createElement(X.Z,{"aria-label":i({id:(0,l.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"})}))),e.createElement(m.Td,null,e.createElement(b.Z,null,i({id:(0,l.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"}))),e.createElement(m.Td,{...a.stopPropagation},e.createElement(G.h,{onClick:()=>o("email_confirmation"),label:i({id:(0,l.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:s&&e.createElement(j.Z,null)})))))};N.propTypes={canUpdate:n().bool.isRequired,onEditClick:n().func.isRequired};const Y=N;var K=t(41054),k=t(60881),q=t(18189),L=t(78784),w=t(48683),_=t(9370),y=t(61585),ee=t(20603),te=t(45124),$=t(19442),c=t(87561);const ae=c.Ry().shape({options:c.Ry().shape({from:c.Ry().shape({name:c.Z_().required(a.translatedErrors.required),email:c.Z_().email(a.translatedErrors.email).required(a.translatedErrors.required)}).required(),response_email:c.Z_().email(a.translatedErrors.email),object:c.Z_().required(a.translatedErrors.required),message:c.Z_().required(a.translatedErrors.required)}).required(a.translatedErrors.required)}),H=({template:s,onToggle:o,onSubmit:i})=>{const{formatMessage:r}=(0,h.Z)();return e.createElement(k.P,{onClose:o,labelledBy:`${r({id:(0,l.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,l.OB)(s.display),defaultMessage:s.display})}`},e.createElement(q.x,null,e.createElement(L.O,{label:`${r({id:(0,l.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,l.OB)(s.display),defaultMessage:s.display})}`},e.createElement(L.$,null,r({id:(0,l.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})),e.createElement(L.$,null,r({id:(0,l.OB)(s.display),defaultMessage:s.display})))),e.createElement(K.Formik,{onSubmit:i,initialValues:s,validateOnChange:!1,validationSchema:ae,enableReinitialize:!0},({errors:d,values:u,handleChange:p,isSubmitting:S})=>e.createElement(a.Form,null,e.createElement(w.f,null,e.createElement(_.r,{gap:5},e.createElement(y.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.from.name.label"),defaultMessage:"Shipper name"},name:"options.from.name",onChange:p,value:u.options.from.name,error:d?.options?.from?.name,type:"text"})),e.createElement(y.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.from.email.label"),defaultMessage:"Shipper email"},name:"options.from.email",onChange:p,value:u.options.from.email,error:d?.options?.from?.email,type:"text"})),e.createElement(y.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.response_email.label"),defaultMessage:"Response email"},name:"options.response_email",onChange:p,value:u.options.response_email,error:d?.options?.response_email,type:"text"})),e.createElement(y.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.object.label"),defaultMessage:"Subject"},name:"options.object",onChange:p,value:u.options.object,error:d?.options?.object,type:"text"})),e.createElement(y.P,{col:12,s:12},e.createElement(ee.g,{label:r({id:(0,l.OB)("PopUpForm.Email.options.message.label"),defaultMessage:"Message"}),id:"options.message",onChange:p,value:u.options.message,error:d?.options?.message&&r({id:d.options.message,defaultMessage:d.options.message})})))),e.createElement(te.m,{startActions:e.createElement($.z,{onClick:o,variant:"tertiary"},"Cancel"),endActions:e.createElement($.z,{loading:S,type:"submit"},"Finish")}))))};H.propTypes={template:n().shape({display:n().string,icon:n().string,options:n().shape({from:n().shape({name:n().string,email:n().string}),message:n().string,object:n().string,response_email:n().string})}).isRequired,onSubmit:n().func.isRequired,onToggle:n().func.isRequired};const le=H,se=()=>e.createElement(a.CheckPagePermissions,{permissions:E.Z.readEmailTemplates},e.createElement(ne,null)),ne=()=>{const{formatMessage:s}=(0,h.Z)(),{trackUsage:o}=(0,a.useTracking)(),{notifyStatus:i}=(0,R.G)(),r=(0,a.useNotification)(),{lockApp:d,unlockApp:u}=(0,a.useOverlayBlocker)(),p=(0,e.useRef)(o),S=(0,f.useQueryClient)();(0,a.useFocusWhenNavigate)();const[ie,re]=(0,e.useState)(!1),[x,me]=(0,e.useState)(null),de=(0,e.useMemo)(()=>({update:E.Z.updateEmailTemplates}),[]),{isLoading:ce,allowedActions:{canUpdate:ue}}=(0,a.useRBAC)(de),{status:pe,data:D}=(0,f.useQuery)("email-templates",()=>P(),{onSuccess(){i(s({id:(0,l.OB)("Email.template.data.loaded"),defaultMessage:"Email templates has been loaded"}))},onError(){r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Ee=ce||pe!=="success",U=()=>{re(g=>!g)},ge=g=>{me(g),U()},z=(0,f.useMutation)(g=>v({"email-templates":g}),{async onSuccess(){await S.invalidateQueries("email-templates"),r({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}}),p.current("didEditEmailTemplates"),u(),U()},onError(){r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),u()},refetchActive:!0}),{isLoading:fe}=z,ve=g=>{d(),p.current("willEditEmailTemplates");const Te={...D,[x]:g};z.mutate(Te)};return Ee?e.createElement(F.o,{"aria-busy":"true"},e.createElement(a.SettingsPageTitle,{name:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(B.T,{title:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(O.D,null,e.createElement(a.LoadingIndicatorPage,null))):e.createElement(F.o,{"aria-busy":fe},e.createElement(a.SettingsPageTitle,{name:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(B.T,{title:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(O.D,null,e.createElement(Y,{onEditClick:ge,canUpdate:ue}),ie&&e.createElement(le,{template:D[x],onToggle:U,onSubmit:ve})))},oe=se},89031:(Q,M,t)=>{t.d(M,{YX:()=>a,Gc:()=>B,OB:()=>O.Z});var e=t(41609),f=t.n(e);const a=E=>Object.keys(E).reduce((l,P)=>{const v=E[P].controllers,C=Object.keys(v).reduce((n,T)=>(f()(v[T])||(n[T]=v[T]),n),{});return f()(C)||(l[P]={controllers:C}),l},{});var R=t(31498);const B=E=>`/${R.Z}/${E}`;var O=t(84757)}}]);
