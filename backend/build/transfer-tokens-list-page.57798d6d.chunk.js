"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[9600],{56856:(K,v,t)=>{t.d(v,{Z:()=>Z});var e=t(67294),s=t(16550),S=t(45697),n=t.n(S),R=t(94487),U=t(6090),y=t(62351),h=t(77270),V=t(75878),i=t(79946),x=t(34263),O=t(50781),M=t(37527),F=t(86896);const N=({tokenName:o,onClickDelete:c,tokenType:m})=>{const{formatMessage:k}=(0,F.Z)(),{trackUsage:f}=(0,i.useTracking)(),[g,l]=(0,e.useState)(!1),T=()=>{l(!1),f("willDeleteToken",{tokenType:m}),c()};return e.createElement(O.x,{paddingLeft:1,onClick:p=>p.stopPropagation()},e.createElement(M.h,{onClick:()=>{l(!0)},label:k({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${o}`}),name:"delete",noBorder:!0,icon:e.createElement(x.Z,null)}),e.createElement(i.ConfirmDialog,{onToggleDialog:()=>l(!1),onConfirm:T,isOpen:g}))};N.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};const $=N;var C=t(36670),Q=t(1565);const w={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},z=(0,Q.default)(i.Link)`
  svg {
    path {
      fill: ${({theme:o})=>o.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:o})=>o.colors.neutral800};
      }
    }
  }
`,A=({tokenName:o,tokenId:c,buttonType:m,children:k})=>{const{formatMessage:f}=(0,F.Z)(),{location:{pathname:g}}=(0,s.k6)();return e.createElement(z,{to:`${g}/${c}`,title:f(w[m],{target:o})},k)};A.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},A.defaultProps={buttonType:"edit"};const b=A,u=({tokenName:o,tokenId:c})=>e.createElement(b,{tokenName:o,tokenId:c},e.createElement(C.Z,null));u.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const E=u;var D=t(2953);const P=({tokenName:o,tokenId:c})=>e.createElement(b,{tokenName:o,tokenId:c,buttonType:"read"},e.createElement(D.Z,null));P.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const W=P,d=({permissions:o,headers:c,contentType:m,isLoading:k,tokens:f,onConfirmDelete:g,tokenType:l})=>{const{canDelete:T,canUpdate:p,canRead:L}=o,B=T||p||L,[{query:I}]=(0,i.useQueryParams)(),[,Y]=I?I.sort.split(":"):"ASC",{push:H,location:{pathname:a}}=(0,s.k6)(),{trackUsage:j}=(0,i.useTracking)(),J=f.sort((r,X)=>{const G=r.name.localeCompare(X.name);return Y==="DESC"?-G:G});return e.createElement(i.DynamicTable,{headers:c,contentType:m,rows:f,withBulkActions:B,isLoading:k,onConfirmDelete:g},e.createElement(R.p,null,J.map(r=>e.createElement(U.Tr,{key:r.id,...(0,i.onRowClick)({fn(){j("willEditTokenFromList",{tokenType:l}),H(`${a}/${r.id}`)},condition:p})},e.createElement(y.Td,{maxWidth:(0,i.pxToRem)(250)},e.createElement(h.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},r.name)),e.createElement(y.Td,{maxWidth:(0,i.pxToRem)(250)},e.createElement(h.Z,{textColor:"neutral800",ellipsis:!0},r.description)),e.createElement(y.Td,null,e.createElement(h.Z,{textColor:"neutral800"},e.createElement(i.RelativeTime,{timestamp:new Date(r.createdAt)}))),e.createElement(y.Td,null,r.lastUsedAt&&e.createElement(h.Z,{textColor:"neutral800"},e.createElement(i.RelativeTime,{timestamp:new Date(r.lastUsedAt)}))),B&&e.createElement(y.Td,null,e.createElement(V.k,{justifyContent:"end"},p&&e.createElement(E,{tokenName:r.name,tokenId:r.id}),!p&&L&&e.createElement(W,{tokenName:r.name,tokenId:r.id}),T&&e.createElement($,{tokenName:r.name,onClickDelete:()=>g(r.id),tokenType:l})))))))};d.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},d.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const Z=d},47670:(K,v,t)=>{t.d(v,{Z:()=>e,f:()=>s});const e="api-token",s="transfer-token"},70798:(K,v,t)=>{t.r(v),t.d(v,{default:()=>A});var e=t(67294),s=t(79946),S=t(87751),n=t(86896),R=t(88767),U=t(16550),y=t(80129),h=t.n(y),V=t(57713),i=t(79371),x=t(26789),O=t(19442),M=t(12978);const N=[{name:"name",key:"name",metadatas:{label:{id:"Settings.tokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.tokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}];var $=t(56856),C=t(47670);const w=()=>{(0,s.useFocusWhenNavigate)();const b=(0,R.useQueryClient)(),{formatMessage:u}=(0,n.Z)(),E=(0,s.useNotification)(),{allowedActions:{canCreate:D,canDelete:P,canUpdate:W,canRead:d}}=(0,s.useRBAC)(S.Z.settings["transfer-tokens"]),{push:Z}=(0,U.k6)(),{trackUsage:o}=(0,s.useTracking)(),{startSection:c}=(0,s.useGuidedTour)(),m=(0,e.useRef)(c),{get:k,del:f}=(0,s.useFetchClient)();(0,e.useEffect)(()=>{m.current&&m.current("transferTokens")},[]),(0,e.useEffect)(()=>{Z({search:h().stringify({sort:"name:ASC"},{encode:!1})})},[Z]);const g=N.map(a=>({...a,metadatas:{...a.metadatas,label:u(a.metadatas.label)}})),{data:l,status:T,isFetching:p}=(0,R.useQuery)(["transfer-tokens"],async()=>{o("willAccessTokenList",{tokenType:C.f});const{data:{data:a}}=await k("/admin/transfer/tokens");return o("didAccessTokenList",{number:a.length,tokenType:C.f}),a},{enabled:d,onError(a){console.log("error",a),a?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?E({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):E({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),L=d&&(T!=="success"&&T!=="error"||T==="success"&&p),B=(0,R.useMutation)(async a=>{await f(`/admin/transfer/tokens/${a}`)},{async onSuccess(){await b.invalidateQueries(["transfer-tokens"])},onError(a){a?.response?.data?.data?E({type:"warning",message:a.response.data.data}):a?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?E({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):E({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),I=d&&l,Y=d&&!l&&!D,H=d&&!l&&D;return e.createElement(V.o,{"aria-busy":L},e.createElement(s.SettingsPageTitle,{name:"Transfer Tokens"}),e.createElement(i.T,{title:u({id:"Settings.transferTokens.title",defaultMessage:"Transfer Tokens"}),subtitle:u({id:"Settings.transferTokens.description",defaultMessage:'"List of generated transfer tokens"'}),primaryAction:D?e.createElement(s.LinkButton,{"data-testid":"create-transfer-token-button",startIcon:e.createElement(M.Z,null),size:"S",onClick:()=>o("willAddTokenFromList",{tokenType:C.f}),to:"/settings/transfer-tokens/create"},u({id:"Settings.transferTokens.create",defaultMessage:"Create new Transfer Token"})):void 0}),e.createElement(x.D,null,!d&&e.createElement(s.NoPermissions,null),I&&e.createElement($.Z,{permissions:{canRead:d,canDelete:P,canUpdate:W},headers:g,contentType:"trasfer-tokens",rows:l,isLoading:L,onConfirmDelete:a=>B.mutateAsync(a),tokens:l,tokenType:C.f}),H&&e.createElement(s.NoContent,{content:{id:"Settings.transferTokens.addFirstToken",defaultMessage:"Add your first Transfer Token"},action:e.createElement(O.z,{variant:"secondary",startIcon:e.createElement(M.Z,null)},u({id:"Settings.transferTokens.addNewToken",defaultMessage:"Add new Transfer Token"}))}),Y&&e.createElement(s.NoContent,{content:{id:"Settings.transferTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},A=()=>e.createElement(s.CheckPagePermissions,{permissions:S.Z.settings["transfer-tokens"].main},e.createElement(w,null))}}]);
