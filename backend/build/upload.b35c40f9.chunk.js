"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[3650],{17316:(Vt,_,t)=>{t.r(_),t.d(_,{default:()=>Bt});var e=t(67294),D=t(16550),L=t(86896),Le=t(64593),m=t(79946),ee=t(57713),$=t(1565),Be=t(73727),te=t(80129),x=t(50781),I=t(77270),Ae=t(45349),Te=t(15483),Ze=t(62779),G=t(37527),De=t(26789),ae=t(61585),O=t(75878),Oe=t(22996),Re=t(81984),xe=t(80606),Ie=t(2511),Pe=t(55814),ze=t(36670),Ue=t(33012),Qe=t(78971),be=t(80845),Ve=t(92585),$e=t(24652),Ge=t(11357),We=t(27954),He=t(45697),g=t.n(He);const W=({pagination:n})=>e.createElement(x.x,{paddingTop:6},e.createElement(O.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(m.PageSizeURLQuery,null),e.createElement(m.PaginationURLQuery,{pagination:n})));W.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},W.propTypes={pagination:g().shape({page:g().number,pageCount:g().number,pageSize:g().number,total:g().number})};var f=t(49826),Ne=t(15537),T=t(19442),je=t(34263),Ke=t(2967);const ne=({selected:n,onSuccess:l})=>{const{formatMessage:o}=(0,L.Z)(),[r,d]=(0,e.useState)(!1),{isLoading:c,remove:v}=(0,Ke.K)(),E=async()=>{await v(n),l()};return e.createElement(e.Fragment,null,e.createElement(T.z,{variant:"danger-light",size:"S",startIcon:e.createElement(je.Z,null),onClick:()=>d(!0)},o({id:"global.delete",defaultMessage:"Delete"})),e.createElement(m.ConfirmDialog,{isConfirmButtonLoading:c,isOpen:r,onToggleDialog:()=>d(!1),onConfirm:E}))};ne.propTypes={selected:g().arrayOf(f.pw,f.nx).isRequired,onSuccess:g().func.isRequired};var Je=t(21833),Xe=t(41054),Ye=t(41609),ke=t.n(Ye),se=t(60881),le=t(48683),we=t(28809),qe=t(18189),_e=t(9370),et=t(29516),tt=t(45124),oe=t(88767),R=t(55994),i=t(57197);const at=()=>{const n=(0,m.useNotification)(),l=(0,oe.useQueryClient)(),o=(0,i.IF)("actions/bulk-move"),{post:r}=(0,m.useFetchClient)(),d=({destinationFolderId:E,filesAndFolders:u})=>{const p=u.reduce((h,s)=>{const{id:B,type:M}=s,Z=M==="asset"?"fileIds":"folderIds";return h[Z]||(h[Z]=[]),h[Z].push(B),h},{});return r(o,{...p,destinationFolderId:E})},c=(0,oe.useMutation)(d,{onSuccess(E){const{data:{data:u}}=E;u?.files?.length>0&&(l.refetchQueries([R.Z,"assets"],{active:!0}),l.refetchQueries([R.Z,"asset-count"],{active:!0})),l.refetchQueries([R.Z,"folders"],{active:!0}),n({type:"success",message:{id:(0,i.OB)("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."}})}});return{...c,move:(E,u)=>c.mutateAsync({destinationFolderId:E,filesAndFolders:u})}};var nt=t(66951),st=t(20796);const H=({onClose:n,selected:l,currentFolder:o})=>{const{formatMessage:r}=(0,L.Z)(),{data:d,isLoading:c}=(0,st.v)(),{move:v}=at();if(!d)return null;const E=async(h,{setErrors:s})=>{try{await v(h.destination.value,l),n()}catch(B){const Z=(0,m.normalizeAPIError)(B).errors.reduce((z,F)=>(z[F.values?.path?.length||"destination"]=F.defaultMessage,z),{});ke()(Z)||s(Z)}},u=()=>{n()};if(c)return e.createElement(se.P,{onClose:u,labelledBy:"title"},e.createElement(le.f,null,e.createElement(O.k,{justifyContent:"center",paddingTop:4,paddingBottom:4},e.createElement(we.a,null,r({id:(0,i.OB)("content.isLoading"),defaultMessage:"Content is loading."})))));const p={destination:{value:o?.id||"",label:o?.name||d[0].label}};return e.createElement(se.P,{onClose:u,labelledBy:"title"},e.createElement(Xe.Formik,{validateOnChange:!1,onSubmit:E,initialValues:p},({values:h,errors:s,setFieldValue:B})=>e.createElement(m.Form,{noValidate:!0},e.createElement(qe.x,null,e.createElement(I.Z,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"title"},r({id:(0,i.OB)("modal.folder.move.title"),defaultMessage:"Move elements to"}))),e.createElement(le.f,null,e.createElement(_e.r,{gap:4},e.createElement(ae.P,{xs:12,col:12},e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(et.Q,{htmlFor:"folder-destination"},r({id:(0,i.OB)("form.input.label.folder-location"),defaultMessage:"Location"})),e.createElement(nt.Z,{options:d,onChange:M=>{B("destination",M)},defaultValue:h.destination,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:s?.destination,ariaErrorMessage:"destination-error"}),s.destination&&e.createElement(I.Z,{variant:"pi",as:"p",id:"folder-destination-error",textColor:"danger600"},s.destination))))),e.createElement(tt.m,{startActions:e.createElement(T.z,{onClick:u,variant:"tertiary",name:"cancel"},r({id:"cancel",defaultMessage:"Cancel"})),endActions:e.createElement(T.z,{type:"submit",loading:c},r({id:"modal.folder.move.submit",defaultMessage:"Move"}))}))))};H.defaultProps={currentFolder:void 0},H.propTypes={onClose:g().func.isRequired,currentFolder:f.nx,selected:g().arrayOf(f.nx,f.pw).isRequired};const N=({selected:n,onSuccess:l,currentFolder:o})=>{const{formatMessage:r}=(0,L.Z)(),[d,c]=(0,e.useState)(!1),v=()=>{c(!1),l()};return e.createElement(e.Fragment,null,e.createElement(T.z,{variant:"secondary",size:"S",startIcon:e.createElement(Je.Z,null),onClick:()=>c(!0)},r({id:"global.move",defaultMessage:"Move"})),d&&e.createElement(H,{currentFolder:o,onClose:v,selected:n}))};N.defaultProps={currentFolder:void 0},N.propTypes={onSuccess:g().func.isRequired,currentFolder:f.nx,selected:g().arrayOf(f.pw,f.nx).isRequired};const j=({selected:n,onSuccess:l,currentFolder:o})=>{const{formatMessage:r}=(0,L.Z)();return e.createElement(O.k,{gap:2,paddingBottom:5},e.createElement(I.Z,{variant:"epsilon",textColor:"neutral600"},r({id:(0,Ne.Z)("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:n.filter(({type:d})=>d==="folder").length,numberAssets:n.filter(({type:d})=>d==="asset").length})),e.createElement(ne,{selected:n,onSuccess:l}),e.createElement(N,{currentFolder:o,selected:n,onSuccess:l}))};j.defaultProps={currentFolder:void 0},j.propTypes={onSuccess:g().func.isRequired,currentFolder:f.nx,selected:g().arrayOf(f.pw,f.nx).isRequired};var lt=t(7106),K=t(12978),ot=t(70088);const rt=({isFiltering:n,canCreate:l,canRead:o})=>n?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:o?l?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},re=({canCreate:n,isFiltering:l,canRead:o,onActionClick:r})=>{const{formatMessage:d}=(0,L.Z)(),c=rt({isFiltering:l,canCreate:n,canRead:o});return e.createElement(ot.i,{icon:o?null:lt.Z,action:n&&!l&&e.createElement(T.z,{variant:"secondary",startIcon:e.createElement(K.Z,null),onClick:r},d({id:(0,i.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})),content:d({...c,id:(0,i.OB)(c.id)})})};re.propTypes={canCreate:g().bool.isRequired,canRead:g().bool.isRequired,isFiltering:g().bool.isRequired,onActionClick:g().func.isRequired};var P=t(98101),it=t(36002),dt=t(51386),ct=t(45219),ie=t(97581);const ut=()=>{const n=(0,e.useRef)(null),[l,o]=(0,e.useState)(!1),{formatMessage:r}=(0,L.Z)(),{trackUsage:d}=(0,m.useTracking)(),[{query:c},v]=(0,m.useQueryParams)(),E=c?.filters?.$and||[],u=()=>o(s=>!s),p=s=>{v({filters:{$and:s},page:1})},h=s=>{d("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(s[s.length-1])[0]}),v({filters:{$and:s},page:1})};return e.createElement(e.Fragment,null,e.createElement(T.z,{variant:"tertiary",ref:n,startIcon:e.createElement(it.Z,null),onClick:u,size:"S"},r({id:"app.utils.filters",defaultMessage:"Filters"})),l&&e.createElement(ct.Z,{displayedFilters:ie.Z,filters:E,onSubmit:h,onToggle:u,source:n}),e.createElement(dt.Z,{appliedFilters:E,filtersSchema:ie.Z,onRemoveFilter:p}))};var mt=t(79371),gt=t(51503),ft=t(60793),Et=t(87355);const J=({breadcrumbs:n,canCreate:l,folder:o,onToggleEditFolderDialog:r,onToggleUploadAssetDialog:d})=>{const{formatMessage:c}=(0,L.Z)(),{pathname:v}=(0,D.TH)(),[{query:E}]=(0,m.useQueryParams)(),u={...E,folder:o?.parent?.id??void 0};return e.createElement(mt.T,{title:c({id:(0,i.OB)("plugin.name"),defaultMessage:"Media Library"}),subtitle:n&&o&&e.createElement(Et.O,{as:"nav",label:c({id:(0,i.OB)("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:n,currentFolderId:o?.id}),navigationAction:o&&e.createElement(gt.r,{startIcon:e.createElement(ft.Z,null),to:`${v}?${(0,te.stringify)(u,{encode:!1})}`},c({id:(0,i.OB)("header.actions.folder-level-up"),defaultMessage:"Back"})),primaryAction:l&&e.createElement(O.k,{gap:2},e.createElement(T.z,{startIcon:e.createElement(K.Z,null),variant:"secondary",onClick:r},c({id:(0,i.OB)("header.actions.add-folder"),defaultMessage:"Add new folder"})),e.createElement(T.z,{startIcon:e.createElement(K.Z,null),onClick:d},c({id:(0,i.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})))})};J.defaultProps={breadcrumbs:!1,folder:null},J.propTypes={breadcrumbs:g().oneOfType([f.Fv,g().bool]),canCreate:g().bool.isRequired,folder:f.nx,onToggleEditFolderDialog:g().func.isRequired,onToggleUploadAssetDialog:g().func.isRequired};var vt=t(73817),ht=t(44466),pt=t(31817),yt=t(42047),Ct=t(16838);const Mt=(0,$.default)(x.x)`
  height: ${32/16}rem;
  display: flex;
  align-items: center;
`,de=(0,$.default)(I.Z)`
  max-width: 100%;
`,ce=(0,$.default)(x.x)`
  svg {
    path {
      fill: ${({theme:n})=>n.colors.neutral500};
    }
  }
`,Ft=()=>{const{push:n}=(0,D.k6)(),{canRead:l,canCreate:o,canUpdate:r,canCopyLink:d,canDownload:c,isLoading:v}=(0,pt.y)(),E=(0,e.useRef)(),{formatMessage:u}=(0,L.Z)(),{pathname:p}=(0,D.TH)(),{trackUsage:h}=(0,m.useTracking)(),[{query:s},B]=(0,m.useQueryParams)(),M=Boolean(s._q||s.filters),[Z,z]=(0,m.usePersistentState)(f.uf.view,f.Uk.GRID),F=Z===f.Uk.GRID,{data:S,isLoading:At,errors:Tt}=(0,vt.L)({skipWhen:!l,query:s}),{data:Zt,isLoading:Dt,errors:Ot}=(0,ht.j)({enabled:l&&S?.pagination?.page===1&&!(0,i.rV)(s),query:s}),{data:X,isLoading:ue,error:Rt}=(0,yt.W)(s?.folder,{enabled:l&&!!s?.folder});Rt?.response?.status===404&&n(p);const U=Zt?.map(a=>({...a,type:"folder",folderURL:(0,i.Km)(p,s,a.id),isSelectable:r}))??[],y=U?.length||0,Q=S?.results?.map(a=>({...a,type:"asset",isSelectable:r}))||[],C=Q?.length??0,xt=S?.pagination?.total,me=ue||Dt||v||At,[It,Pt]=(0,e.useState)(!1),[zt,ge]=(0,e.useState)(!1),[fe,Y]=(0,e.useState)(void 0),[k,Ee]=(0,e.useState)(void 0),[A,{selectOne:b,selectAll:ve}]=(0,m.useSelectionState)(["type","id"],[]),he=A?.length>0&&A?.length!==C+y,w=()=>Pt(a=>!a),pe=({created:a=!1}={})=>{a&&s?.page!=="1"&&B({...s,page:1}),ge(V=>!V)},ye=(a,V)=>{a.target.checked&&h("didSelectAllMediaLibraryElements"),ve(V)},Ce=a=>{h("didSortMediaLibraryElements",{location:"upload",sort:a}),B({sort:a})},Me=a=>{Ee(a),ge(!0)},Ut=a=>{Ee(null),pe(a),E.current&&E.current.focus()},Fe=a=>{a===C&&S.pagination.page===S.pagination.pageCount&&S.pagination.page>1&&B({...s,page:S.pagination.page-1})},Qt=()=>{ve(),Fe(A.length)};return(0,m.useFocusWhenNavigate)(),e.createElement(Ae.A,null,e.createElement(ee.o,{"aria-busy":me},e.createElement(J,{breadcrumbs:!ue&&(0,i.M4)(X,{pathname:p,query:s}),canCreate:o,onToggleEditFolderDialog:pe,onToggleUploadAssetDialog:w,folder:X}),e.createElement(Te.Z,{startActions:e.createElement(e.Fragment,null,r&&F&&(C>0||y>0)&&e.createElement(Mt,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200"},e.createElement(Ze.C,{"aria-label":u({id:(0,i.OB)("bulk.select.label"),defaultMessage:"Select all folders & assets"}),indeterminate:he,value:(C>0||y>0)&&A.length===C+y,onChange:a=>ye(a,[...Q,...U])})),l&&F&&e.createElement(We.Z,{onChangeSort:Ce}),l&&e.createElement(ut,null)),endActions:e.createElement(e.Fragment,null,e.createElement(m.CheckPermissions,{permissions:Ct.Z.configureView},e.createElement(ce,{paddingTop:1,paddingBottom:1},e.createElement(G.h,{forwardedAs:Be.Link,to:{pathname:`${p}/configuration`,search:(0,te.stringify)(s,{encode:!1})},icon:e.createElement(xe.Z,null),label:u({id:"app.links.configure-view",defaultMessage:"Configure the view"})}))),e.createElement(ce,{paddingTop:1,paddingBottom:1},e.createElement(G.h,{icon:F?e.createElement(Ie.Z,null):e.createElement(Pe.Z,null),label:u(F?{id:(0,i.OB)("view-switch.list"),defaultMessage:"List View"}:{id:(0,i.OB)("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>z(F?f.Uk.LIST:f.Uk.GRID)})),e.createElement(m.SearchURLQuery,{label:u({id:(0,i.OB)("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}}))}),e.createElement(De.D,null,A.length>0&&e.createElement(j,{currentFolder:X,selected:A,onSuccess:Qt}),me&&e.createElement(m.LoadingIndicatorPage,null),(Tt||Ot)&&e.createElement(m.AnErrorOccurred,null),y===0&&C===0&&e.createElement(re,{canCreate:o,canRead:l,isFiltering:M,onActionClick:w}),l&&!F&&(C>0||y>0)&&e.createElement(Ge.b,{assetCount:C,folderCount:y,indeterminate:he,onChangeSort:Ce,onChangeFolder:a=>n((0,i.Km)(p,s,a)),onEditAsset:Y,onEditFolder:Me,onSelectOne:b,onSelectAll:ye,rows:[...U,...Q],selected:A,shouldDisableBulkSelect:!r,sortQuery:s?.sort??""}),l&&F&&e.createElement(e.Fragment,null,y>0&&e.createElement($e.a,{title:(M&&C>0||!M)&&u({id:(0,i.OB)("list.folders.title"),defaultMessage:"Folders ({count})"},{count:y})||""},U.map(a=>{const bt=!!A.filter(({type:q})=>q==="folder").find(q=>q.id===a.id),Se=(0,i.Km)(p,s,a?.id);return e.createElement(ae.P,{col:3,key:`folder-${a.id}`},e.createElement(P.Ac,{ref:k&&a.id===k.id?E:void 0,ariaLabel:a.name,id:`folder-${a.id}`,to:Se,startAction:b&&a.isSelectable?e.createElement(P.MM,{"data-testid":`folder-checkbox-${a.id}`,value:bt,onChange:()=>b(a)}):null,cardActions:e.createElement(G.h,{icon:e.createElement(ze.Z,null),"aria-label":u({id:(0,i.OB)("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>Me(a)})},e.createElement(P.Bu,null,e.createElement(P.u6,{to:Se},e.createElement(O.k,{as:"h2",direction:"column",alignItems:"start",maxWidth:"100%"},e.createElement(de,{fontWeight:"semiBold",ellipsis:!0},a.name,e.createElement(Oe.T,null,":")),e.createElement(de,{as:"span",textColor:"neutral600",variant:"pi",ellipsis:!0},u({id:(0,i.OB)("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:a.children.count,filesCount:a.files.count})))))))})),C>0&&y>0&&e.createElement(x.x,{paddingTop:6,paddingBottom:4},e.createElement(Re.i,null)),C>0&&e.createElement(Ve.r,{assets:Q,onEditAsset:Y,onSelectAsset:b,selectedAssets:A.filter(({type:a})=>a==="asset"),title:(!M||M&&y>0)&&S?.pagination?.page===1&&u({id:(0,i.OB)("list.assets.title"),defaultMessage:"Assets ({count})"},{count:xt})||""})),S?.pagination&&e.createElement(W,{pagination:S.pagination}))),It&&e.createElement(Ue.x,{onClose:w,trackedLocation:"upload",folderId:s?.folder}),zt&&e.createElement(Qe.f,{onClose:Ut,folder:k,parentFolderId:s?.folder,location:"upload"}),fe&&e.createElement(be.s,{onClose:a=>{a===null&&Fe(1),Y(void 0)},asset:fe,canUpdate:r,canCopyLink:d,canDownload:c,trackedLocation:"upload"}))};var St=t(60862);const Lt=(0,e.lazy)(()=>t.e(9514).then(t.bind(t,87532))),Bt=()=>{const{config:{isLoading:n,isError:l,data:o}}=(0,St.Z)(),[{rawQuery:r},d]=(0,m.useQueryParams)(),{formatMessage:c}=(0,L.Z)(),v=c({id:(0,i.OB)("plugin.name"),defaultMessage:"Media Library"});return(0,e.useEffect)(()=>{n||l||r||d({sort:o.sort,page:1,pageSize:o.pageSize})},[n,l,o,r,d]),(0,m.useFocusWhenNavigate)(),e.createElement(ee.o,{"aria-busy":n},e.createElement(Le.q,{title:v}),n&&e.createElement(m.LoadingIndicatorPage,null),r?e.createElement(e.Suspense,{fallback:e.createElement(m.LoadingIndicatorPage,null)},e.createElement(D.rs,null,e.createElement(D.AW,{exact:!0,path:`/plugins/${R.Z}`,component:Ft}),e.createElement(D.AW,{exact:!0,path:`/plugins/${R.Z}/configuration`,render:()=>e.createElement(Lt,{config:o})}))):null)}}}]);
