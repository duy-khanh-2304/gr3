"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[3455],{98906:(Ee,A,t)=>{t.r(A),t.d(A,{default:()=>ue});var e=t(67294),a=t(79946),b=t(87751),U=t(70780),W=t(36670),k=t(34263),B=t(12978),S=t(57713),V=t(79371),j=t(19442),z=t(15483),H=t(26789),Q=t(51541),$=t(62009),G=t(42403),I=t(6090),h=t(62351),y=t(77270),J=t(22996),K=t(94487),X=t(27361),Y=t.n(X),P=t(86896),w=t(16550),q=t(48474);const _=()=>"todo empty role";var ee=t(45697),D=t.n(ee),te=t(75878),le=t(50781),ne=t(37527);const Z=({id:s,name:o,description:l,usersCount:g,icons:i,rowIndex:u,canUpdate:E})=>{const{formatMessage:C}=(0,P.Z)(),[,r]=i,p=C({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:g});return e.createElement(I.Tr,{"aria-rowindex":u,key:s,...E?(0,a.onRowClick)({fn:r.onClick}):{}},e.createElement(h.Td,{maxWidth:(0,a.pxToRem)(130)},e.createElement(y.Z,{ellipsis:!0,textColor:"neutral800"},o)),e.createElement(h.Td,{maxWidth:(0,a.pxToRem)(250)},e.createElement(y.Z,{ellipsis:!0,textColor:"neutral800"},l)),e.createElement(h.Td,null,e.createElement(y.Z,{textColor:"neutral800"},p)),e.createElement(h.Td,null,e.createElement(te.k,{justifyContent:"flex-end",...a.stopPropagation},i.map((c,R)=>c?e.createElement(le.x,{key:c.label,paddingLeft:R===0?0:1},e.createElement(ne.h,{onClick:c.onClick,label:c.label,noBorder:!0,icon:c.icon})):null))))};Z.propTypes={id:D().number.isRequired,name:D().string.isRequired,description:D().string.isRequired,usersCount:D().number.isRequired,icons:D().array.isRequired,rowIndex:D().number.isRequired,canUpdate:D().bool},Z.defaultProps={canUpdate:!1};const se=Z;var ae=t(18172);const oe={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},ie=(s,o)=>(0,ae.ZP)(s,l=>{switch(o.type){case"ON_REMOVE_ROLES":{l.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{l.shouldRefetchData=!0,l.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{l.shouldRefetchData=!1,l.roleToDelete=null,l.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{l.roleToDelete=o.id;break}default:return l}}),re=()=>{(0,a.useFocusWhenNavigate)();const{locale:s}=(0,P.Z)(),{isLoading:o,allowedActions:{canCreate:l,canDelete:g,canRead:i,canUpdate:u}}=(0,a.useRBAC)(b.Z.settings.roles),{getData:E,roles:C,isLoading:r}=(0,q.bF)(!1),[{query:p}]=(0,a.useQueryParams)(),c=p?._q||"",{includes:R}=(0,a.useFilter)(s,{sensitivity:"base"}),T=(0,a.useCollator)(s,{sensitivity:"base"}),L=(C||[]).filter(f=>R(f.name,c)||R(f.description,c)).sort((f,v)=>T.compare(f.name,v.name)||T.compare(f.description,v.description));return(0,e.useEffect)(()=>{!o&&i&&E()},[o,i,E]),{isLoadingForPermissions:o,canCreate:l,canDelete:g,canRead:i,canUpdate:u,isLoading:r,getData:E,sortedRoles:L,roles:C}},ce=({getData:s,canCreate:o,canDelete:l,canUpdate:g})=>{const{formatMessage:i}=(0,P.Z)(),u=(0,a.useNotification)(),[E,C]=(0,e.useState)(!1),{push:r}=(0,w.k6)(),[{selectedRoles:p,showModalConfirmButtonLoading:c,roleToDelete:R},T]=(0,e.useReducer)(ie,oe),{post:L}=(0,a.getFetchClient)(),f=async()=>{try{T({type:"ON_REMOVE_ROLES"}),await L("/admin/roles/batch-delete",{ids:[R]}),await s(),T({type:"RESET_DATA_TO_DELETE"})}catch(n){const d=Y()(n,["response","payload","data","ids"],null);if(d&&Array.isArray(d)){const ge=d.join(`
`);u({type:"warning",message:ge})}else u({type:"warning",message:{id:"notification.error"}})}m()},v=(0,e.useCallback)(n=>{r(`/settings/roles/duplicate/${n}`)},[r]),x=()=>r("/settings/roles/new"),M=(0,e.useCallback)(n=>{T({type:"SET_ROLE_TO_DELETE",id:n}),m()},[]),m=()=>C(n=>!n),O=(0,e.useCallback)(n=>{r(`/settings/roles/${n}`)},[r]),N=(0,e.useCallback)((n,d)=>{n.preventDefault(),n.stopPropagation(),d.usersCount?u({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):M(d.id)},[u,M]),F=(0,e.useCallback)((n,d)=>{n.preventDefault(),n.stopPropagation(),v(d.id)},[v]),me=(0,e.useCallback)(n=>[...o?[{onClick:d=>F(d,n),label:i({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:e.createElement(U.Z,null)}]:[],...g?[{onClick:()=>O(n.id),label:i({id:"app.utils.edit",defaultMessage:"Edit"}),icon:e.createElement(W.Z,null)}]:[],...l?[{onClick:d=>N(d,n),label:i({id:"global.delete",defaultMessage:"Delete"}),icon:e.createElement(k.Z,null)}]:[]],[i,N,F,O,o,g,l]);return{handleNewRoleClick:x,getIcons:me,selectedRoles:p,isWarningDeleteAllOpened:E,showModalConfirmButtonLoading:c,handleToggleModal:m,handleDeleteData:f}},de=()=>{const{formatMessage:s}=(0,P.Z)(),{isLoadingForPermissions:o,canCreate:l,canRead:g,canDelete:i,canUpdate:u,isLoading:E,getData:C,sortedRoles:r}=re(),{handleNewRoleClick:p,getIcons:c,isWarningDeleteAllOpened:R,showModalConfirmButtonLoading:T,handleToggleModal:L,handleDeleteData:f}=ce({getData:C,canCreate:l,canDelete:i,canUpdate:u}),v=r.length+1,x=6;if(o)return e.createElement(S.o,null,e.createElement(a.LoadingIndicatorPage,null));const M=s({id:"global.roles",defaultMessage:"roles"});return e.createElement(S.o,null,e.createElement(a.SettingsPageTitle,{name:"Roles"}),e.createElement(V.T,{primaryAction:l?e.createElement(j.z,{onClick:p,startIcon:e.createElement(B.Z,null),size:"S"},s({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null,title:M,subtitle:s({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),g&&e.createElement(z.Z,{startActions:e.createElement(a.SearchURLQuery,{label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:M})})}),g&&e.createElement(H.D,null,e.createElement(Q.i,{colCount:x,rowCount:v,footer:l?e.createElement($.c,{onClick:p,icon:e.createElement(B.Z,null)},s({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null},e.createElement(G.h,null,e.createElement(I.Tr,{"aria-rowindex":1},e.createElement(h.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},s({id:"global.name",defaultMessage:"Name"}))),e.createElement(h.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},s({id:"global.description",defaultMessage:"Description"}))),e.createElement(h.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},s({id:"global.users",defaultMessage:"Users"}))),e.createElement(h.Th,null,e.createElement(J.T,null,s({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(K.p,null,r?.map((m,O)=>e.createElement(se,{key:m.id,id:m.id,name:m.name,description:m.description,usersCount:m.usersCount,icons:c(m),rowIndex:O+2,canUpdate:u})))),!v&&!E&&e.createElement(_,null)),e.createElement(a.ConfirmDialog,{isOpen:R,onConfirm:f,isConfirmButtonLoading:T,onToggleDialog:L}))},ue=()=>e.createElement(a.CheckPagePermissions,{permissions:b.Z.settings.roles.main},e.createElement(de,null))}}]);
