(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[2282],{8971:(p,L,e)=>{"use strict";e.r(L),e.d(L,{ProvidersPage:()=>de,default:()=>Fe});var t=e(67294),o=e(86896),a=e(79946),s=e(18721),l=e.n(s),u=e(11700),n=e.n(u),c=e(46683),g=e(45349),b=e(57713),y=e(79371),m=e(26789),j=e(51541),S=e(42403),U=e(6090),h=e(62351),O=e(77270),ee=e(22996),$=e(94487),X=e(37527),me=e(36670),Q=e(88767),i=e(87561),v=e(89031);const te={id:(0,v.OB)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},ae={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},V={id:(0,v.OB)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},k={id:(0,v.OB)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},re={id:(0,v.OB)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},ne={id:(0,v.OB)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},D={id:(0,v.OB)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},se={id:(0,v.OB)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},J={email:{form:[[{intlLabel:k,name:"enabled",type:"bool",description:V,size:6}]],schema:i.Ry().shape({enabled:i.Xg().required(a.translatedErrors.required)})},providers:{form:[[{intlLabel:k,name:"enabled",type:"bool",description:V,size:6,validations:{required:!0}}],[{intlLabel:re,name:"key",type:"text",placeholder:D,size:12,validations:{required:!0}}],[{intlLabel:se,name:"secret",type:"text",placeholder:D,size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:ae,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:ne,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:i.Ry().shape({enabled:i.Xg().required(a.translatedErrors.required),key:i.Z_().when("enabled",{is:!0,then:i.Z_().required(a.translatedErrors.required),otherwise:i.Z_()}),secret:i.Z_().when("enabled",{is:!0,then:i.Z_().required(a.translatedErrors.required),otherwise:i.Z_()}),callback:i.Z_().when("enabled",{is:!0,then:i.Z_().required(a.translatedErrors.required),otherwise:i.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:k,name:"enabled",type:"bool",description:V,size:6,validations:{required:!0}}],[{intlLabel:re,name:"key",type:"text",placeholder:D,size:12,validations:{required:!0}}],[{intlLabel:se,name:"secret",type:"text",placeholder:D,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,v.OB)({id:"PopUpForm.Providers.jwksurl.label"}),defaultMessage:"JWKS URL"},name:"jwksurl",type:"text",placeholder:D,size:12,validations:{required:!1}}],[{intlLabel:{id:(0,v.OB)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,v.OB)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:ae,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:ne,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:i.Ry().shape({enabled:i.Xg().required(a.translatedErrors.required),key:i.Z_().when("enabled",{is:!0,then:i.Z_().required(a.translatedErrors.required),otherwise:i.Z_()}),secret:i.Z_().when("enabled",{is:!0,then:i.Z_().required(a.translatedErrors.required),otherwise:i.Z_()}),subdomain:i.Z_().when("enabled",{is:!0,then:i.Z_().required(a.translatedErrors.required),otherwise:i.Z_()}),callback:i.Z_().when("enabled",{is:!0,then:i.Z_().required(a.translatedErrors.required),otherwise:i.Z_()})})}},ge=async d=>{try{const{get:E}=(0,a.getFetchClient)(),{data:T}=await E((0,v.Gc)("providers"));return T}catch{throw d({type:"warning",message:{id:"notification.error"}}),new Error("error")}},fe=d=>{const{put:E}=(0,a.getFetchClient)();return E((0,v.Gc)("providers"),d)};var ve=e(89734),pe=e.n(ve);const he=d=>pe()(Object.keys(d).reduce((E,T)=>{const{icon:x,enabled:M,subdomain:R}=d[T],B=x==="envelope"?["fas","envelope"]:["fab",x];return R!==void 0?E.push({name:T,icon:B,enabled:M,subdomain:R}):E.push({name:T,icon:B,enabled:M}),E},[]),"name");var ie=e(81912),be=e(60881),ye=e(18189),oe=e(78784),Ee=e(48683),Pe=e(75878),Me=e(9370),Le=e(61585),Te=e(45124),le=e(19442),Be=e(45697),r=e.n(Be),xe=e(41054),Oe=e(58885),Ce=e(28469);const K=({description:d,disabled:E,intlLabel:T,error:x,name:M,onChange:R,placeholder:B,providerToEditName:A,type:F,value:f})=>{const{formatMessage:C}=(0,o.Z)(),z=M==="noName"?`${window.strapi.backendURL}/api/connect/${A}/callback`:f,N=C({id:T.id,defaultMessage:T.defaultMessage},{provider:A,...T.values}),Z=d?C({id:d.id,defaultMessage:d.defaultMessage},{provider:A,...d.values}):"";if(F==="bool")return t.createElement(Oe.s,{"aria-label":M,checked:f,disabled:E,hint:Z,label:N,name:M,offLabel:C({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:C({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:G=>{R({target:{name:M,value:G.target.checked}})}});const I=B?C({id:B.id,defaultMessage:B.defaultMessage},{...B.values}):"",w=x?C({id:x,defaultMessage:x}):"";return t.createElement(Ce.o,{"aria-label":M,disabled:E,error:w,label:N,name:M,onChange:R,placeholder:I,type:F,value:z})};K.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},K.propTypes={description:r().shape({id:r().string.isRequired,defaultMessage:r().string.isRequired,values:r().object}),disabled:r().bool,error:r().string,intlLabel:r().shape({id:r().string.isRequired,defaultMessage:r().string.isRequired,values:r().object}).isRequired,name:r().string.isRequired,onChange:r().func.isRequired,placeholder:r().shape({id:r().string.isRequired,defaultMessage:r().string.isRequired,values:r().object}),providerToEditName:r().string.isRequired,type:r().string.isRequired,value:r().oneOfType([r().bool,r().string])};const Ze=K,Y=({headerBreadcrumbs:d,initialData:E,isSubmiting:T,layout:x,isOpen:M,onSubmit:R,onToggle:B,providerToEditName:A})=>{const{formatMessage:F}=(0,o.Z)();return M?t.createElement(be.P,{onClose:B,labelledBy:"title"},t.createElement(ye.x,null,t.createElement(oe.O,{label:d.join(", ")},d.map(f=>t.createElement(oe.$,{key:f},f)))),t.createElement(xe.Formik,{onSubmit:f=>R(f),initialValues:E,validationSchema:x.schema,validateOnChange:!1},({errors:f,handleChange:C,values:z})=>t.createElement(a.Form,null,t.createElement(Ee.f,null,t.createElement(Pe.k,{direction:"column",alignItems:"stretch",gap:1},t.createElement(Me.r,{gap:5},x.form.map(N=>N.map(Z=>t.createElement(Le.P,{key:Z.name,col:Z.size,xs:12},t.createElement(Ze,{...Z,error:f[Z.name],onChange:C,value:z[Z.name],providerToEditName:A}))))))),t.createElement(Te.m,{startActions:t.createElement(le.z,{variant:"tertiary",onClick:B,type:"button"},F({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:t.createElement(le.z,{type:"submit",loading:T},F({id:"global.save",defaultMessage:"Save"}))})))):null};Y.defaultProps={initialData:null,providerToEditName:null},Y.propTypes={headerBreadcrumbs:r().arrayOf(r().string).isRequired,initialData:r().object,layout:r().shape({form:r().arrayOf(r().array),schema:r().object}).isRequired,isOpen:r().bool.isRequired,isSubmiting:r().bool.isRequired,onSubmit:r().func.isRequired,onToggle:r().func.isRequired,providerToEditName:r().string};const Re=Y,de=()=>{const{formatMessage:d}=(0,o.Z)();(0,a.useFocusWhenNavigate)();const{notifyStatus:E}=(0,c.G)(),T=(0,Q.useQueryClient)(),{trackUsage:x}=(0,a.useTracking)(),M=(0,t.useRef)(x),[R,B]=(0,t.useState)(!1),[A,F]=(0,t.useState)(!1),[f,C]=(0,t.useState)(null),z=(0,a.useNotification)(),{lockApp:N,unlockApp:Z}=(0,a.useOverlayBlocker)(),I=(0,t.useMemo)(()=>({update:ie.Z.updateProviders}),[]),{isLoading:w,allowedActions:{canUpdate:G}}=(0,a.useRBAC)(I),{isLoading:Ue,data:H,isFetching:Se}=(0,Q.useQuery)("get-providers",()=>ge(z),{onSuccess(){E(d({id:(0,v.OB)("Providers.data.loaded"),defaultMessage:"Providers have been loaded"}))},initialData:{}}),Ae=Ue||Se,ze=(0,Q.useMutation)(fe,{async onSuccess(){await T.invalidateQueries("get-providers"),z({type:"info",message:{id:(0,v.OB)("notification.success.submit")}}),M.current("didEditAuthenticationProvider"),F(!1),q(),Z()},onError(){z({type:"warning",message:{id:"notification.error"}}),Z(),F(!1)},refetchActive:!1}),W=(0,t.useMemo)(()=>he(H),[H]),je=W.length,ue=(0,t.useMemo)(()=>{if(!f)return!1;const P=W.find(_=>_.name===f);return l()(P,"subdomain")},[W,f]),Ne=d({id:(0,v.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"}),De=(0,t.useMemo)(()=>f==="email"?J.email:ue?J.providersWithSubdomain:J.providers,[f,ue]),q=()=>{B(P=>!P)},ce=P=>{G&&(C(P.name),q())},Ge=async P=>{F(!0),N(),M.current("willEditAuthenticationProvider");const _={...H,[f]:P};ze.mutate({providers:_})};return t.createElement(g.A,null,t.createElement(a.SettingsPageTitle,{name:Ne}),t.createElement(b.o,null,t.createElement(y.T,{title:d({id:(0,v.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),Ae||w?t.createElement(a.LoadingIndicatorPage,null):t.createElement(m.D,null,t.createElement(j.i,{colCount:3,rowCount:je+1},t.createElement(S.h,null,t.createElement(U.Tr,null,t.createElement(h.Th,null,t.createElement(O.Z,{variant:"sigma",textColor:"neutral600"},d({id:"global.name",defaultMessage:"Name"}))),t.createElement(h.Th,null,t.createElement(O.Z,{variant:"sigma",textColor:"neutral600"},d({id:(0,v.OB)("Providers.status"),defaultMessage:"Status"}))),t.createElement(h.Th,null,t.createElement(O.Z,{variant:"sigma"},t.createElement(ee.T,null,d({id:"global.settings",defaultMessage:"Settings"})))))),t.createElement($.p,null,W.map(P=>t.createElement(U.Tr,{key:P.name,...(0,a.onRowClick)({fn:()=>ce(P),condition:G})},t.createElement(h.Td,{width:"45%"},t.createElement(O.Z,{fontWeight:"semiBold",textColor:"neutral800"},P.name)),t.createElement(h.Td,{width:"65%"},t.createElement(O.Z,{textColor:P.enabled?"success600":"danger600","data-testid":`enable-${P.name}`},P.enabled?d({id:"global.enabled",defaultMessage:"Enabled"}):d({id:"global.disabled",defaultMessage:"Disabled"}))),t.createElement(h.Td,{...a.stopPropagation},G&&t.createElement(X.h,{onClick:()=>ce(P),noBorder:!0,icon:t.createElement(me.Z,null),label:"Edit"})))))))),t.createElement(Re,{initialData:H[f],isOpen:R,isSubmiting:A,layout:De,headerBreadcrumbs:[d({id:(0,v.OB)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),n()(f)],onToggle:q,onSubmit:Ge,providerToEditName:f}))},Fe=()=>t.createElement(a.CheckPagePermissions,{permissions:ie.Z.readProviders},t.createElement(de,null))},89031:(p,L,e)=>{"use strict";e.d(L,{YX:()=>s,Gc:()=>n,OB:()=>c.Z});var t=e(41609),o=e.n(t);const s=g=>Object.keys(g).reduce((b,y)=>{const m=g[y].controllers,j=Object.keys(m).reduce((S,U)=>(o()(m[U])||(S[U]=m[U]),S),{});return o()(j)||(b[y]={controllers:j}),b},{});var l=e(31498);const n=g=>`/${l.Z}/${g}`;var c=e(84757)},89881:(p,L,e)=>{var t=e(47816),o=e(99291),a=o(t);p.exports=a},69199:(p,L,e)=>{var t=e(89881),o=e(98612);function a(s,l){var u=-1,n=o(s)?Array(s.length):[];return t(s,function(c,g,b){n[++u]=l(c,g,b)}),n}p.exports=a},82689:(p,L,e)=>{var t=e(29932),o=e(97786),a=e(67206),s=e(69199),l=e(71131),u=e(7518),n=e(85022),c=e(6557),g=e(1469);function b(y,m,j){m.length?m=t(m,function(h){return g(h)?function(O){return o(O,h.length===1?h[0]:h)}:h}):m=[c];var S=-1;m=t(m,u(a));var U=s(y,function(h,O,ee){var $=t(m,function(X){return X(h)});return{criteria:$,index:++S,value:h}});return l(U,function(h,O){return n(h,O,j)})}p.exports=b},71131:p=>{function L(e,t){var o=e.length;for(e.sort(t);o--;)e[o]=e[o].value;return e}p.exports=L},26393:(p,L,e)=>{var t=e(33448);function o(a,s){if(a!==s){var l=a!==void 0,u=a===null,n=a===a,c=t(a),g=s!==void 0,b=s===null,y=s===s,m=t(s);if(!b&&!m&&!c&&a>s||c&&g&&y&&!b&&!m||u&&g&&y||!l&&y||!n)return 1;if(!u&&!c&&!m&&a<s||m&&l&&n&&!u&&!c||b&&l&&n||!g&&n||!y)return-1}return 0}p.exports=o},85022:(p,L,e)=>{var t=e(26393);function o(a,s,l){for(var u=-1,n=a.criteria,c=s.criteria,g=n.length,b=l.length;++u<g;){var y=t(n[u],c[u]);if(y){if(u>=b)return y;var m=l[u];return y*(m=="desc"?-1:1)}}return a.index-s.index}p.exports=o},99291:(p,L,e)=>{var t=e(98612);function o(a,s){return function(l,u){if(l==null)return l;if(!t(l))return a(l,u);for(var n=l.length,c=s?n:-1,g=Object(l);(s?c--:++c<n)&&u(g[c],c,g)!==!1;);return l}}p.exports=o},89734:(p,L,e)=>{var t=e(21078),o=e(82689),a=e(5976),s=e(16612),l=a(function(u,n){if(u==null)return[];var c=n.length;return c>1&&s(u,n[0],n[1])?n=[]:c>2&&s(n[0],n[1],n[2])&&(n=[n[0]]),o(u,t(n,1),[])});p.exports=l}}]);
