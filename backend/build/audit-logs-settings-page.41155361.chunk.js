"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[2812],{94699:(Y,C,t)=>{t.d(C,{Z:()=>U});var e=t(67294),u=t(45697),g=t.n(u),f=t(86896),b=t(50781),D=t(19442),v=t(36002),P=t(79946);const S=({displayedFilters:R})=>{const[s,F]=(0,e.useState)(!1),{formatMessage:I}=(0,f.Z)(),M=(0,e.useRef)(),E=()=>{F(h=>!h)};return e.createElement(e.Fragment,null,e.createElement(b.x,{paddingTop:1,paddingBottom:1},e.createElement(D.z,{variant:"tertiary",ref:M,startIcon:e.createElement(v.Z,null),onClick:E,size:"S"},I({id:"app.utils.filters",defaultMessage:"Filters"})),s&&e.createElement(P.FilterPopoverURLQuery,{displayedFilters:R,isVisible:s,onToggle:E,source:M})),e.createElement(P.FilterListURLQuery,{filtersSchema:R}))};S.propTypes={displayedFilters:g().arrayOf(g().shape({name:g().string.isRequired,metadatas:g().shape({label:g().string}),fieldSchema:g().shape({type:g().string})})).isRequired};const U=S},35915:(Y,C,t)=>{t.r(C),t.d(C,{default:()=>Ee});var e=t(67294),u=t(79946),g=t(87751),f=t(86896),b=t(45349),D=t(26789),v=t(50781),P=t(57713),S=t(79371),U=t(15483),R=t(45697),s=t.n(R),F=t(94487),I=t(6090),M=t(62351),E=t(77270),h=t(75878),G=t(37527),X=t(2953),w=t(23855);const Q=()=>{const{formatDate:a}=(0,f.Z)();return d=>{const o=(0,w.Z)(d),m=a(o,{dateStyle:"long"}),i=a(o,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${i}`}},W={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},B=a=>W[a]||a,Z=({headers:a,rows:l,onOpenModal:d})=>{const{formatMessage:o}=(0,f.Z)(),m=Q(),i=({type:r,value:n,model:c})=>r==="date"?m(n):r==="action"?o({id:`Settings.permissions.auditLogs.${n}`,defaultMessage:B(n)},{model:c}):n||"-";return e.createElement(F.p,null,l.map(r=>e.createElement(I.Tr,{key:r.id,...(0,u.onRowClick)({fn:()=>d(r.id)})},a.map(({key:n,name:c,cellFormatter:p})=>e.createElement(M.Td,{key:n},e.createElement(E.Z,{textColor:"neutral800"},i({type:n,value:p?p(r[c]):r[c],model:r.payload?.model})))),e.createElement(M.Td,{...u.stopPropagation},e.createElement(h.k,{justifyContent:"end"},e.createElement(G.h,{onClick:()=>d(r.id),"aria-label":o({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${r.action} action`}),noBorder:!0,icon:e.createElement(X.Z,null)}))))))};Z.defaultProps={rows:[]},Z.propTypes={headers:s().array.isRequired,rows:s().array,onOpenModal:s().func.isRequired};const k=Z,q=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],N=({pagination:a})=>e.createElement(v.x,{paddingTop:4},e.createElement(h.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(u.PageSizeURLQuery,null),e.createElement(u.PaginationURLQuery,{pagination:a})));N.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},N.propTypes={pagination:s().shape({page:s().number,pageCount:s().number,pageSize:s().number,total:s().number})};const _=N;var x=t(88767),ee=t(60881),te=t(18189),K=t(78784),ae=t(48683),se=t(28809),ne=t(9370),oe=t(38289);const j=({actionLabel:a,actionName:l})=>e.createElement(h.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(E.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(E.Z,{textColor:"neutral600"},l));j.propTypes={actionLabel:s().string.isRequired,actionName:s().string.isRequired};const A=j,V=({status:a,data:l,formattedDate:d})=>{const{formatMessage:o}=(0,f.Z)();if(a==="loading")return e.createElement(h.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(se.a,null,"Loading content..."));const{action:m,user:i,payload:r}=l;return e.createElement(e.Fragment,null,e.createElement(v.x,{marginBottom:3},e.createElement(E.Z,{variant:"delta",id:"title"},o({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ne.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(A,{actionLabel:o({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:o({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:B(m)},{model:r?.model})}),e.createElement(A,{actionLabel:o({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:d}),e.createElement(A,{actionLabel:o({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:i?.displayName||"-"}),e.createElement(A,{actionLabel:o({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:i?.id.toString()||"-"})),e.createElement(oe.V,{value:JSON.stringify(r,null,2),disabled:!0,label:o({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};V.defaultProps={data:{}},V.propTypes={status:s().oneOf(["idle","loading","error","success"]).isRequired,data:s().shape({action:s().string,date:s().string,payload:s().object,user:s().object}),formattedDate:s().string.isRequired};const ie=V,H=({handleClose:a,logId:l})=>{const{get:d}=(0,u.useFetchClient)(),o=(0,u.useNotification)(),m=async p=>{const{data:y}=await d(`/admin/audit-logs/${p}`);if(!y)throw new Error("Audit log not found");return y},{data:i,status:r}=(0,x.useQuery)(["audit-log",l],()=>m(l),{onError(){o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),n=Q(),c=i?n(i.date):"";return e.createElement(ee.P,{onClose:a,labelledBy:"title"},e.createElement(te.x,null,e.createElement(K.O,{label:c,id:"title"},e.createElement(K.$,null,c))),e.createElement(ae.f,null,e.createElement(ie,{status:r,data:i,formattedDate:c})))};H.propTypes={handleClose:s().func.isRequired,logId:s().string.isRequired};const re=H;var le=t(94699),de=t(63122),me=t(85612);const $=({value:a,options:l,onChange:d})=>{const{formatMessage:o}=(0,f.Z)(),m=o({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(de.hQ,{"aria-label":m,value:a,onChange:d},l.map(({label:i,customValue:r})=>e.createElement(me.O,{key:r,value:r},i)))};$.defaultProps={value:null},$.propTypes={value:s().string,options:s().arrayOf(s().shape({label:s().string.isRequired,customValue:s().string.isRequired}).isRequired).isRequired,onChange:s().func.isRequired};const z=$,J=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],ue=({formatMessage:a,users:l,canReadUsers:d})=>{const o=Object.keys(W).map(i=>({label:a({id:`Settings.permissions.auditLogs.${i}`,defaultMessage:B(i)},{model:void 0}),customValue:i})),m=[{name:"action",metadatas:{customOperators:J,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:o,customInput:z},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(d&&l){const i=n=>n.username?n.username:n.firstname&&n.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:n.firstname,lastname:n.lastname}):n.email,r=l.results.map(n=>({label:i(n),customValue:n.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:J,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:r,customInput:z},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m};var ce=t(16550);const ge=({canReadAuditLogs:a,canReadUsers:l})=>{const{get:d}=(0,u.useFetchClient)(),{search:o}=(0,ce.TH)(),m=(0,u.useNotification)(),i=async({queryKey:T})=>{const Le=T[1],{data:he}=await d(`/admin/audit-logs${Le}`);return he},r=async()=>{const{data:T}=await d("/admin/users");return T},n={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:T=>m({type:"warning",message:T.message})},{data:c,isLoading:p,isError:y}=(0,x.useQuery)(["auditLogs",o],i,{...n,enabled:a}),{data:O,isError:L}=(0,x.useQuery)(["auditLogsUsers"],r,{...n,enabled:l,staleTime:2*(1e3*60)}),ye=y||L;return{auditLogs:c,users:O?.data,isLoading:p,hasError:ye}},pe={...g.Z.settings.auditLogs,readUsers:g.Z.settings.users.read},fe=()=>{const{formatMessage:a}=(0,f.Z)(),{allowedActions:{canRead:l,canReadUsers:d}}=(0,u.useRBAC)(pe),[{query:o},m]=(0,u.useQueryParams)(),{auditLogs:i,users:r,isLoading:n,hasError:c}=ge({canReadAuditLogs:l,canReadUsers:d});(0,u.useFocusWhenNavigate)();const p=ue({formatMessage:a,users:r,canReadUsers:d}),y=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),O=q.map(L=>({...L,metadatas:{...L.metadatas,label:a(L.metadatas.label)}}));return c?e.createElement(b.A,null,e.createElement(D.D,null,e.createElement(v.x,{paddingTop:8},e.createElement(u.AnErrorOccurred,null)))):e.createElement(P.o,{"aria-busy":n},e.createElement(u.SettingsPageTitle,{name:y}),e.createElement(S.T,{title:y,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(U.Z,{startActions:e.createElement(le.Z,{displayedFilters:p})}),e.createElement(D.D,{canRead:l},e.createElement(u.DynamicTable,{contentType:"Audit logs",headers:O,rows:i?.results||[],withBulkActions:!0,isLoading:n},e.createElement(k,{headers:O,rows:i?.results||[],onOpenModal:L=>m({id:L})})),e.createElement(_,{pagination:i?.pagination})),o?.id&&e.createElement(re,{handleClose:()=>m({id:null},"remove"),logId:o.id}))},Ee=()=>e.createElement(u.CheckPagePermissions,{permissions:g.Z.settings.auditLogs.main},e.createElement(fe,null))}}]);
