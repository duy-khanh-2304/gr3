"use strict";(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[1077],{62579:(ee,x,s)=>{s.r(x),s.d(x,{default:()=>Z});var t=s(67294),z=function c(e,l){if(e===l)return!0;if(e&&l&&typeof e=="object"&&typeof l=="object"){if(e.constructor!==l.constructor)return!1;var a,d,S;if(Array.isArray(e)){if(a=e.length,a!=l.length)return!1;for(d=a;d--!==0;)if(!c(e[d],l[d]))return!1;return!0}if(e.constructor===RegExp)return e.source===l.source&&e.flags===l.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===l.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===l.toString();if(S=Object.keys(e),a=S.length,a!==Object.keys(l).length)return!1;for(d=a;d--!==0;)if(!Object.prototype.hasOwnProperty.call(l,S[d]))return!1;for(d=a;d--!==0;){var f=S[d];if(!c(e[f],l[f]))return!1}return!0}return e!==e&&l!==l};const o="__googleMapsScriptId";var m;(function(c){c[c.INITIALIZED=0]="INITIALIZED",c[c.LOADING=1]="LOADING",c[c.SUCCESS=2]="SUCCESS",c[c.FAILURE=3]="FAILURE"})(m||(m={}));class h{constructor({apiKey:e,authReferrerPolicy:l,channel:a,client:d,id:S=o,language:f,libraries:P=[],mapIds:g,nonce:R,region:I,retries:T=3,url:j="https://maps.googleapis.com/maps/api/js",version:y}){if(this.CALLBACK="__googleMapsCallback",this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=l,this.channel=a,this.client=d,this.id=S||o,this.language=f,this.libraries=P,this.mapIds=g,this.nonce=R,this.region=I,this.retries=T,this.url=j,this.version=y,h.instance){if(!z(this.options,h.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(h.instance.options)}`);return h.instance}h.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?m.FAILURE:this.done?m.SUCCESS:this.loading?m.LOADING:m.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+=`?callback=${this.CALLBACK}`,this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,l)=>{this.loadCallback(a=>{a?l(a.error):e(window.google)})})}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){if(document.getElementById(this.id)){this.callback();return}const e=this.createUrl(),l=document.createElement("script");l.id=this.id,l.type="text/javascript",l.src=e,l.onerror=this.loadErrorCallback.bind(this),l.defer=!0,l.async=!0,this.nonce&&(l.nonce=this.nonce),document.head.appendChild(l)}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const l=this.errors.length*Math.pow(2,this.errors.length);console.log(`Failed to load Google Maps script, retrying in ${l} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},l)}else this.onerrorEvent=e,this.callback()}setCallback(){window.__googleMapsCallback=this.callback.bind(this)}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading||(this.loading=!0,this.setCallback(),this.setScript())}}}var U=s(75878),w=s(50781),K=s(29872),H=s(63122),Q=s(85612),B=s(79946);function Z({onChange:c,value:e,name:l,attribute:a,error:d,required:S}){const[f,P]=(0,t.useState)(null),[g,R]=(0,t.useState)(null),[I,T]=(0,t.useState)(null),[j,y]=(0,t.useState)(null),X=async()=>{const{signal:n}=new AbortController,{fields:i,autocompletionRequestOptions:r,googleMapsApiKey:u}=await(0,B.request)("/location-field/config",{method:"GET",signal:n});return{fields:i,autocompletionRequestOptions:r,googleMapsApiKey:u}};t.useEffect(()=>{X().then(n=>{P(n.googleMapsApiKey),n.fields=n.fields||[],n.fields.includes("geometry")||n.fields.push("geometry"),R(n.fields),y(n.autocompletionRequestOptions)})},[]),t.useEffect(()=>{if(f){const n=new h({apiKey:f,version:"weekly",libraries:["places"]});T(n)}},[f]),t.useEffect(()=>{g&&!g.includes("geometry")&&g.push("geometry")},[g]);const[L,Y]=(0,t.useState)([]),W=n=>{if(!n.target.value){C({description:"",place_id:"no_location",lat:null,lng:null},!0),Y([]);return}(async()=>{I.load().then(r=>{let u=new r.maps.places.AutocompleteSessionToken;new r.maps.places.AutocompleteService().getPlacePredictions({...j,input:n.target.value,sessionToken:u},(A,p)=>{if(p!==r.maps.places.PlacesServiceStatus.OK){console.error(p);return}A.length>0&&Y(A)})})})()},C=(n,i)=>{if(!n)return;let r=null;if(i)r=JSON.stringify(n),c({target:{name:l,value:r,type:a.type}});else{let u=L.find(O=>O.place_id===n);I.load().then(O=>{new O.maps.places.PlacesService(document.createElement("div")).getDetails({placeId:u.place_id,fields:g},(p,F)=>{if(F!==O.maps.places.PlacesServiceStatus.OK){console.error(F);return}g.includes("photo")&&p?.photos&&p.photos.forEach(b=>{b.url=b.getUrl()}),u.details=p,r=JSON.stringify({description:u.description,place_id:u.place_id,lat:u.details.geometry.location.lat(),lng:u.details.geometry.location.lng(),details:u.details}),c({target:{name:l,value:r,type:a.type}})})})}},k=(n,i)=>{let r=null;e!=="null"?r=JSON.parse(e):r={description:"",place_id:"no_location",lat:null,lng:null},i==="lat"?r.lat=n||null:r.lng=n||null,c({target:{name:l,value:JSON.stringify(r),type:a.type}})},M=n=>{C({description:n,place_id:"custom_location",lat:null,lng:null},!0)};return t.createElement(U.k,{direction:"column",alignItems:"start",gap:3},t.createElement(w.x,{width:"100%"},I&&f&&g&&t.createElement(H.hQ,{label:"Location",name:"location",error:d,required:S,placeholder:"Ex. 123 Street, Niagara Falls, ON",onChange:n=>C(n,!1),onInputChange:n=>W(n),value:e!=="null"&&JSON.parse(e).place_id!=="no_location"?JSON.parse(e).place_id:"",onClear:()=>{C({description:"",place_id:"no_location",lat:null,lng:null},!0)},creatable:!0,createMessage:n=>`Create Location: "${n}"`,onCreateOption:n=>M(n)},L.map(n=>t.createElement(Q.O,{key:n.place_id,value:n.place_id},n.description)).concat([t.createElement("div",{key:"no_location",value:"no_location",style:{display:"none"}},"No Location")]).concat([t.createElement("div",{key:"custom_location",value:"custom_location",style:{display:"none"}},e!=="null"&&JSON.parse(e).place_id==="custom_location"?JSON.parse(e).description:"Custom Location")]).concat([t.createElement("div",{key:"selected",value:e!=="null"?JSON.parse(e).place_id:"",style:{display:"none"}},e!=="null"?JSON.parse(e).description:"")]))),e!=="null"&&JSON.parse(e).place_id==="custom_location"&&t.createElement(U.k,{gap:2},t.createElement(K.Y,{label:"Latitude",name:"latitude",placeholder:"Ex. 43.123456",onValueChange:n=>k(n,"lat"),value:e!=="null"?JSON.parse(e).lat:null}),t.createElement(K.Y,{label:"Longitude",name:"longitude",placeholder:"Ex. -79.123456",onValueChange:n=>k(n,"lng"),value:e!=="null"?JSON.parse(e).lng:null})))}Z.defaultProps={value:"null"}},69265:(ee,x,s)=>{s.r(x),s.d(x,{default:()=>n});var t=s(67294),z=s(45697),o=s.n(z),m=s(96486),h=s(29728),U=s(54574),w=s(19270),K=s(63428),H=s(96404),Q=s(7681),B=s(75515),Z=s(41580),c=s(23620),e=s(44012),l=s(86896),a=s(42866),d=s(24969),S=s(59946),f=s(36856),P=s(16364),g=s(52861),R=s(79946);const I=g.Z.create({baseURL:""});I.interceptors.request.use(async i=>(i.headers={Authorization:`Bearer ${R.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},i),i=>{Promise.reject(i)}),I.interceptors.response.use(i=>i,i=>{throw i.response?.status===401&&(R.auth.clearAppStorage(),window.location.reload()),i});const T=I;var j=s(10371),y=s.n(j);const L=i=>`${y()}.${i}`,W=i=>`/${y()}/${i}`,C=({onClose:i,onImport:r,value:u})=>{const{formatMessage:O}=(0,l.Z)(),[A,p]=(0,t.useState)(!1),[F,b]=(0,t.useState)(""),[J,D]=(0,t.useState)(""),E=new AbortController,V=async()=>{p(!0);const{signal:v}=E;try{b("");const{data:N}=await T.get(W(`fetch?url=${encodeURIComponent(J)}`,{method:"GET",signal:v}));p(!1),N.error?b(N.error):(r(N),i())}catch(N){b(N.message),p(!1)}};(0,t.useEffect)(()=>(D((0,m.isObject)(u)&&u.url?u.url:""),setTimeout(()=>{const v=document.getElementById("oembed-form-url");v&&v.focus()},150),()=>{E.abort()}),[]);const $=v=>{v.keyCode===13&&(v.preventDefault(),V())};return t.createElement(a.P,{onClose:i,style:{width:"35rem"},labelledBy:"title"},t.createElement(d.x,null,t.createElement("section",null,t.createElement(B.Z,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"title"},t.createElement(e.Z,{id:`${y()}.modal.import.title`})))),t.createElement("form",null,t.createElement(S.f,null,t.createElement(P.o,{id:"oembed-form-url",label:O({id:L("modal.import.input.label")}),hint:O({id:L("modal.import.input.description")}),validations:{required:!0},onChange:({target:{value:v}})=>{D(v)},onKeyDown:$,error:F,name:"name",type:"text",value:J})),t.createElement(f.m,{startActions:t.createElement(h.z,{onClick:i,variant:"tertiary"},t.createElement(e.Z,{id:"app.components.Button.cancel"})),endActions:t.createElement(t.Fragment,null,t.createElement(h.z,{variant:"default",loading:A,onClick:V},t.createElement(e.Z,{id:`${y()}.modal.import.button.import`})))})))};C.defaultProps={value:{}},C.propTypes={onClose:o().func.isRequired,onImport:o().func.isRequired,value:o().object};const k=C,M=({description:i,error:r,name:u,intlLabel:O,onChange:A,value:p,required:F})=>{const[b,J]=(0,t.useState)(!1),D=G=>{let _=null;try{_=JSON.parse(G)}catch{}return _},[E,V]=(0,t.useState)(D(p));(0,t.useEffect)(()=>{V(D(p))},[p]);const $=(0,t.useMemo)(()=>!!((0,m.isObject)(E)&&E.url),[E]),v=()=>{J(!0)},N=()=>{J(!1)},q=G=>{A({target:{name:u,value:(0,m.isObject)(G)?JSON.stringify(G):null}})};return t.createElement(U.g,{name:"oembed",error:r,hint:i?i.defaultMessage:""},t.createElement(Q.K,{size:1},t.createElement(w.Q,null,O.defaultMessage),t.createElement("div",{style:{border:"1px solid #dcdce4",padding:"15px",borderRadius:"2px"}},$&&t.createElement("div",{style:{marginBottom:"10px"}},E.title&&t.createElement(Z.x,{paddingBottom:2},t.createElement(B.Z,{variant:"delta"},E.title)),t.createElement(c.r,{href:E.url,target:"_blank"},E.url)),t.createElement("div",{style:{display:"flex"}},t.createElement(h.z,{variant:"default",onClick:v},$&&t.createElement(e.Z,{id:`${y()}.form.button.edit`}),!$&&t.createElement(e.Z,{id:`${y()}.form.button.import`})),$&&t.createElement(h.z,{variant:"danger",onClick:()=>q(null),style:{marginLeft:"15px"}},t.createElement(e.Z,{id:`${y()}.form.button.delete`})))),t.createElement(K.J,{style:(0,m.isEmpty)(i)?{}:{marginTop:"1.4rem"}}),t.createElement(H.c,null),b&&t.createElement(k,{onClose:N,value:E,onImport:q})))};M.defaultProps={description:void 0,error:void 0,value:""},M.propTypes={errors:o().array,inputDescription:o().oneOfType([o().string,o().func,o().shape({id:o().string,params:o().object})]),label:o().oneOfType([o().string,o().func,o().shape({id:o().string,params:o().object})]),name:o().string.isRequired,noErrorsDescription:o().bool,onChange:o().func.isRequired,value:o().string};const n=M}}]);
