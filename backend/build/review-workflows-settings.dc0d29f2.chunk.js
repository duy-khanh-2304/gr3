(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[8155],{97259:(O,A,r)=>{"use strict";r.r(A),r.d(A,{default:()=>Qe});var e=r(67294),y=r(41054),E=r(86896),T=r(86706),F=r(88767),k=r(79946),ae=r(45349),ne=r(57713),J=r(79371),ue=r(19442),v=r(26789),o=r(28809),a=r(8675),l=r(45697),d=r.n(l),g=r(1565),h=r(50781),u=r(75878),n=r(53616);function w({status:t,data:s}){return{type:n.QM,payload:{status:t,workflows:s}}}function b(t){return{type:n.x4,payload:{stageId:t}}}function I(t={}){return{type:n.Ot,payload:t}}function R(t,s){return{type:n.Nj,payload:{stageId:t,...s}}}function j(t,s){return{type:n.$k,payload:{newIndex:s,oldIndex:t}}}var $=r(77270),V=r(59533);const U=(0,g.default)(V.Z)`
  > circle {
    fill: ${({theme:t})=>t.colors.neutral150};
  }
  > path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`,G=(0,g.default)(h.x)`
  border-radius: 26px;

  svg {
    height: ${({theme:t})=>t.spaces[6]};
    width: ${({theme:t})=>t.spaces[6]};

    > path {
      fill: ${({theme:t})=>t.colors.neutral600};
    }
  }

  &:hover {
    color: ${({theme:t})=>t.colors.primary600} !important;
    ${$.Z} {
      color: ${({theme:t})=>t.colors.primary600} !important;
    }

    ${U} {
      > circle {
        fill: ${({theme:t})=>t.colors.primary600};
      }
      > path {
        fill: ${({theme:t})=>t.colors.neutral100};
      }
    }
  }

  &:active {
    ${$.Z} {
      color: ${({theme:t})=>t.colors.primary600};
    }

    ${U} {
      > circle {
        fill: ${({theme:t})=>t.colors.primary600};
      }
      > path {
        fill: ${({theme:t})=>t.colors.neutral100};
      }
    }
  }
`;function K({children:t,...s}){return e.createElement(G,{as:"button",background:"neutral0",border:"neutral150",paddingBottom:3,paddingLeft:4,paddingRight:4,paddingTop:3,shadow:"filterShadow",...s},e.createElement(u.k,{gap:2},e.createElement(U,{"aria-hidden":!0}),e.createElement($.Z,{variant:"pi",fontWeight:"bold",textColor:"neutral500"},t)))}K.propTypes={children:d().node.isRequired};var q=r(22996),Z=r(63128),_=r(27375),ee=r(37527),H=r(37362),we=r(9370),de=r(61585),Se=r(28469),ye=r(32156),Ee=r(29516),ke=r(8595),Ce=r(34263),be=r(5660),Re=r(61080),We=r(13037),De=r(75194),Ie=r(54878),xe=r(75642),Me=r(47815);const Te=(0,We.s)();function $e(){return e.createElement(h.x,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",display:"block",hasRadius:!0,padding:6,shadow:"tableShadow"})}function ge({id:t,index:s,canDelete:i,canReorder:W,isOpen:p=!1,stagesCount:f}){const c=m=>`${m+1} of ${f}`,C=m=>{L(S({id:"dnd.grab-item",defaultMessage:"{item}, grabbed. Current position in list: {position}. Press up and down arrow to change position, Spacebar to drop, Escape to cancel."},{item:x.value,position:c(m)}))},P=m=>{L(S({id:"dnd.drop-item",defaultMessage:"{item}, dropped. Final position in list: {position}."},{item:x.value,position:c(m)}))},z=()=>{L(S({id:"dnd.cancel-item",defaultMessage:"{item}, dropped. Re-order cancelled."},{item:x.value}))},se=(m,ce)=>{L(S({id:"dnd.reorder",defaultMessage:"{item}, moved. New position in list: {position}."},{item:x.value,position:c(m)})),N(j(ce,m))},[te,L]=e.useState(null),{formatMessage:S}=(0,E.Z)(),{trackUsage:le}=(0,k.useTracking)(),N=(0,T.I0)(),[X,re]=e.useState(p),[x,ie]=(0,y.useField)(`stages.${s}.name`),[D,M]=(0,y.useField)(`stages.${s}.color`),[{handlerId:Y,isDragging:B,handleKeyDown:Xe},Ye,Je,qe,ve]=(0,xe.Y9)(W,{index:s,item:{name:x.value},onGrabItem:C,onDropItem:P,onMoveItem:se,onCancel:z,type:n.uL.STAGE}),_e=(0,Me.FE)(Ye,Je),he=Te.map(({hex:m,name:ce})=>({value:m,label:S({id:"Settings.review-workflows.stage.color.name",defaultMessage:"{name}"},{name:ce}),color:m})),et=he.find(({value:m})=>m===D.value.toUpperCase());return e.useEffect(()=>{ve((0,Re.rX)(),{captureDraggingState:!1})},[ve,s]),e.createElement(h.x,{ref:_e},te&&e.createElement(q.T,{"aria-live":"assertive"},te),B?e.createElement($e,null):e.createElement(Z.U,{size:"S",variant:"primary",onToggle:()=>{re(!X),X||le("willEditStage")},expanded:X,shadow:"tableShadow"},e.createElement(_.B,{title:x.value,togglePosition:"left",action:e.createElement(u.k,null,i&&e.createElement(ee.h,{background:"transparent",icon:e.createElement(Ce.Z,null),label:S({id:"Settings.review-workflows.stage.delete",defaultMessage:"Delete stage"}),noBorder:!0,onClick:()=>N(b(t))}),e.createElement(ee.h,{background:"transparent",forwardedAs:"div",role:"button",noBorder:!0,tabIndex:0,"data-handler-id":Y,ref:qe,label:S({id:"Settings.review-workflows.stage.drag",defaultMessage:"Drag"}),onClick:m=>m.stopPropagation(),onKeyDown:Xe},e.createElement(be.Z,null)))}),e.createElement(H.v,{padding:6,background:"neutral0",hasRadius:!0},e.createElement(we.r,{gap:4},e.createElement(de.P,{col:6},e.createElement(Se.o,{...x,id:x.name,label:S({id:"Settings.review-workflows.stage.name.label",defaultMessage:"Stage name"}),error:ie.error??!1,onChange:m=>{x.onChange(m),N(R(t,{name:m.target.value}))},required:!0})),e.createElement(de.P,{col:6},e.createElement(ye.g,{error:M?.error??!1,name:D.name,id:D.name,required:!0},e.createElement(u.k,{direction:"column",gap:1,alignItems:"stretch"},e.createElement(Ee.Q,null,S({id:"content-manager.reviewWorkflows.stage.color",defaultMessage:"Color"})),e.createElement(k.ReactSelect,{components:{Option:De.K,SingleValue:Ie.R},error:M?.error,inputId:D.name,name:D.name,options:he,onChange:({value:m})=>{D.onChange({target:{value:m}}),N(R(t,{color:m}))},value:et??{value:D.value,label:S({id:"Settings.review-workflows.stage.color.name.custom",defaultMessage:"Custom"}),color:D.value}}),e.createElement(ke.c,null))))))))}ge.propTypes=d().shape({id:d().number.isRequired,color:d().string.isRequired,canDelete:d().bool.isRequired,canReorder:d().bool.isRequired,stagesCount:d().number.isRequired}).isRequired;const Oe=(0,g.default)(h.x)`
  position: relative;
`,Ae=(0,g.default)(h.x)`
  left: 50%;
  position: absolute;
  top: 0;
  transform: translateX(-50%);
`;function oe({stages:t}){const{formatMessage:s}=(0,E.Z)(),i=(0,T.I0)(),{trackUsage:W}=(0,k.useTracking)();return e.createElement(u.k,{direction:"column",gap:6,width:"100%"},e.createElement(Oe,{spacing:4,width:"100%"},e.createElement(Ae,{background:"neutral200",height:"100%",width:2,zIndex:1}),e.createElement(u.k,{direction:"column",alignItems:"stretch",gap:6,zIndex:2,position:"relative",as:"ol"},t.map((p,f)=>{const c=p?.id??p.__temp_key__;return e.createElement(h.x,{key:`stage-${c}`,as:"li"},e.createElement(ge,{id:c,index:f,canDelete:t.length>1,isOpen:!p.id,canReorder:t.length>1,stagesCount:t.length}))}))),e.createElement(u.k,{direction:"column",gap:6},e.createElement(K,{type:"button",onClick:()=>{i(I({name:""})),W("willCreateStage")}},s({id:"Settings.review-workflows.stage.add",defaultMessage:"Add new stage"}))))}oe.defaultProps={stages:[]},oe.propTypes={stages:d().arrayOf(d().shape({id:d().number,__temp_key__:d().number,name:d().string.isRequired}))};var fe=r(18172),Fe=r(18446),Pe=r.n(Fe);const me={status:"loading",serverState:{currentWorkflow:null,workflows:[]},clientState:{currentWorkflow:{data:null,isDirty:!1,hasDeletedServerStages:!1}}};function Le(t=me,s){return(0,fe.Uy)(t,i=>{const{payload:W}=s;switch(s.type){case n.QM:{const{status:p,workflows:f}=W;if(i.status=p,f?.length>0){let c=f[0];c={...c,stages:c.stages.map(C=>({...C,color:C?.color??n.FT}))},i.serverState.workflows=f,i.serverState.currentWorkflow=c,i.clientState.currentWorkflow.data=c,i.clientState.currentWorkflow.hasDeletedServerStages=!1}break}case n.x4:{const{stageId:p}=W,{currentWorkflow:f}=t.clientState;i.clientState.currentWorkflow.data.stages=f.data.stages.filter(c=>(c?.id??c.__temp_key__)!==p),f.hasDeletedServerStages||(i.clientState.currentWorkflow.hasDeletedServerStages=!!t.serverState.currentWorkflow.stages.find(c=>c.id===p));break}case n.Ot:{const{currentWorkflow:p}=t.clientState;p.data||(i.clientState.currentWorkflow.data={stages:[]});const f=Ne(i.clientState.currentWorkflow.data.stages);i.clientState.currentWorkflow.data.stages.push({...W,color:W?.color??n.FT,__temp_key__:f});break}case n.Nj:{const{currentWorkflow:p}=t.clientState,{stageId:f,...c}=W;i.clientState.currentWorkflow.data.stages=p.data.stages.map(C=>(C.id??C.__temp_key__)===f?{...C,...c}:C);break}case n.$k:{const{currentWorkflow:{data:{stages:p}}}=t.clientState,{newIndex:f,oldIndex:c}=W;if(f>=0&&f<p.length){const C=p[c];let P=[...p];P.splice(c,1),P.splice(f,0,C),i.clientState.currentWorkflow.data.stages=P}break}default:break}t.clientState.currentWorkflow.data&&(i.clientState.currentWorkflow.isDirty=!Pe()((0,fe.Vk)(i.clientState.currentWorkflow).data,i.serverState.currentWorkflow))})}const Ne=(t=[])=>{const s=t.map(i=>i.id??i.__temp_key__);return Math.max(...s,-1)+1};function je(t,s){const i=(0,T.oR)();(0,e.useEffect)(()=>{i.injectReducer(t,s)},[i,t,s])}var Ze=r(53752),Q=r(87561);function ze({formatMessage:t}){return Q.Ry({stages:Q.IX().of(Q.Ry().shape({name:Q.Z_().required(t({id:"Settings.review-workflows.validation.stage.name",defaultMessage:"Name is required"})).max(255,t({id:"Settings.review-workflows.validation.stage.max-length",defaultMessage:"Name can not be longer than 255 characters"})),color:Q.Z_().required(t({id:"Settings.review-workflows.validation.stage.color",defaultMessage:"Color is required"})).matches(/^#(?:[0-9a-fA-F]{3}){1,2}$/i)}))})}var Be=r(87751),Ve=r(21514);const Ue=(0,g.default)(u.k)`
  svg path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`;function pe({name:t}){return e.createElement(u.k,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",gap:3,hasRadius:!0,padding:3,shadow:"tableShadow",width:(0,k.pxToRem)(300)},e.createElement(Ue,{alignItems:"center",background:"neutral200",borderRadius:"50%",height:6,justifyContent:"center",width:6},e.createElement(Ve.Z,{width:`${8/16}rem`})),e.createElement($.Z,{fontWeight:"bold"},t))}pe.propTypes={name:d().string.isRequired};var Ge=r(27887);function Ke({type:t,item:s}){switch(t){case n.uL.STAGE:return e.createElement(pe,{...s});default:return null}}function He(){const{trackUsage:t}=(0,k.useTracking)(),{formatMessage:s}=(0,E.Z)(),i=(0,T.I0)(),{put:W}=(0,k.useFetchClient)(),{formatAPIError:p}=(0,k.useAPIErrorHandler)(),f=(0,k.useNotification)(),{workflows:c,refetchWorkflow:C}=(0,Ze.n)(),{status:P,clientState:{currentWorkflow:{data:z,isDirty:se,hasDeletedServerStages:te}}}=(0,T.v9)(M=>M?.[n.sN]??me),[L,S]=(0,e.useState)(!1),{mutateAsync:le,isLoading:N}=(0,F.useMutation)(async({workflowId:M,stages:Y})=>{const{data:{data:B}}=await W(`/admin/review-workflows/workflows/${M}/stages`,{data:Y});return B},{onSuccess(){f({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}})}}),X=async(M,Y)=>{try{return await le({workflowId:M,stages:Y})}catch(B){return f({type:"warning",message:p(B)}),null}},re=async()=>{await X(z.id,z.stages),await C(),S(!1)},x=async()=>{await re()},ie=()=>{S(M=>!M)},D=(0,y.useFormik)({enableReinitialize:!0,initialValues:z,async onSubmit(){te?S(!0):re()},validationSchema:ze({formatMessage:s}),validateOnChange:!1});return je(n.sN,Le),(0,e.useEffect)(()=>{i(w({status:c.status,data:c.data}))},[c.status,c.data,i]),(0,e.useEffect)(()=>{t("didViewWorkflow")},[]),e.createElement(k.CheckPagePermissions,{permissions:Be.Z.settings["review-workflows"].main},e.createElement(ae.A,null,e.createElement(k.SettingsPageTitle,{name:s({id:"Settings.review-workflows.page.title",defaultMessage:"Review Workflows"})}),e.createElement(ne.o,{tabIndex:-1},e.createElement(Ge.r,{renderItem:Ke}),e.createElement(y.FormikProvider,{value:D},e.createElement(y.Form,{onSubmit:D.handleSubmit},e.createElement(J.T,{primaryAction:e.createElement(ue.z,{startIcon:e.createElement(a.Z,null),type:"submit",size:"M",disabled:!se,loading:!L&&N},s({id:"global.save",defaultMessage:"Save"})),title:s({id:"Settings.review-workflows.page.title",defaultMessage:"Review Workflows"}),subtitle:s({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:z?.stages?.length??0})}),e.createElement(v.D,null,P==="loading"&&e.createElement(o.a,null,s({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})),e.createElement(oe,{stages:D.values?.stages})))),e.createElement(k.ConfirmDialog,{bodyText:{id:"Settings.review-workflows.page.delete.confirm.body",defaultMessage:"All entries assigned to deleted stages will be moved to the previous stage. Are you sure you want to save?"},isConfirmButtonLoading:N,isOpen:L,onToggleDialog:ie,onConfirm:x}))))}const Qe=He},7654:(O,A,r)=>{var e=r(81763);function y(E){return e(E)&&E!=+E}O.exports=y},81763:(O,A,r)=>{var e=r(44239),y=r(37005),E="[object Number]";function T(F){return typeof F=="number"||y(F)&&e(F)==E}O.exports=T},7334:(O,A,r)=>{var e=r(79833);function y(E){return e(E).toLowerCase()}O.exports=y},20573:(O,A,r)=>{"use strict";r.d(A,{P1:()=>J});var e="NOT_FOUND";function y(v){var o;return{get:function(l){return o&&v(o.key,l)?o.value:e},put:function(l,d){o={key:l,value:d}},getEntries:function(){return o?[o]:[]},clear:function(){o=void 0}}}function E(v,o){var a=[];function l(u){var n=a.findIndex(function(b){return o(u,b.key)});if(n>-1){var w=a[n];return n>0&&(a.splice(n,1),a.unshift(w)),w.value}return e}function d(u,n){l(u)===e&&(a.unshift({key:u,value:n}),a.length>v&&a.pop())}function g(){return a}function h(){a=[]}return{get:l,put:d,getEntries:g,clear:h}}var T=function(o,a){return o===a};function F(v){return function(a,l){if(a===null||l===null||a.length!==l.length)return!1;for(var d=a.length,g=0;g<d;g++)if(!v(a[g],l[g]))return!1;return!0}}function k(v,o){var a=typeof o=="object"?o:{equalityCheck:o},l=a.equalityCheck,d=l===void 0?T:l,g=a.maxSize,h=g===void 0?1:g,u=a.resultEqualityCheck,n=F(d),w=h===1?y(n):E(h,n);function b(){var I=w.get(arguments);if(I===e){if(I=v.apply(null,arguments),u){var R=w.getEntries(),j=R.find(function($){return u($.value,I)});j&&(I=j.value)}w.put(arguments,I)}return I}return b.clearCache=function(){return w.clear()},b}function ae(v){var o=Array.isArray(v[0])?v[0]:v;if(!o.every(function(l){return typeof l=="function"})){var a=o.map(function(l){return typeof l=="function"?"function "+(l.name||"unnamed")+"()":typeof l}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+a+"]")}return o}function ne(v){for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];var d=function(){for(var h=arguments.length,u=new Array(h),n=0;n<h;n++)u[n]=arguments[n];var w=0,b,I={memoizeOptions:void 0},R=u.pop();if(typeof R=="object"&&(I=R,R=u.pop()),typeof R!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof R+"]");var j=I,$=j.memoizeOptions,V=$===void 0?a:$,U=Array.isArray(V)?V:[V],G=ae(u),K=v.apply(void 0,[function(){return w++,R.apply(null,arguments)}].concat(U)),q=v(function(){for(var _=[],ee=G.length,H=0;H<ee;H++)_.push(G[H].apply(null,arguments));return b=K.apply(null,_),b});return Object.assign(q,{resultFunc:R,memoizedResultFunc:K,dependencies:G,lastResult:function(){return b},recomputations:function(){return w},resetRecomputations:function(){return w=0}}),q};return d}var J=ne(k),ue=function(o,a){if(a===void 0&&(a=J),typeof o!="object")throw new Error("createStructuredSelector expects first argument to be an object "+("where each property is a selector, instead received a "+typeof o));var l=Object.keys(o),d=a(l.map(function(g){return o[g]}),function(){for(var g=arguments.length,h=new Array(g),u=0;u<g;u++)h[u]=arguments[u];return h.reduce(function(n,w,b){return n[l[b]]=w,n},{})});return d}}}]);
