(self.webpackChunklab_nckh=self.webpackChunklab_nckh||[]).push([[7692],{76539:(D,C,t)=>{"use strict";t.d(C,{Z:()=>s});var e=t(67294),c=t(86896),n=t(45697),a=t.n(n),R=t(79946),l=t(8675),T=t(60793),E=t(79371),p=t(75878),h=t(19442),f=t(61378),m=t(48474);const y=({onRegenerate:M,idToRegenerate:I,backUrl:b,onError:z})=>{const{formatMessage:F}=(0,c.Z)(),[K,X]=(0,e.useState)(!1),{regenerateData:Y,isLoadingConfirmation:Q}=(0,m.rW)(b,I,M,z),$=async()=>{Y(),X(!1)};return e.createElement(e.Fragment,null,e.createElement(h.z,{startIcon:e.createElement(f.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>X(!0),name:"regenerate"},F({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),e.createElement(R.ConfirmDialog,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:e.createElement(f.Z,null),isConfirmButtonLoading:Q,isOpen:K,onToggleDialog:()=>X(!1),onConfirm:$,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};y.defaultProps={onRegenerate(){},onError:void 0},y.propTypes={onRegenerate:a().func,idToRegenerate:a().oneOfType([a().number,a().string]).isRequired,backUrl:a().string.isRequired,onError:a().func};const P=y,A=({title:M,token:I,setToken:b,canEditInputs:z,canRegenerate:F,isSubmitting:K,backUrl:X,regenerateUrl:Y,onErrorRegenerate:Q})=>{const{formatMessage:$}=(0,c.Z)(),J=ae=>{b({...I,accessKey:ae})};return e.createElement(E.T,{title:I?.name||$(M),primaryAction:z?e.createElement(p.k,{gap:2},F&&I?.id&&e.createElement(P,{backUrl:Y,onRegenerate:J,idToRegenerate:I?.id,onError:Q}),e.createElement(h.z,{disabled:K,loading:K,startIcon:e.createElement(l.Z,null),type:"submit",size:"S"},$({id:"global.save",defaultMessage:"Save"}))):F&&I?.id&&e.createElement(P,{onRegenerate:J,idToRegenerate:I?.id,backUrl:Y}),navigationAction:e.createElement(R.Link,{startIcon:e.createElement(T.Z,null),to:X},$({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};A.propTypes={token:a().shape({id:a().oneOfType([a().number,a().string]),type:a().string,lifespan:a().oneOfType([a().number,a().string]),name:a().string,accessKey:a().string,permissions:a().array,description:a().string,createdAt:a().string}),canEditInputs:a().bool.isRequired,canRegenerate:a().bool.isRequired,setToken:a().func.isRequired,isSubmitting:a().bool.isRequired,backUrl:a().string.isRequired,title:a().shape({id:a().string,label:a().string}).isRequired,regenerateUrl:a().string.isRequired,onErrorRegenerate:a().func},A.defaultProps={token:void 0,onErrorRegenerate:void 0};const s=A},60401:(D,C,t)=>{"use strict";t.d(C,{Z:()=>h});var e=t(67294),c=t(45697),n=t.n(c),a=t(86896),R=t(50614),l=t(473),T=t(77270),E=t(75056);const p=({token:f,errors:m,values:y,onChange:P,isCreating:A})=>{const{formatMessage:s}=(0,a.Z)();return e.createElement(e.Fragment,null,e.createElement(R.P,{name:"lifespan",label:s({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:y.lifespan!==null?y.lifespan:"0",error:m.lifespan?s(m.lifespan?.id?m.lifespan:{id:m.lifespan,defaultMessage:m.lifespan}):null,onChange:M=>{P({target:{name:"lifespan",value:M}})},required:!0,disabled:!A,placeholder:"Select"},e.createElement(l.W,{value:"604800000"},s({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),e.createElement(l.W,{value:"2592000000"},s({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),e.createElement(l.W,{value:"7776000000"},s({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),e.createElement(l.W,{value:"0"},s({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),e.createElement(T.Z,{variant:"pi",textColor:"neutral600"},!A&&`${s({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,E.IX)(f?.createdAt,parseInt(y.lifespan,10))}`))};p.propTypes={errors:n().shape({lifespan:n().string}),onChange:n().func.isRequired,values:n().shape({lifespan:n().oneOfType([n().number,n().string])}).isRequired,isCreating:n().bool.isRequired,token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string})},p.defaultProps={errors:{},token:{}};const h=p},24122:(D,C,t)=>{"use strict";t.d(C,{Z:()=>m});var e=t(67294),c=t(86896),n=t(79946),a=t(37527),R=t(70780),l=t(49231),T=t(45697),E=t.n(T),p=t(74855),h=t.n(p);const f=({token:y,tokenType:P})=>{const{formatMessage:A}=(0,c.Z)(),s=(0,n.useNotification)(),{trackUsage:M}=(0,n.useTracking)(),I=(0,e.useRef)(M);return e.createElement(n.ContentBox,{endAction:y&&e.createElement("span",{style:{alignSelf:"start"}},e.createElement(p.CopyToClipboard,{onCopy:()=>{I.current("didCopyTokenKey",{tokenType:P}),s({type:"success",message:{id:"Settings.tokens.notification.copied"}})},text:y},e.createElement(a.h,{label:A({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),noBorder:!0,icon:e.createElement(R.Z,null),style:{padding:0,height:"1rem"}}))),title:y||A({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:A(y?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:e.createElement(l.Z,null),iconBackground:"neutral100"})};f.defaultProps={token:null},f.propTypes={token:E().string,tokenType:E().string.isRequired};const m=f},40695:(D,C,t)=>{"use strict";t.d(C,{Z:()=>T});var e=t(67294),c=t(45697),n=t.n(c),a=t(86896),R=t(20603);const l=({errors:E,values:p,onChange:h,canEditInputs:f})=>{const{formatMessage:m}=(0,a.Z)();return e.createElement(R.g,{label:m({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:E.description?m(E.description?.id?E.description:{id:E.description,defaultMessage:E.description}):null,onChange:h,disabled:!f},p.description)};l.propTypes={errors:n().shape({description:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({description:n().string}).isRequired},l.defaultProps={errors:{}};const T=l},61053:(D,C,t)=>{"use strict";t.d(C,{Z:()=>T});var e=t(67294),c=t(45697),n=t.n(c),a=t(86896),R=t(28469);const l=({errors:E,values:p,onChange:h,canEditInputs:f})=>{const{formatMessage:m}=(0,a.Z)();return e.createElement(R.o,{name:"name",error:E.name?m(E.name?.id?E.name:{id:E.name,defaultMessage:E.name}):null,label:m({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:h,value:p.name,disabled:!f,required:!0})};l.propTypes={errors:n().shape({name:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string}).isRequired},l.defaultProps={errors:{}};const T=l},31065:(D,C,t)=>{"use strict";t.d(C,{Z:()=>E});var e=t(67294),c=t(45697),n=t.n(c),a=t(86896),R=t(50614),l=t(473);const T=({name:p,errors:h,values:f,onChange:m,canEditInputs:y,options:P,label:A})=>{const{formatMessage:s}=(0,a.Z)();return e.createElement(R.P,{name:p,label:s({id:A.id,defaultMessage:A.defaultMessage}),value:f&&f[p],error:h[p]?s(h[p]?.id?h[p]:{id:h[p],defaultMessage:h[p]}):null,onChange:m,placeholder:"Select",required:!0,disabled:!y},P&&P.map(({value:M,label:I})=>e.createElement(l.W,{key:M,value:M},s(I))))};T.propTypes={name:n().string,options:n().arrayOf(n().shape({label:n().shape({id:n().string,defaultMessage:n().string}),value:n().string})),errors:n().shape({type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({type:n().string}).isRequired,label:n().shape({id:n().string,defaultMessage:n().string}).isRequired},T.defaultProps={name:"type",errors:{},options:[]};const E=T},47670:(D,C,t)=>{"use strict";t.d(C,{Z:()=>e,f:()=>c});const e="api-token",c="transfer-token"},57692:(D,C,t)=>{"use strict";t.d(C,{Z:()=>ze});var e=t(67294),c=t(86896),n=t(79946),a=t(57713),R=t(26789),l=t(75878),T=t(41054),E=t(16550),p=t(88767),h=t(19631),f=t(75056),m=t(79371),y=t(19442),P=t(8675),A=t(45697),s=t.n(A);const M=({apiTokenName:o})=>{const{formatMessage:i}=(0,c.Z)();return(0,n.useFocusWhenNavigate)(),e.createElement(a.o,{"aria-busy":"true"},e.createElement(n.SettingsPageTitle,{name:"API Tokens"}),e.createElement(m.T,{primaryAction:e.createElement(y.z,{disabled:!0,startIcon:e.createElement(P.Z,null),type:"button",size:"L"},i({id:"global.save",defaultMessage:"Save"})),title:o||i({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),e.createElement(R.D,null,e.createElement(n.LoadingIndicatorPage,null)))};M.defaultProps={apiTokenName:null},M.propTypes={apiTokenName:s().string};const I=M;var b=t(87751);const z=(0,e.createContext)({}),F=({children:o,...i})=>e.createElement(z.Provider,{value:i},o),K=()=>(0,e.useContext)(z);F.propTypes={children:s().node.isRequired};const Y=(o,i=[])=>({...o,selectedAction:null,routes:[],selectedActions:[],data:(0,f.mk)(i)});var Q=t(18172),$=t(97019),J=t.n($);const ae={data:{},selectedActions:[]},fe=(o,i)=>(0,Q.ZP)(o,r=>{switch(i.type){case"ON_CHANGE":{r.selectedActions.includes(i.value)?J()(r.selectedActions,i.value):r.selectedActions.push(i.value);break}case"SELECT_ALL_IN_PERMISSION":{i.value.every(g=>r.selectedActions.includes(g.actionId))?i.value.forEach(g=>{J()(r.selectedActions,g.actionId)}):i.value.forEach(g=>{r.selectedActions.push(g.actionId)});break}case"SELECT_ALL_ACTIONS":{r.selectedActions=[...r.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const O=r.data.allActionsIds.filter(g=>g.includes("find")||g.includes("findOne"));r.selectedActions=[...O];break}case"UPDATE_PERMISSIONS_LAYOUT":{r.data=(0,f.mk)(i.value);break}case"UPDATE_ROUTES":{r.routes={...i.value};break}case"UPDATE_PERMISSIONS":{r.selectedActions=[...i.value];break}case"SET_SELECTED_ACTION":{r.selectedAction=i.value;break}default:return r}});var oe=t(9370),H=t(61585),Z=t(77270),N=t(50781),ye=t(48403),Te=t.n(ye),he=t(63128),Ae=t(27375),ve=t(37362),me=t(13539),Ce=t(80606),ee=t(1565);const Ee=ee.css`
  background: ${o=>o.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Pe=(0,ee.default)(N.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${o=>o.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${o=>o.isActive&&Ee}
  &:hover {
    ${Ee}
  }
`,Me=ee.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:o})=>o.colors.neutral150};
`,ie=({controllers:o,label:i,orderNumber:r,disabled:O,onExpanded:g,indexExpandendCollapsedContent:d})=>{const{value:{onChangeSelectAll:B,onChange:V,selectedActions:L,setSelectedAction:W,selectedAction:_}}=K(),[U,ne]=(0,e.useState)(!1),{formatMessage:w}=(0,c.Z)(),S=()=>{ne(x=>!x),g(r)};(0,e.useEffect)(()=>{d!==null&&d!==r&&U&&ne(!1)},[d,r,U]);const j=x=>x===_;return e.createElement(he.U,{expanded:U,onToggle:S,variant:r%2?"primary":"secondary"},e.createElement(Ae.B,{title:Te()(i)}),e.createElement(ve.v,null,o?.map(x=>{const se=x.actions.every(v=>L.includes(v.actionId)),de=x.actions.some(v=>L.includes(v.actionId));return e.createElement(N.x,{key:`${i}.${x?.controller}`},e.createElement(l.k,{justifyContent:"space-between",alignItems:"center",padding:4},e.createElement(N.x,{paddingRight:4},e.createElement(Z.Z,{variant:"sigma",textColor:"neutral600"},x?.controller)),e.createElement(Me,null),e.createElement(N.x,{paddingLeft:4},e.createElement(me.X,{value:se,indeterminate:!se&&de,onValueChange:()=>{B({target:{value:[...x.actions]}})},disabled:O},w({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(oe.r,{gap:4,padding:4},x?.actions&&x?.actions.map(v=>e.createElement(H.P,{col:6,key:v.actionId},e.createElement(Pe,{isActive:j(v.actionId),padding:2,hasRadius:!0},e.createElement(me.X,{value:L.includes(v.actionId),name:v.actionId,onValueChange:()=>{V({target:{value:v.actionId}})},disabled:O},v.action),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>W({target:{value:v.actionId}}),style:{display:"inline-flex",alignItems:"center"}},e.createElement(Ce.Z,null)))))))})))};ie.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ie.propTypes={controllers:s().array,orderNumber:s().number,label:s().string.isRequired,disabled:s().bool,onExpanded:s().func,indexExpandendCollapsedContent:s().number};const Re=ie,re=({section:o,...i})=>{const[r,O]=(0,e.useState)(null),g=d=>O(d);return e.createElement(N.x,{padding:4,background:"neutral0"},o&&o.map((d,B)=>e.createElement(Re,{key:d.apiId,label:d.label,controllers:d.controllers,orderNumber:B,indexExpandendCollapsedContent:r,onExpanded:g,name:d.apiId,...i})))};re.defaultProps={section:null},re.propTypes={section:s().arrayOf(s().object)};const Oe=re;var De=t(35161),Ie=t.n(De),ke=t(13217),Se=t.n(ke);const xe=o=>{switch(o){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Le=(0,ee.default)(N.x)`
  margin: -1px;
  border-radius: ${({theme:o})=>o.spaces[1]} 0 0 ${({theme:o})=>o.spaces[1]};
`;function le({route:o}){const{formatMessage:i}=(0,c.Z)(),{method:r,handler:O,path:g}=o,d=g?Se()(g.split("/")):[],[B="",V=""]=O?O.split("."):[],L=xe(o.method);return e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(Z.Z,{variant:"delta",as:"h3"},i({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,B),e.createElement(Z.Z,{variant:"delta",textColor:"primary600"},".",V)),e.createElement(l.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Le,{background:L.background,borderColor:L.border,padding:2},e.createElement(Z.Z,{fontWeight:"bold",textColor:L.text},r)),e.createElement(N.x,{paddingLeft:2,paddingRight:2},Ie()(d,W=>e.createElement(Z.Z,{key:W,textColor:W.includes(":")?"neutral600":"neutral900"},"/",W)))))}le.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},le.propTypes={route:s().shape({handler:s().string,method:s().string,path:s().string})};const Be=le,Ue=()=>{const{value:{selectedAction:o,routes:i}}=K(),{formatMessage:r}=(0,c.Z)(),O=o?.split(".")[0];return e.createElement(H.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},o?e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:2},i[O]?.map(g=>g.config.auth?.scope?.includes(o)||g.handler===o?e.createElement(Be,{key:g.handler,route:g}):null)):e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(Z.Z,{variant:"delta",as:"h3"},r({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),e.createElement(Z.Z,{as:"p",textColor:"neutral600"},r({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},Ze=({...o})=>{const{value:{data:i}}=K(),{formatMessage:r}=(0,c.Z)();return e.createElement(oe.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(H.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(Z.Z,{variant:"delta",as:"h2"},r({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),e.createElement(Z.Z,{as:"p",textColor:"neutral600"},r({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),i?.permissions&&e.createElement(Oe,{section:i?.permissions,...o})),e.createElement(Ue,null))},We=(0,e.memo)(Ze);var Ke=t(60401),Ne=t(61053),be=t(40695),Fe=t(31065);const ce=({errors:o,onChange:i,canEditInputs:r,isCreating:O,values:g,apiToken:d,onDispatch:B,setHasChangedPermissions:V})=>{const{formatMessage:L}=(0,c.Z)(),W=({target:{value:U}})=>{V(!1),U==="full-access"&&B({type:"SELECT_ALL_ACTIONS"}),U==="read-only"&&B({type:"ON_CHANGE_READ_ONLY"})},_=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return e.createElement(N.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(Z.Z,{variant:"delta",as:"h2"},L({id:"global.details",defaultMessage:"Details"})),e.createElement(oe.r,{gap:5},e.createElement(H.P,{key:"name",col:6,xs:12},e.createElement(Ne.Z,{errors:o,values:g,canEditInputs:r,onChange:i})),e.createElement(H.P,{key:"description",col:6,xs:12},e.createElement(be.Z,{errors:o,values:g,canEditInputs:r,onChange:i})),e.createElement(H.P,{key:"lifespan",col:6,xs:12},e.createElement(Ke.Z,{isCreating:O,errors:o,values:g,onChange:i,token:d})),e.createElement(H.P,{key:"type",col:6,xs:12},e.createElement(Fe.Z,{values:g,errors:o,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:U=>{W({target:{value:U}}),i({target:{name:"type",value:U}})},options:_,canEditInputs:r})))))};ce.propTypes={errors:s().shape({name:s().string,description:s().string,lifespan:s().string,type:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({name:s().string,description:s().string,lifespan:s().oneOfType([s().number,s().string]),type:s().string}).isRequired,isCreating:s().bool.isRequired,apiToken:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().string,name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),onDispatch:s().func.isRequired,setHasChangedPermissions:s().func.isRequired},ce.defaultProps={errors:{},apiToken:{}};const $e=ce;var He=t(24122),Ve=t(76539),te=t(47670);const Ge="Name already taken",ze=()=>{(0,n.useFocusWhenNavigate)();const{formatMessage:o}=(0,c.Z)(),{lockApp:i,unlockApp:r}=(0,n.useOverlayBlocker)(),O=(0,n.useNotification)(),g=(0,E.k6)(),[d,B]=(0,e.useState)(g.location.state?.apiToken.accessKey?{...g.location.state.apiToken}:null),{trackUsage:V}=(0,n.useTracking)(),L=(0,e.useRef)(V),{setCurrentStep:W}=(0,n.useGuidedTour)(),{allowedActions:{canCreate:_,canUpdate:U,canRegenerate:ne}}=(0,n.useRBAC)(b.Z.settings["api-tokens"]),[w,S]=(0,e.useReducer)(fe,ae,u=>Y(u,{})),{params:{id:j}}=(0,E.$B)("/settings/api-tokens/:id"),{get:x,post:se,put:de}=(0,n.useFetchClient)(),v=j==="create";(0,p.useQuery)("content-api-permissions",async()=>{const[u,G]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async q=>{const{data:k}=await x(q);return k.data}));S({type:"UPDATE_PERMISSIONS_LAYOUT",value:u}),S({type:"UPDATE_ROUTES",value:G}),d&&(d?.type==="read-only"&&S({type:"ON_CHANGE_READ_ONLY"}),d?.type==="full-access"&&S({type:"SELECT_ALL_ACTIONS"}),d?.type==="custom"&&S({type:"UPDATE_PERMISSIONS",value:d?.permissions}))},{onError(){O({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,e.useEffect)(()=>{L.current(v?"didAddTokenFromList":"didEditTokenFromList",{tokenType:te.Z})},[v]);const{status:Xe}=(0,p.useQuery)(["api-token",j],async()=>{const{data:{data:u}}=await x(`/admin/api-tokens/${j}`);return B({...u}),u?.type==="read-only"&&S({type:"ON_CHANGE_READ_ONLY"}),u?.type==="full-access"&&S({type:"SELECT_ALL_ACTIONS"}),u?.type==="custom"&&S({type:"UPDATE_PERMISSIONS",value:u?.permissions}),u},{enabled:!v&&!d,onError(){O({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Ye=async(u,G)=>{L.current(v?"willCreateToken":"willEditToken",{tokenType:te.Z}),i();const q=u.lifespan&&parseInt(u.lifespan,10)&&u.lifespan!=="0"?parseInt(u.lifespan,10):null;try{const{data:{data:k}}=v?await se("/admin/api-tokens",{...u,lifespan:q,permissions:u.type==="custom"?w.selectedActions:null}):await de(`/admin/api-tokens/${j}`,{name:u.name,description:u.description,type:u.type,permissions:u.type==="custom"?w.selectedActions:null});v&&(g.replace(`/settings/api-tokens/${k.id}`,{apiToken:k}),W("apiTokens.success")),r(),B({...k}),O({type:"success",message:o(v?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),L.current(v?"didCreateToken":"didEditToken",{type:d.type,tokenType:te.Z})}catch(k){const ge=(0,h.Iz)(k.response.data);G.setErrors(ge),k?.response?.data?.error?.message===Ge?O({type:"warning",message:k.response.data.message||"notification.error.tokennamenotunique"}):O({type:"warning",message:k?.response?.data?.message||"notification.error"}),r()}},[je,pe]=(0,e.useState)(!1),Qe={...w,onChange:({target:{value:u}})=>{pe(!0),S({type:"ON_CHANGE",value:u})},onChangeSelectAll:({target:{value:u}})=>{pe(!0),S({type:"SELECT_ALL_IN_PERMISSION",value:u})},setSelectedAction:({target:{value:u}})=>{S({type:"SET_SELECTED_ACTION",value:u})}},ue=U&&!v||_&&v;return!v&&!d&&Xe!=="success"?e.createElement(I,{apiTokenName:d?.name}):e.createElement(F,{value:Qe},e.createElement(a.o,null,e.createElement(n.SettingsPageTitle,{name:"API Tokens"}),e.createElement(T.Formik,{validationSchema:f.fK,validateOnChange:!1,initialValues:{name:d?.name||"",description:d?.description||"",type:d?.type,lifespan:d?.lifespan?d.lifespan.toString():d?.lifespan},enableReinitialize:!0,onSubmit:(u,G)=>Ye(u,G)},({errors:u,handleChange:G,isSubmitting:q,values:k,setFieldValue:ge})=>(je&&k?.type!=="custom"&&ge("type","custom"),e.createElement(n.Form,null,e.createElement(Ve.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:d,setToken:B,canEditInputs:ue,canRegenerate:ne,isSubmitting:q,regenerateUrl:"/admin/api-tokens/"}),e.createElement(R.D,null,e.createElement(l.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(d?.name)&&e.createElement(He.Z,{token:d?.accessKey,tokenType:te.Z}),e.createElement($e,{errors:u,onChange:G,canEditInputs:ue,isCreating:v,values:k,apiToken:d,onDispatch:S,setHasChangedPermissions:pe}),e.createElement(We,{disabled:!ue||k?.type==="read-only"||k?.type==="full-access"}))))))))}},75056:(D,C,t)=>{"use strict";t.d(C,{IX:()=>R,fK:()=>p,mk:()=>f});var e=t(6406),c=t(77349),n=t(51991);const R=(m,y,P="en")=>{if(y&&typeof y=="number"){const A=y/24/60/60/1e3;return(0,e.Z)((0,c.Z)(new Date(m),A),"PPP",{locale:n[P]})}return"Unlimited"};var l=t(87561),T=t(79946);const p=l.Ry().shape({name:l.Z_(T.translatedErrors.string).max(100).required(T.translatedErrors.required),type:l.Z_(T.translatedErrors.string).oneOf(["read-only","full-access","custom"]).required(T.translatedErrors.required),description:l.Z_().nullable(),lifespan:l.Rx().integer().min(0).nullable().defined(T.translatedErrors.required)}),f=m=>{const y={allActionsIds:[],permissions:[]};return y.permissions=Object.keys(m).map(P=>({apiId:P,label:P.split("::")[1],controllers:Object.keys(m[P].controllers).map(A=>({controller:A,actions:m[P].controllers[A].map(s=>{const M=`${P}.${A}.${s}`;return P.includes("api::")&&y.allActionsIds.push(M),{action:s,actionId:M}}).flat()})).flat()})),y}},74221:D=>{function C(t,e,c,n){for(var a=c-1,R=t.length;++a<R;)if(n(t[a],e))return a;return-1}D.exports=C},65464:(D,C,t)=>{var e=t(29932),c=t(42118),n=t(74221),a=t(7518),R=t(278),l=Array.prototype,T=l.splice;function E(p,h,f,m){var y=m?n:c,P=-1,A=h.length,s=p;for(p===h&&(h=R(h)),f&&(s=e(p,a(f)));++P<A;)for(var M=0,I=h[P],b=f?f(I):I;(M=y(s,b,M,m))>-1;)s!==p&&T.call(s,M,1),T.call(p,M,1);return p}D.exports=E},97019:(D,C,t)=>{var e=t(5976),c=t(4384),n=e(c);D.exports=n},4384:(D,C,t)=>{var e=t(65464);function c(n,a){return n&&n.length&&a&&a.length?e(n,a):n}D.exports=c},13217:(D,C,t)=>{var e=t(14259);function c(n){var a=n==null?0:n.length;return a?e(n,1,a):[]}D.exports=c}}]);
